<!DOCTYPE html><html lang="en" data-reactroot=""><head><title data-react-helmet="true">代码拾遗</title><meta data-react-helmet="true" name="title" content="代码拾遗"/><meta data-react-helmet="true" property="og:description" content="准备程序：

`Java
package test;

public class Test{
    public static void main(String[] args){
        new Thread(new Runnable(){
            public void run()..."/><meta data-react-helmet="true" property="og:title" content="Linux 如何查找Java 程序CPU负载过高"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="description" content="准备程序：

`Java
package test;

public class Test{
    public static void main(String[] args){
        new Thread(new Runnable(){
            public void run()..."/><meta data-react-helmet="true" name="keywords" content="CPU,Java,Linux,backend"/><link rel="preload" as="script" href="https://shjie047.github.io/bootstrap.e9f225cd.js"/><link rel="preload" as="script" href="https://shjie047.github.io/templates/src/containers/Post.502e6842.js"/><link rel="preload" as="script" href="https://shjie047.github.io/main.8ebda1c8.js"/><link rel="preload" as="style" href="https://shjie047.github.io/styles.c51b0ae0.css"/><link rel="stylesheet" href="https://shjie047.github.io/styles.c51b0ae0.css"/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><style data-styled-components="fJTUOz bDWFJH fkiuXN bGYHop goZMZM faAjVQ bzbSEp Hgjue">
/* sc-component-id: sc-bwzfXH */
.bGYHop{padding:0 40px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;} @media only screen and (max-width:400px){.bGYHop{padding:0 20px;}} .bGYHop a{font-size:1.6rem;font-weight:normal;} .bGYHop .icon-link{font-size:1.8rem;} .bGYHop .icon-btn{-webkit-apparance:none;background-color:transparent;border:none;outline:none;color:#fff;cursor:pointer;}
/* sc-component-id: sc-keyframes-fJTUOz */
@-webkit-keyframes fJTUOz{0%{width:0px;padding:4px 0;}100%{width:160px;padding:4px 5px;}} @keyframes fJTUOz{0%{width:0px;padding:4px 0;}100%{width:160px;padding:4px 5px;}}
/* sc-component-id: sc-htpNat */
.bzbSEp{margin-left:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;overflow:hidden;} .bzbSEp .search-input input{-webkit-apparance:none;border:0;outline:0;padding:4px 5px;margin:0;background-color:#fff;width:160px;-webkit-animation:.2s fJTUOz ease;animation:.2s fJTUOz ease;}
/* sc-component-id: sc-bxivhb */
@media only screen and (max-width:920px){.goZMZM{display:none;}} .goZMZM a{font-size:1.4rem;} .goZMZM::before{content:'';height:2.1rem;width:1px;background-color:#00000038;display:inline-block;vertical-align:middle;}
/* sc-component-id: sc-ifAKCX */
.faAjVQ{display:none;padding:0;margin:0;position:relative;font-size:1.4rem;} .faAjVQ::before{content:'';height:2.1rem;width:1px;background-color:#00000038;display:inline-block;vertical-align:middle;} .faAjVQ > i{display:inline-block;padding:1rem;color:#fff;font-weight:normal;-webkit-transition:color .3s ease;transition:color .3s ease;} .faAjVQ a{font-size:1.4rem;font-weight:normal;line-height:1;display:block;padding:1.2rem 3rem 1.2rem 1rem;} .faAjVQ li{margin:0;} .faAjVQ ul{list-style:none;padding:0;margin:0;position:absolute;top:100%;left:0;background-color:#108db8;display:none;width:120px;padding:10px 0;} .faAjVQ ul.show{display:inline-block;} @media only screen and (max-width:920px){.faAjVQ{display:inline;}}
/* sc-component-id: sc-EHOje */
.fkiuXN{position:absolute;top:0;left:50%;top:50%;color:#fff;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-repeat:no-repeat;background-size:100% auto;width:8rem;height:2rem;}
/* sc-component-id: sc-iwsKbI */
.Hgjue{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;} .Hgjue::after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;box-shadow:0 0 0 5px #fff;} .Hgjue .read-more{-webkit-text-decoration:none;text-decoration:none;} .Hgjue .author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%;} .Hgjue .post-header{margin-bottom:3.4rem;} .Hgjue .post-title a{-webkit-text-decoration:none;text-decoration:none;} .Hgjue .post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3;} .Hgjue .post-excerpt p{margin:0;font-size:.9em;line-height:1.7em;} .Hgjue .post-meta a{color:#9eabb3;-webkit-text-decoration:none;text-decoration:none;} .Hgjue .post-meta a:hover{color:#9eabb3;-webkit-text-decoration:underline;text-decoration:underline;} .Hgjue .post-date{display:inline-block;text-transform:uppercase;font-size:1.3rem;white-space:nowrap;} .Hgjue .post-date.has-author{margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;} @media only screen and (max-width:900px){.Hgjue{font-size:.95em;}} @media only screen and (max-width:500px){.Hgjue{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em;}.Hgjue .post-excerpt p{font-size:.85em;}.Hgjue .post-meta{font-size:1.3rem;margin-top:1rem;}.Hgjue pre{padding:0!important;}} .Hgjue pre{padding:1.2rem;} .Hgjue pre > code{overflow-x:auto;box-shadow:0 0 15px rgba(0,0,0,.35);padding:1.5rem;} .Hgjue blockquote{border-left:3px solid #061e35!important;margin-left:-23px!important;padding-bottom:2px!important;padding-left:20px!important;color:#24292e!important;} .Hgjue blockquote p{color:#24292e!important;} .Hgjue blockquote a{color:#061e35!important;}</style></head><body><div id="root"><div class="sc-bdVaJa bDWFJH" data-reactroot=""><div class="headroom-wrapper"><div style="position:relative;top:0;left:0;right:0;z-index:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0)" class="headroom headroom--unfixed"><div class="sc-EHOje fkiuXN" style="background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxODgiIGhlaWdodD0iNDUiIHZpZXdCb3g9IjAgMCAxODggNDUiPjx0ZXh0IGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZm9udC1mYW1pbHk9IllvdVl1YW4iIGZvbnQtc2l6ZT0iNDgiPjx0c3BhbiB4PSItMiIgeT0iMzgiPuS7o+eggeaLvumBlzwvdHNwYW4+PC90ZXh0Pjwvc3ZnPg==)"></div><nav class="sc-bwzfXH bGYHop"><a class="icon-link" aria-current="false" href="https://shjie047.github.io/"><i class="iconfont icon-home"></i></a><span class="sc-bxivhb goZMZM"><a aria-current="false" href="https://shjie047.github.io/tags/frontend">前端</a><a aria-current="false" href="https://shjie047.github.io/tags/backend">后端</a><a aria-current="false" href="https://shjie047.github.io/tags/mobile">移动端</a><a aria-current="false" href="https://shjie047.github.io/tags/java">Java</a></span><span class="toggled-popular sc-ifAKCX faAjVQ"><i class="iconfont icon-popular"></i><ul><li><a aria-current="false" href="https://shjie047.github.io/tags/backend">后端</a></li><li><a aria-current="false" href="https://shjie047.github.io/tags/mobile">移动端</a></li><li><a aria-current="false" href="https://shjie047.github.io/tags/java">Java</a></li></ul></span><div class="sc-htpNat bzbSEp"><a class="archive icon-link" aria-current="false" data-tip="归档" href="https://shjie047.github.io/archives"><i class="iconfont icon-archive"></i></a></div></nav></div></div><div class="content"><article class="sc-iwsKbI Hgjue"><header class="post-header"><h1 class="post-title">Linux 如何查找Java 程序CPU负载过高</h1><section class="post-meta "><time class="post-date" dateTime="2017-03-25">2017/3/25</time><span>, </span><span><span><a aria-current="false" href="https://shjie047.github.io/tags/cpu">CPU</a><span>, </span></span><span><a aria-current="false" href="https://shjie047.github.io/tags/java">Java</a><span>, </span></span><span><a aria-current="false" href="https://shjie047.github.io/tags/linux">Linux</a><span>, </span></span><span><a aria-current="false" href="https://shjie047.github.io/tags/backend">backend</a></span></span></section></header><section class="post-content markdown-body"><div><p>准备程序：</p><pre><code class="language-Java">package test;

public class Test{
    public static void main(String[] args){
        new Thread(new Runnable(){
            public void run(){
                while(true){

                }
            }
        }).start();
    }
}</code></pre><p>其中一个线程回导致一直占用CPU，编译运行。通过<code>top</code> 获取CPU占用信息
<img style="display:block;margin:0 auto;margin-top:4rem;cursor:zoom-in" src="https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/top.png"/>
可以看到占用最高的 pid是 25955
通过<code>top -p 25955 -H</code> 获取进程内部线程的CPU使用率。
<img style="display:block;margin:0 auto;margin-top:4rem;cursor:zoom-in" src="https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/tophp.png"/>
可以发现占用最高的线程ID是 <code>25965</code> 将其转换为16进制<code>python -c &#x27;print hex(25965)&#x27;</code> 得到的值是<code>0x656d</code> 
使用 <code>jstack -l 25955 &gt; jstack.log</code> 得到Java进程的Thread dump，通过 <code>grep -i 0x656d -A 30 jstack.log</code> 获取Java Thread id为0x656d的线程的thread dump。
<img style="display:block;margin:0 auto;margin-top:4rem;cursor:zoom-in" src="https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/jstack.png"/>
然后就可以定位相应代码查找代码占用CPU过高问题。</p></div></section><section class="post-footer"></section></article></div><div class="__react_component_tooltip place-top type-dark " data-id="tooltip"></div></div></div><script type="text/javascript">var cnzz_protocol = ((&quot;https:&quot; == document.location.protocol) ? &quot; https://&quot; : &quot; http://&quot;);document.write(unescape(&quot;%3Cspan id=&#x27;cnzz_stat_icon_1273381451&#x27;%3E%3C/span%3E%3Cscript src=&#x27;&quot; + cnzz_protocol + &quot;s22.cnzz.com/z_stat.php%3Fid%3D1273381451%26show%3Dpic&#x27; type=&#x27;text/javascript&#x27;%3E%3C/script%3E&quot;));</script><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"https://shjie047.github.io/styles.c51b0ae0.css"}</script><script type="text/javascript">
                window.__routeInfo = {'path':'post/2017-03-25/cpu-load-high','templateID':2,'sharedPropsHashes':{},'localProps':null,'allProps':{'post':{'title':'Linux \u5982\u4F55\u67E5\u627EJava \u7A0B\u5E8FCPU\u8D1F\u8F7D\u8FC7\u9AD8','tags':['CPU','Java','Linux','backend'],'iso8601Date':'2017-03-25T19:20:26+08:00','basename':'cpu-load-high','body':'\n\n\n\u51C6\u5907\u7A0B\u5E8F\uFF1A\n\n```Java\npackage test;\n\npublic class Test{\n    public static void main(String[] args){\n        new Thread(new Runnable(){\n            public void run(){\n                while(true){\n\n                }\n            }\n        }).start();\n    }\n}\n```\n\u5176\u4E2D\u4E00\u4E2A\u7EBF\u7A0B\u56DE\u5BFC\u81F4\u4E00\u76F4\u5360\u7528CPU\uFF0C\u7F16\u8BD1\u8FD0\u884C\u3002\u901A\u8FC7`top` \u83B7\u53D6CPU\u5360\u7528\u4FE1\u606F\n![top cpu](https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/top.png)\n\u53EF\u4EE5\u770B\u5230\u5360\u7528\u6700\u9AD8\u7684 pid\u662F 25955\n\u901A\u8FC7`top -p 25955 -H` \u83B7\u53D6\u8FDB\u7A0B\u5185\u90E8\u7EBF\u7A0B\u7684CPU\u4F7F\u7528\u7387\u3002\n![topph](https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/tophp.png)\n\u53EF\u4EE5\u53D1\u73B0\u5360\u7528\u6700\u9AD8\u7684\u7EBF\u7A0BID\u662F `25965` \u5C06\u5176\u8F6C\u6362\u4E3A16\u8FDB\u5236`python -c \'print hex(25965)\'` \u5F97\u5230\u7684\u503C\u662F`0x656d` \n\u4F7F\u7528 `jstack -l 25955 > jstack.log` \u5F97\u5230Java\u8FDB\u7A0B\u7684Thread dump\uFF0C\u901A\u8FC7 `grep -i 0x656d -A 30 jstack.log` \u83B7\u53D6Java Thread id\u4E3A0x656d\u7684\u7EBF\u7A0B\u7684thread dump\u3002\n![jstack](https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/jstack.png)\n\u7136\u540E\u5C31\u53EF\u4EE5\u5B9A\u4F4D\u76F8\u5E94\u4EE3\u7801\u67E5\u627E\u4EE3\u7801\u5360\u7528CPU\u8FC7\u9AD8\u95EE\u9898\u3002\n','date':'2017-03-25'}},'siteData':{'title':'React Static'}};</script><script defer="" type="text/javascript" src="https://shjie047.github.io/bootstrap.e9f225cd.js"></script><script defer="" type="text/javascript" src="https://shjie047.github.io/templates/src/containers/Post.502e6842.js"></script><script defer="" type="text/javascript" src="https://shjie047.github.io/main.8ebda1c8.js"></script></body></html>
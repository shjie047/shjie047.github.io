<!DOCTYPE html><html lang="en" data-reactroot=""><head><title data-react-helmet="true">开发笔记</title><meta data-react-helmet="true" name="title" content="开发笔记"/><meta data-react-helmet="true" property="og:description" content="准备程序：

`Java
package test;

public class Test{
    public static void main(String[] args){
        new Thread(new Runnable(){
            public void run()..."/><meta data-react-helmet="true" property="og:title" content="Linux 如何查找Java 程序CPU负载过高"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="description" content="准备程序：

`Java
package test;

public class Test{
    public static void main(String[] args){
        new Thread(new Runnable(){
            public void run()..."/><meta data-react-helmet="true" name="keywords" content="CPU,Java,Linux,backend"/><link rel="preload" as="script" href="https://shjie047.github.io/bootstrap.317e1443.js"/><link rel="preload" as="script" href="https://shjie047.github.io/templates/src/containers/Post.ec2b11fa.js"/><link rel="preload" as="script" href="https://shjie047.github.io/main.a1168391.js"/><link rel="preload" as="style" href="https://shjie047.github.io/styles.31acd520.css"/><link rel="stylesheet" href="https://shjie047.github.io/styles.31acd520.css"/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><style data-styled-components="bDWFJH gkZsHu fuJRCL mvmj gdQhez Riikb">
/* sc-component-id: sc-bwzfXH */
.fuJRCL{padding:0 40px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;} @media only screen and (max-width:400px){.fuJRCL{padding:0 20px;}} .fuJRCL a{font-size:1.6rem;font-weight:normal;} .fuJRCL .icon-link{font-size:1.8rem;} .fuJRCL .archive{margin-left:auto;}
/* sc-component-id: sc-htpNat */
@media only screen and (max-width:920px){.mvmj{display:none;}} .mvmj a{font-size:1.4rem;} .mvmj::before{content:'';height:2.1rem;width:1px;background-color:#00000038;display:inline-block;vertical-align:middle;}
/* sc-component-id: sc-bxivhb */
.gdQhez{display:none;padding:0;margin:0;position:relative;font-size:1.4rem;} .gdQhez::before{content:'';height:2.1rem;width:1px;background-color:#00000038;display:inline-block;vertical-align:middle;} .gdQhez > i{display:inline-block;padding:1rem;color:#fff;font-weight:normal;-webkit-transition:color .3s ease;transition:color .3s ease;} .gdQhez a{font-size:1.4rem;font-weight:normal;line-height:1;display:block;padding:1.2rem 3rem 1.2rem 1rem;} .gdQhez li{margin:0;} .gdQhez ul{list-style:none;padding:0;margin:0;position:absolute;top:100%;left:0;background-color:#108db8;display:none;} .gdQhez ul.show{display:inline-block;} @media only screen and (max-width:920px){.gdQhez{display:inline;}}
/* sc-component-id: sc-ifAKCX */
.gkZsHu{position:absolute;top:0;left:50%;top:50%;font-size:1.6rem;color:#fff;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);font-weight:normal;cursor:pointer;} .gkZsHu:hover{color:#fff!important;}
/* sc-component-id: sc-dnqmqq */
.Riikb{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;} .Riikb::after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;box-shadow:0 0 0 5px #fff;} .Riikb .read-more{-webkit-text-decoration:none;text-decoration:none;} .Riikb .author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%;} .Riikb .post-header{margin-bottom:3.4rem;} .Riikb .post-title a{-webkit-text-decoration:none;text-decoration:none;} .Riikb .post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3;} .Riikb .post-excerpt p{margin:0;font-size:.9em;line-height:1.7em;} .Riikb .post-meta a{color:#9eabb3;-webkit-text-decoration:none;text-decoration:none;} .Riikb .post-meta a:hover{color:#9eabb3;-webkit-text-decoration:underline;text-decoration:underline;} .Riikb .post-date{display:inline-block;text-transform:uppercase;font-size:1.3rem;white-space:nowrap;} .Riikb .post-date.has-author{margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;} @media only screen and (max-width:900px){.Riikb{font-size:.95em;}} @media only screen and (max-width:500px){.Riikb{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em;}.Riikb .post-excerpt p{font-size:.85em;}.Riikb .post-meta{font-size:1.3rem;margin-top:1rem;}}</style></head><body><div id="root"><div class="sc-bdVaJa bDWFJH" data-reactroot=""><div class="headroom-wrapper"><div style="position:relative;top:0;left:0;right:0;z-index:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0)" class="headroom headroom--unfixed"><a class="sc-ifAKCX gkZsHu" aria-current="false" href="https://shjie047.github.io/">开发笔记</a><nav class="sc-bwzfXH fuJRCL"><a class="icon-link" aria-current="false" href="https://shjie047.github.io/"><i class="iconfont icon-home"></i></a><span class="sc-htpNat mvmj"><a aria-current="false" href="https://shjie047.github.io/tags/frontend">前端</a><a aria-current="false" href="https://shjie047.github.io/tags/backed">后端</a><a aria-current="false" href="https://shjie047.github.io/tags/mobile">移动端</a><a aria-current="false" href="https://shjie047.github.io/tags/java">Java</a><a aria-current="false" href="https://shjie047.github.io/tags/javascript">JavaScript</a></span><span class="toggled-popular sc-bxivhb gdQhez"><i class="iconfont icon-popular"></i><ul><li><a aria-current="false" href="https://shjie047.github.io/tags/frontend">前端</a></li><li><a aria-current="false" href="https://shjie047.github.io/tags/backed">后端</a></li><li><a aria-current="false" href="https://shjie047.github.io/tags/mobile">移动端</a></li><li><a aria-current="false" href="https://shjie047.github.io/tags/java">Java</a></li><li><a aria-current="false" href="https://shjie047.github.io/tags/javascript">JavaScript</a></li></ul></span><a class="archive icon-link" aria-current="false" data-tip="归档" href="https://shjie047.github.io/archives"><i class="iconfont icon-archive"></i></a></nav></div></div><div class="content"><article class="sc-dnqmqq Riikb"><header class="post-header"><h1 class="post-title">Linux 如何查找Java 程序CPU负载过高</h1><section class="post-meta "><time class="post-date" dateTime="2017-03-25">2017/3/25</time><span>, </span><span><span><a aria-current="false" href="https://shjie047.github.io/tags/CPU">CPU</a><span>, </span></span><span><a aria-current="false" href="https://shjie047.github.io/tags/Java">Java</a><span>, </span></span><span><a aria-current="false" href="https://shjie047.github.io/tags/Linux">Linux</a><span>, </span></span><span><a aria-current="false" href="https://shjie047.github.io/tags/backend">backend</a></span></span></section></header><section class="post-content markdown-body"><div><p>准备程序：</p><pre><code class="language-Java">package test;

public class Test{
    public static void main(String[] args){
        new Thread(new Runnable(){
            public void run(){
                while(true){

                }
            }
        }).start();
    }
}</code></pre><p>其中一个线程回导致一直占用CPU，编译运行。通过<code>top</code> 获取CPU占用信息
<img style="display:block;margin:4rem auto" src="https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/top.png"/>
可以看到占用最高的 pid是 25955
通过<code>top -p 25955 -H</code> 获取进程内部线程的CPU使用率。
<img style="display:block;margin:4rem auto" src="https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/tophp.png"/>
可以发现占用最高的线程ID是 <code>25965</code> 将其转换为16进制<code>python -c &#x27;print hex(25965)&#x27;</code> 得到的值是<code>0x656d</code> 
使用 <code>jstack -l 25955 &gt; jstack.log</code> 得到Java进程的Thread dump，通过 <code>grep -i 0x656d -A 30 jstack.log</code> 获取Java Thread id为0x656d的线程的thread dump。
<img style="display:block;margin:4rem auto" src="https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/jstack.png"/>
然后就可以定位相应代码查找代码占用CPU过高问题。</p></div></section><section class="post-footer"></section></article></div><div class="__react_component_tooltip place-top type-dark " data-id="tooltip"></div></div></div><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"https://shjie047.github.io/styles.31acd520.css"}</script><script type="text/javascript">
                window.__routeInfo = {'path':'post/2017-03-25/cpu-load-high','templateID':2,'sharedPropsHashes':{},'localProps':null,'allProps':{'post':{'title':'Linux \u5982\u4F55\u67E5\u627EJava \u7A0B\u5E8FCPU\u8D1F\u8F7D\u8FC7\u9AD8','tags':['CPU','Java','Linux','backend'],'iso8601Date':'2017-03-25T19:20:26+08:00','basename':'cpu-load-high','body':'\n\n\n\u51C6\u5907\u7A0B\u5E8F\uFF1A\n\n```Java\npackage test;\n\npublic class Test{\n    public static void main(String[] args){\n        new Thread(new Runnable(){\n            public void run(){\n                while(true){\n\n                }\n            }\n        }).start();\n    }\n}\n```\n\u5176\u4E2D\u4E00\u4E2A\u7EBF\u7A0B\u56DE\u5BFC\u81F4\u4E00\u76F4\u5360\u7528CPU\uFF0C\u7F16\u8BD1\u8FD0\u884C\u3002\u901A\u8FC7`top` \u83B7\u53D6CPU\u5360\u7528\u4FE1\u606F\n![top cpu](https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/top.png)\n\u53EF\u4EE5\u770B\u5230\u5360\u7528\u6700\u9AD8\u7684 pid\u662F 25955\n\u901A\u8FC7`top -p 25955 -H` \u83B7\u53D6\u8FDB\u7A0B\u5185\u90E8\u7EBF\u7A0B\u7684CPU\u4F7F\u7528\u7387\u3002\n![topph](https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/tophp.png)\n\u53EF\u4EE5\u53D1\u73B0\u5360\u7528\u6700\u9AD8\u7684\u7EBF\u7A0BID\u662F `25965` \u5C06\u5176\u8F6C\u6362\u4E3A16\u8FDB\u5236`python -c \'print hex(25965)\'` \u5F97\u5230\u7684\u503C\u662F`0x656d` \n\u4F7F\u7528 `jstack -l 25955 > jstack.log` \u5F97\u5230Java\u8FDB\u7A0B\u7684Thread dump\uFF0C\u901A\u8FC7 `grep -i 0x656d -A 30 jstack.log` \u83B7\u53D6Java Thread id\u4E3A0x656d\u7684\u7EBF\u7A0B\u7684thread dump\u3002\n![jstack](https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/jstack.png)\n\u7136\u540E\u5C31\u53EF\u4EE5\u5B9A\u4F4D\u76F8\u5E94\u4EE3\u7801\u67E5\u627E\u4EE3\u7801\u5360\u7528CPU\u8FC7\u9AD8\u95EE\u9898\u3002\n','date':'2017-03-25'}},'siteData':{'title':'React Static'}};</script><script defer="" type="text/javascript" src="https://shjie047.github.io/bootstrap.317e1443.js"></script><script defer="" type="text/javascript" src="https://shjie047.github.io/templates/src/containers/Post.ec2b11fa.js"></script><script defer="" type="text/javascript" src="https://shjie047.github.io/main.a1168391.js"></script></body></html>
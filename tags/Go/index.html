<!DOCTYPE html><html lang="en" data-reactroot=""><head><title data-react-helmet="true">代码拾遗 - 更懂代码的媒体</title><meta data-react-helmet="true" property="og:description" content="这是一个互联网相关的技术类博客、开发笔记，提供全面的、前沿的计算机前端、后端教程，包括最新的国外技术文章，掌握最新的互联网技术资讯、趋势"/><meta data-react-helmet="true" property="og:title" content="代码拾遗 - 更懂代码的媒体"/><meta data-react-helmet="true" property="og:type" content="文章"/><meta data-react-helmet="true" name="title" content="代码拾遗 - 更懂代码的媒体"/><meta data-react-helmet="true" name="description" content="这是一个互联网相关的技术类博客、开发笔记，提供全面的、前沿的计算机前端、后端教程，包括最新的国外技术文章，掌握最新的互联网技术资讯、趋势"/><meta data-react-helmet="true" name="keywords" content="前端,后端,Java,Javascript,js,开发,教程,技术"/><link rel="preload" as="script" href="https://shjie047.github.io/bootstrap.20edb0ba.js"/><link rel="preload" as="script" href="https://shjie047.github.io/templates/src/containers/Tag.dc3ab84b.js"/><link rel="preload" as="script" href="https://shjie047.github.io/main.9de66d54.js"/><link rel="preload" as="style" href="https://shjie047.github.io/styles.00f9ab8a.css"/><link rel="stylesheet" href="https://shjie047.github.io/styles.00f9ab8a.css"/><link data-react-helmet="true" rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAABe3PX/Y972/2nf9v9v4Pb/cuD3/3bh9/954fj/e+L4/3ri+f954fj/duH3/3Lg9/9u4Pb/ad/1/2Td9v9d3PX/ZN32/2rf9v9w4Pf/duH3/3vi+P9/4/f/geT4/4Pk+P+C5Pj/guT4/3/j+P964vj/duH4/3Hg9/9r3/b/ZN32/2re9v9x4Pb/d+H4/37j+P+D5fb/h+b2/4vm9/+M5vf/jOb3/4vm9v+H5vb/g+X3/37j9/944ff/ceD2/2nf9/9v4Pb/deH3/37j9/+F5fj/i+X5/4/n+P+U5/n/luj5/5bo+f+V6Pj/j+b4/4vl+P+F5Pj/fuP4/3Xh9/9v4Pf/cuD2/3vi+P+C5Pj/iub4/5Hn+P+Y6fn/nOn6/5/p+/+f6vr/nen6/5no+v+S5vn/iuT4/4Pk+f954/f/ceD3/3fh9/+A4/j/iOX4/5Dm9v+Y6fr/nun5/6Pr+f+m6fj/p+v6/6Pp+P+e6fn/mOv6/5Hp+f+I5ff/gOP3/3bh9/954ff/g+T3/4rk9/+Y7fv/nOf2/6fu+/+x8Pn/ufj9/7Px+f+y9f3/qfP//5fh7/+N3+//jej5/4Lk9/964fj/eeH4/4Pj9v+Q7f//g8fW/2qWn/98qbP/aoWM/3OQl/9tiI7/cY+X/2OCif+Iv8n/ebXD/5Hv//+C4vb/eeH5/3rh+P+D4vX/k/L//3Ssuv9ihY7/d5+p/2eEiv92lJr/VGdp/2yMkf9ffIL/jcrW/3y9y/+P7P7/g+P3/3ri+P954fj/guT3/4rl+P+V6vr/f7zJ/5zc5f+w8f3/vvv//5LByv+p5/D/qvT//5/s+/+U6fv/i+X4/4Hk+P944fj/d+H3/4Dj+P+H5ff/j+b4/57z//+h7vv/o+r5/6bp+P+u9P7/puz6/57o+f+X6Pn/j+b4/4fl+P9/4/j/duH3/3Lg9/984vj/hOT4/4rm+P+Q5fb/l+j4/5zq+v+f6vr/nen4/5zp+f+Y6fn/kef4/4rm+P+D5ff/e+P3/3Pg9v9v3/b/duH3/37j+P+F5Pj/iuX6/4/m+f+U6Pj/luj5/5bp+f+T6Pj/kOb4/4vl+P+E5fj/feP4/3bh+P9v3/f/ad/2/3Dg9/934ff/fuP3/4Tk9/+I5ff/iuX4/4zl+f+N5fr/iuX4/4fl+P+E5Pj/f+P3/3fi9/9w4Pb/ad/2/2Pe9v9q3/b/cOD3/3Xh9/974vf/gOP3/4Lk+P+D5Pj/hOT4/4Lk+P9/4/j/e+L3/3bh9/9x4Pf/at/2/2Td9v9e3PX/Zd32/2re9v9u4Pb/cuD3/3fh9/954fj/euH4/3nh+P944fj/deH3/3Ph9v9v3/f/at72/2Td9v9d3Pb/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><style data-styled-components="enNFoQ fJTUOz jvzENE AjcTS ljxEMT gjHXKT hAbzAj fvIFII jUVlgh naYeG dCwEcx kFXVkB bmuDdU ihubGq">
/* sc-component-id: sc-bdVaJa */
.AjcTS{position:absolute;width:100%;} .AjcTS.fixed{position:fixed;background:#fff;top:-65px;z-index:800;border-bottom:1px solid #e1e1e1;} .AjcTS .logo{background-image:url(https://shjie047.github.io/static/logo.2b22c228.png);} .AjcTS.frontend,.AjcTS.frontend > *{background-color:#108db8!important;} .AjcTS.backend,.AjcTS.backend > *{background-color:rgba(0,100,0,1)!important;} .AjcTS.mobile,.AjcTS.mobile > *{background-color:rgb(219,112,147)!important;} .AjcTS.mobile nav a,.AjcTS.frontend nav a,.AjcTS.backend nav a{color:#fff;} .AjcTS.mobile .logo,.AjcTS.frontend .logo,.AjcTS.backend .logo{background-image:url(https://shjie047.github.io/static/codemore_white.2439fcc8.png);}
/* sc-component-id: sc-bwzfXH */
.gjHXKT{height:50px;max-width:1000px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:#fff;} .gjHXKT.fixed{position:fixed;left:0;right:0;top:0;border-bottom:1px solid #f1f1f1;} .gjHXKT.showBorder{border-bottom:1px solid #e7e7e7;} @media only screen and (max-width:400px){.gjHXKT{padding:0 20px;}} .gjHXKT a{font-size:1.6rem;font-weight:normal;} .gjHXKT .icon-link{font-size:1.8rem;} .gjHXKT .icon-btn{-webkit-apparance:none;background-color:transparent;border:none;outline:none;color:#fff;cursor:pointer;}
/* sc-component-id: sc-htpNat */
@media only screen and (max-width:920px){.hAbzAj{display:none;}} .hAbzAj a{font-size:1.5rem;} .hAbzAj::before{content:'';height:2.1rem;width:1px;background-color:#00000038;display:inline-block;vertical-align:middle;}
/* sc-component-id: sc-bxivhb */
.fvIFII{margin-left:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;overflow:hidden;} .fvIFII .search{cursor:pointer;margin-left:10px;} .fvIFII .search i{font-size:20px;}
/* sc-component-id: sc-keyframes-enNFoQ */
@-webkit-keyframes enNFoQ{0%{opacity:0;bottom:100%;}100%{opacity:1;bottom:0;}} @keyframes enNFoQ{0%{opacity:0;bottom:100%;}100%{opacity:1;bottom:0;}}
/* sc-component-id: sc-bZQynM */
.jUVlgh::after{content:'';display:table;} @media screen and (max-width:717px){.jUVlgh{padding:1rem;}}
/* sc-component-id: sc-keyframes-fJTUOz */
@-webkit-keyframes fJTUOz{0%{width:0px;padding:4px 0;}100%{width:160px;padding:4px 5px;}} @keyframes fJTUOz{0%{width:0px;padding:4px 0;}100%{width:160px;padding:4px 5px;}}
/* sc-component-id: sc-htoDjs */
.ljxEMT{position:absolute;top:0;left:50%;top:50%;color:#fff;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-repeat:no-repeat;background-size:100% auto;width:10rem;height:2.5rem;}
/* sc-component-id: sc-iwsKbI */
.ihubGq{font-size:14px;line-height:20px;color:rgba(0,0,0,.54);fill:rgba(0,0,0,.54);font-weight:400;} .ihubGq > div{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;} .ihubGq span{display:inline-block;} .ihubGq a{font-weight:400;font-size:14px;color:rgba(0,0,0,.54);} .ihubGq .comma{margin-right:4px;} .ihubGq div.cate{margin-top:12px;} .ihubGq .cate,.ihubGq .cate a{color:rgba(0,0,0,.84);} .ihubGq .dot{padding:0 0.5rem;} .ihubGq .dot::after{content:'\0B7';} .ihubGq .star{margin-right:4px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;} .ihubGq .readingtime{white-space:nowrap;} .ihubGq .readingtime::after{content:attr(title);}
/* sc-component-id: sc-gZMcBi */
.bmuDdU .post-nav{top:-1px;position:relative;padding-bottom:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:20px;} .bmuDdU .post-nav > div{font-weight:400;font-style:normal;font-size:1.4rem;line-height:20px;-webkit-transform:translateY(1.8px);-ms-transform:translateY(1.8px);transform:translateY(1.8px);-webkit-letter-spacing:.06rem;-moz-letter-spacing:.06rem;-ms-letter-spacing:.06rem;letter-spacing:.06rem;text-transform:uppercase;color:rgba(0,0,0,.76);border-top:2px solid rgba(0,0,0,.84);padding-top:8px;} .bmuDdU p{margin:0;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;} .bmuDdU .title-wrap{color:rgba(0,0,0,.84);font-weight:500;width:100%;} .bmuDdU .title-wrap:hover{color:rgba(0,0,0,.84);} .bmuDdU .summary-wrap{color:rgba(0,0,0,.54);font-weight:400;} .bmuDdU .summary-wrap:hover{color:rgba(0,0,0,.54);} .bmuDdU .title{line-height:24px;font-size:18px;} .bmuDdU .summary{font-size:14px;line-height:20px;margin-bottom:4px;} .bmuDdU .title-summary{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;overflow:hidden;} @media screen and (max-width:4000px){.bmuDdU .summary-title{max-height:88px;}} @media screen and (max-width:1207px){.bmuDdU .summary-title{max-height:100px;}} @media screen and (max-width:540px){.bmuDdU .post-caption{display:none;}} .bmuDdU.small .title{font-size:16px;line-height:20px;color:rgba(0,0,0,.84);font-weight:600;} .bmuDdU.large .title-summary{margin-bottom:16px;} .bmuDdU.large p{-webkit-line-clamp:3;} .bmuDdU.large .title{line-height:28px;font-size:20px;max-height:84px;margin-bottom:8px;} .bmuDdU.large .summary{font-size:16px;line-height:24px;max-height:72px;} @media screen and (max-width:4000px){.bmuDdU.large .title-summary{max-height:120px;}} @media screen and (max-width:1031px){.bmuDdU.large .title-summary{max-height:80px;}} @media screen and (max-width:855px){.bmuDdU.large .title-summary{max-height:80px;}} @media screen and (max-width:767px){.bmuDdU.large .title{max-height:72px;font-size:20px;line-height:24px;}}
/* sc-component-id: sc-hSdWYo */
.naYeG{width:80%;max-width:1000px;margin:3rem auto;} .naYeG > div{margin-bottom:3rem;}
/* sc-component-id: sc-eHgmQL */
.dCwEcx{padding:30px 0;margin:30px 0;border-bottom:1px solid #e1e1e1;}
/* sc-component-id: sc-cvbbAY */
.kFXVkB{display:grid;grid-template-columns:minmax(auto,400px) minmax(auto,400px);grid-row-gap:3rem;grid-column-gap:3rem;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}</style></head><body><div id="root"><div class="sc-EHOje jvzENE" data-reactroot=""><div class="sc-bdVaJa AjcTS"><div style="max-width:1000px;margin:0 auto;background:#fff;height:65px;position:relative"><div class="logo sc-htoDjs ljxEMT"></div></div><nav class="main-nav sc-bwzfXH gjHXKT"><a class="icon-link" aria-current="false" href="https://shjie047.github.io/"><i class="iconfont icon-home"></i></a><span class="sc-htpNat hAbzAj"><a aria-current="false" href="https://shjie047.github.io/cates/Frontend">前端</a><a aria-current="false" href="https://shjie047.github.io/cates/Backend">后端</a><a aria-current="false" href="https://shjie047.github.io/cates/Mobile">移动端</a></span><div class="sc-bxivhb fvIFII"><a class="archive icon-link" aria-current="false" data-tip="归档" data-for="tip-one" href="https://shjie047.github.io/archives"><i class="iconfont icon-archive"></i></a><a class="search"><i class="iconfont icon-search"></i></a></div></nav></div><div style="height:115px"></div><div class="sc-bZQynM jUVlgh"><div class="sc-hSdWYo naYeG"><div class="sc-eHgmQL dCwEcx"><h2>Go</h2></div><div class="sc-cvbbAY kFXVkB"><div class="sc-gZMcBi bmuDdU"><div class="title-summary"><a class="title-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-11/Go-Web-architecture"><p class="title">Go Web 架构</p></a><a class="summary-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-11/Go-Web-architecture"><p class="summary">原文地址

使用Golang来创建Web项目是一件很麻烦的事情。如果你使用Rails，那么你可能不会有这个感触。我在Refer Madness中使用了下面这个架构。

bash
-public/
-views/
-models/
-utils/
-controllers/
-web/
-main.go


我将打破这个体系，介绍各个目录的作用。在每个目录下，文件只能访问其同级或者上一级。这就意味着utils只能访问他自己和...</p></a></div><div class="post-caption sc-iwsKbI ihubGq"><div><span data-for="tip-two" data-tip="更新时间">2015-11-11</span><span class="dot"></span><span title="19分钟阅读" class="readingtime"></span></div></div></div><div class="sc-gZMcBi bmuDdU"><div class="title-summary"><a class="title-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-12/HTTP-2-And-GO"><p class="title">HTTP/2 和GO</p></a><a class="summary-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-12/HTTP-2-And-GO"><p class="summary">原文地址

HTTP/2是一个添加了一些新功能的HTTP的新版本，这些功能包括连接复用，首部压缩。再Go的标准库中暂时还没有HTTP/2的实现，但是现在有很多正在开发的库可以用来在Go中实现HTTP/2的server和client。

Brad Fitzpatrick实现了一个golang.org/x/net/http2的库，这个库甚至最终会加入到标准库中，不过他现在正在开发，所以在其他的库中。因...</p></a></div><div class="post-caption sc-iwsKbI ihubGq"><div><span data-for="tip-two" data-tip="更新时间">2015-11-12</span><span class="dot"></span><span title="5分钟阅读" class="readingtime"></span></div></div></div><div class="sc-gZMcBi bmuDdU"><div class="title-summary"><a class="title-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-12/develop-HTTP-middleware-using-Go"><p class="title">使用Go开发HTTP中间件</p></a><a class="summary-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-12/develop-HTTP-middleware-using-Go"><p class="summary">原文地址

 再web开发的背景下，“中间件”通常意思是“包装原始应用并添加一些额外的功能的应用的一部分”。这个概念似乎总是不被人理解，但是我认为中间件非常棒。
 首先，一个好的中间件有一个责任就是可插拔并且自足。这就意味着你可以在接口级别嵌入你的中间件他就能直接运行。它不会影响你编码方式，不是框架，仅仅是你请求处理里面的一层...</p></a></div><div class="post-caption sc-iwsKbI ihubGq"><div><span data-for="tip-two" data-tip="更新时间">2015-11-12</span><span class="dot"></span><span title="11分钟阅读" class="readingtime"></span></div></div></div><div class="sc-gZMcBi bmuDdU"><div class="title-summary"><a class="title-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-13/http-Handler-And-Go-error-handle"><p class="title">http.Handler 与Go的错误处理</p></a><a class="summary-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-13/http-Handler-And-Go-error-handle"><p class="summary">原文地址

 在之前我写过一篇关于通过使用http.HandlerFunc来实现一个定制handler类型用来避免一些平常的错误的文章。func MyHandler(w http.ResponseWriter, r *http.Request)的签名经常可以看到。这是一个有用的通用的包含一些基本功能的handler类型，但是和其他事情一样，也有一些不足：
 当你想要在一个handler中停止处理的时候，必须记得显...</p></a></div><div class="post-caption sc-iwsKbI ihubGq"><div><span data-for="tip-two" data-tip="更新时间">2015-11-13</span><span class="dot"></span><span title="11分钟阅读" class="readingtime"></span></div></div></div><div class="sc-gZMcBi bmuDdU"><div class="title-summary"><a class="title-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-15/create-a-homepage-for-Go-Web-App"><p class="title">为Go Web App 创建一个主页面</p></a><a class="summary-wrap" aria-current="false" href="https://shjie047.github.io/cates/Backend/post/2015-11-15/create-a-homepage-for-Go-Web-App"><p class="summary">原文地址

 大多数web app都有一个相同的布局。这个布局可能包含一个header或者footer，甚至可能包含一个导航菜单。Go的标准库提供一个简单的方式来创建这些基本元素，通过被不同的页面重用，创建出模板页的效果。
 这个简单的例子来解释如何实现的：
 让我们来创建一个简单的包含两个view的web app，一个是 main 一个是about。这两个view都有相...</p></a></div><div class="post-caption sc-iwsKbI ihubGq"><div><span data-for="tip-two" data-tip="更新时间">2015-11-15</span><span class="dot"></span><span title="6分钟阅读" class="readingtime"></span></div></div></div></div></div></div><div class="__react_component_tooltip place-top type-dark " data-id="tooltip"></div><div class="__react_component_tooltip place-top type-dark " data-id="tooltip"></div></div></div><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"https://shjie047.github.io/styles.00f9ab8a.css"}</script><script type="text/javascript">
                window.__routeInfo = {'path':'tags/Go','templateID':4,'sharedPropsHashes':{'tags':'Zpc8p0'},'localProps':null,'allProps':{'posts':[{'title':'Go Web \u67B6\u6784','iso8601Date':'2015-11-11T03:01:21+08:00','basename':'Go-Web-architecture','cover':'https://coding.net/u/shjie047/p/images/git/raw/master/stock-photo-251622641.jpg','tags':['Go','Architecture','Translate','Backend','Web'],'date':'2015-11-11','cate':'Backend','summary':'\u539F\u6587\u5730\u5740\n\n\u4F7F\u7528Golang\u6765\u521B\u5EFAWeb\u9879\u76EE\u662F\u4E00\u4EF6\u5F88\u9EBB\u70E6\u7684\u4E8B\u60C5\u3002\u5982\u679C\u4F60\u4F7F\u7528Rails\uFF0C\u90A3\u4E48\u4F60\u53EF\u80FD\u4E0D\u4F1A\u6709\u8FD9\u4E2A\u611F\u89E6\u3002\u6211\u5728Refer Madness\u4E2D\u4F7F\u7528\u4E86\u4E0B\u9762\u8FD9\u4E2A\u67B6\u6784\u3002\n\nbash\n-public/\n-views/\n-models/\n-utils/\n-controllers/\n-web/\n-main.go\n\n\n\u6211\u5C06\u6253\u7834\u8FD9\u4E2A\u4F53\u7CFB\uFF0C\u4ECB\u7ECD\u5404\u4E2A\u76EE\u5F55\u7684\u4F5C\u7528\u3002\u5728\u6BCF\u4E2A\u76EE\u5F55\u4E0B\uFF0C\u6587\u4EF6\u53EA\u80FD\u8BBF\u95EE\u5176\u540C\u7EA7\u6216\u8005\u4E0A\u4E00\u7EA7\u3002\u8FD9\u5C31\u610F\u5473\u7740utils\u53EA\u80FD\u8BBF\u95EE\u4ED6\u81EA\u5DF1\u548Cmodels\uFF0Cweb\u53EA\u80FD\u8BBF\u95EE\u5B83\u81EA\u5DF1\uFF0Ccontrollers\uFF0Cutils\uFF0Cmodels\u3002models\u53EA\u80FD\u8BBF\u95EE\u5B83\u81EA\u5DF1\u3002\u6211\u8FD9\u4E48\u505A\u662F\u4E3A\u4E86\u8BA9\u5C42\u6B21\u6E05\u6670\uFF0C\u9632\u6B62\u51FA\u73B0\u9012\u5F52\u4F9D\u8D56\u3002\u73B0\u5728\u6765\u5206\u6790\u6BCF\u4E00\u4E2A\u76EE\u5F55\uFF0C\u6587\u4EF6\u7684\u4F5C\u7528\u3002\n\nmain.go\n\nmain.go\u662F\u521B\u5EFA\u4F9D\u8D56\uFF0C\u83B7\u53D6\u73AF\u5883\u53D8\u91CF\uFF0C\u542F\u52A8\u670D\u52A1\u7684\u4E3B\u8981\u6587\u4EF6\u3002\u4E0B\u9762\u662F\u5B83\u7684\u5B9E\u4F8B\u3002\n\n`Go\npackage main\n\nimport (\n  &quot;github.com/larryprice/refermadness/utils&quot;\n  &quot;github.com/larryprice/refermadness/web&quot;\n  &quot;github.com/stretchr/graceful&quot;\n  &quot;os&quot;\n)\n\nfunc main() {\n  isDevelopment := os.Getenv(&quot;ENVIRONMENT&quot;) == &quot;development&quot;\n  dbURL := os.Getenv(&quot;MONGOLABURI&quot;)\n  if isDevelopment {\n    dbURL = os.Getenv(&quot;DBPORT27017TCP_ADDR&quot;)\n  }\n\n  dbAccessor := utils.NewDatabaseAccessor(dbURL, os.Getenv(&quot;DATABASE_NAME&quot;), 0)\n  cuAccessor := utils.NewCurrentUserAccessor(1)\n  s := web.NewServer(dbAccessor, cuAccessor, os.Getenv(&quot;GOOGLEOAUTH2CLIENTID&quot;),\n    os.Getenv(&quot;GOOGLEOAUTH2CLIENTSECRET&quot;), os.Getenv(&quot;SESSIONSECRET&quot;),\n    isDevelopment, os.Getenv(&quot;GOOGLEANALYTICS_KEY&quot;))\n\n  port := os.Getenv(&quot;PORT&quot;)\n  if port == &quot;&quot; {\n    port = &quot;3000&quot;\n  }\n\n  graceful.Run(&quot;:&quot;+port, 0, s)\n}\n\n`\n\n\u56E0\u4E3Amain.go\u5B9E\u5728\u6700\u4F4E\u7684\u5C42\u7EA7\uFF0C\u6240\u4EE5\u5B83\u53EF\u4EE5\u8BBF\u95EE\u6240\u6709\u7684\u76EE\u5F55\uFF1A\u5728\u8FD9\u4E2A\u4F8B\u5B50\u91CC\u662Fweb\u548Cutils\u3002\u5728\u8FD9\u91CC\u83B7\u53D6\u4E86\u6240\u6709\u7684\u73AF\u5883\u53D8\u91CF\u5E76\u628A\u5B83\u4EEC\u6CE8\u5165\u5230\u5408\u9002\u7684\u5730\u65B9\u3002\u5728main.go\u4E2D\u521B\u5EFA\u4E86\u670D\u52A1\u5668\uFF0C\u6CE8\u5165\u4F9D\u8D56\uFF0C\u5E76\u4E14\u5728\u914D\u7F6E\u7684\u7AEF\u53E3\u542F\u52A8\u670D\u52A1\u5668\u3002\n\nweb\n\nweb\u76EE\u5F55\u4E0B\u662F\u4E3B\u8981\u7684\u670D\u52A1\u4EE3\u7801\uFF0C\u540C\u65F6\u4E5F\u5305\u62EC\u4E86\u4E2D\u95F4\u4EF6\u4EE3\u7801\u3002\u4E0B\u9762\u662Fweb\u76EE\u5F55\u7684\u5185\u90E8\u7ED3\u6784\uFF1A\n\nbash\n-web/\n|-middleware/\n|-server.go\n\n\nserver.go\u5305\u542B\u4E86web server\u7684\u5B9A\u4E49\u3002\u8FD9\u4E2Aweb server \u521B\u5EFA\u4E86\u6240\u6709\u7684web controller\u5E76\u4E14\u7ED9negroni\u6DFB\u52A0\u4E86\u4E2D\u95F4\u4EF6\u3002\u4E0B\u9762\u662F\u4ED6\u7684\u4F8B\u5B50\uFF1A\n\n`Go\npackage web\n\nimport (\n  &quot;github.com/codegangsta/negroni&quot;\n  &quot;github.com/goincremental/negroni-sessions&quot;\n  &quot;github.com/goincremental/negroni-sessions/cookiestore&quot;\n  &quot;github.com/gorilla/mux&quot;\n  &quot;github.com/larryprice/refermadness/controllers&quot;\n  &quot;github.com/larryprice/refermadness/utils&quot;\n  &quot;github.com/larryprice/refermadness/web/middleware&quot;\n  &quot;github.com/unrolled/secure&quot;\n  &quot;gopkg.in/unrolled/render.v1&quot;\n  &quot;html/template&quot;\n  &quot;net/http&quot;\n)\n\ntype Server struct {\n  *negroni.Negroni\n}\n\nfunc NewServer(dba utils.DatabaseAccessor, cua utils.CurrentUserAccessor, clientID, clientSecret,\n  sessionSecret string, isDevelopment bool, gaKey string) *Server {\n  s := Server{negroni.Classic()}\n  session := utils.NewSessionManager()\n  basePage := utils.NewBasePageCreator(cua, gaKey)\n  renderer := render.New()\n\n  router := mux.NewRouter()\n\n  // ...\n\n  accountController := controllers.NewAccountController(clientID, clientSecret, isDevelopment, session, dba, cua, basePage, renderer)\n  accountController.Register(router)\n\n  // ...\n\n  s.Use(sessions.Sessions(&quot;refermadness&quot;, cookiestore.New([]byte(sessionSecret))))\n  s.Use(middleware.NewAuthenticator(dba, session, cua).Middleware())\n  s.UseHandler(router)\n  return &amp;s\n}\n`\n\nServer\u7ED3\u6784\u4F53\u662F\u4E00\u4E2Anegroni.Negroni\u7684web server\uFF0C\u5728\u8FD9\u4E2A\u6587\u4EF6\u91CC\u6709\u5BF9utils\u548C\u5176\u4ED6\u7B2C\u4E09\u65B9\u5305\u7684\u5F15\u7528\uFF0C\u521B\u5EFA\u4E86\u4E00\u4E2Arouter\uFF0C\u4E00\u4E9Bcontroller\uFF0C\u5E76\u4E14\u5C06controller\u6CE8\u518C\u5230\u5F53\u524Drouter\u3002\u540C\u65F6\u4E5F\u5F15\u5165\u4E86\u5FC5\u8981\u7684\u4E2D\u95F4\u4EF6\u3002\u8BF4\u5230\u4E2D\u95F4\u4EF6\uFF0C\u4E0B\u9762\u662F\u5B83\u7684\u4EE3\u7801\uFF1A\n\n`Go\npackage middleware\n\nimport (\n  &quot;github.com/codegangsta/negroni&quot;\n  &quot;github.com/larryprice/refermadness/utils&quot;\n  &quot;net/http&quot;\n)\n\ntype Database struct {\n  da utils.DatabaseAccessor\n}\n\nfunc NewDatabase(da utils.DatabaseAccessor) *Database {\n  return &amp;Database{da}\n}\n\nfunc (d Database) Middleware() negroni.HandlerFunc {\n  return func(rw http.ResponseWriter, r http.Request, next http.HandlerFunc) {\n    reqSession := d.da.Clone()\n    defer reqSession.Close()\n    d.da.Set(r, reqSession)\n    next(rw, r)\n  }\n}\n`\n\n\u8FD9\u4E2A\u662F\u901A\u8FC7HTTP router\u8BBF\u95EE\u6570\u636E\u5E93session\u7684\u6807\u6CE8\u4E2D\u95F4\u4EF6\u3002\u57FA\u672C\u6587\u4EF6\u662F\u4ECEBrian Gesiak\u2019s blog post on RESTful Go\u4E2D\u5F97\u5230\uFF0C\u5C06\u5176\u4FEE\u6539\u4E3A\u9002\u5408\u6211\u7684\u6587\u4EF6\u3002\n\ncontrollers/\n\n\u8FD9\u91CC\u7684controller\u4E0ERails\u91CC\u7684controller\u7684\u6982\u5FF5\u5F88\u50CF\u3002Controller\u6CE8\u518C\u81EA\u5DF1\u7684router\uFF0C\u8BBE\u7F6E\u81EA\u5DF1\u7684\u51FD\u6570\u8C03\u7528\u3002\u4E00\u4E2A\u7B80\u77ED\u7684\u4F8B\u5B50\u5982\u4E0B\uFF1A\n\n`Go\npackage controllers\n\nimport (\n  &quot;encoding/json&quot;\n  &quot;errors&quot;\n  &quot;github.com/gorilla/mux&quot;\n  &quot;github.com/larryprice/refermadness/models&quot;\n  &quot;github.com/larryprice/refermadness/utils&quot;\n  &quot;gopkg.in/mgo.v2/bson&quot;\n  &quot;gopkg.in/unrolled/render.v1&quot;\n  &quot;html/template&quot;\n  &quot;net/http&quot;\n  &quot;strings&quot;\n)\n\ntype ServiceControllerImpl struct {\n  currentUser utils.CurrentUserAccessor\n  basePage    utils.BasePageCreator\n  renderer    *render.Render\n  database    utils.DatabaseAccessor\n}\n\nfunc NewServiceController(currentUser utils.CurrentUserAccessor, basePage utils.BasePageCreator,\n  renderer render.Render, database utils.DatabaseAccessor) ServiceControllerImpl {\n  return &amp;ServiceControllerImpl{\n    currentUser: currentUser,\n    basePage:    basePage,\n    renderer:    renderer,\n    database:    database,\n  }\n}\n\nfunc (sc ServiceControllerImpl) Register(router mux.Router) {\n  router.HandleFunc(&quot;/service/{id}&quot;, sc.single)\n  // ...\n}\n\n// ...\n\ntype serviceResult struct {\n  models.Service\n  RandomCode models.ReferralCode\n  UserCode   *models.ReferralCode\n}\n\ntype servicePage struct {\n  utils.BasePage\n  ResultString string\n}\n\nfunc (sc ServiceControllerImpl) single(w http.ResponseWriter, r http.Request) {\n  data, err := sc.get(w, r)\n\n  if len(r.Header[&quot;Content-Type&quot;]) == 1 &amp;&amp; strings.Contains(r.Header[&quot;Content-Type&quot;][0], &quot;application/json&quot;) {\n    if err != nil {\n      sc.renderer.JSON(w, http.StatusBadRequest, map[string]string{\n        &quot;error&quot;: err.Error(),\n      })\n      return\n    }\n    sc.renderer.JSON(w, http.StatusOK, data)\n    return\n  } else if err != nil {\n    http.Error(w, err.Error(), http.StatusBadRequest)\n  }\n\n  resultString,  := json.Marshal(data)\n  t,  := template.ParseFiles(&quot;views/layout.html&quot;, &quot;views/service.html&quot;)\n  t.Execute(w, servicePage{sc.basePage.Get(r), string(resultString)})\n}\n`\n\nutils/\n\n\u5728utils\u76EE\u5F55\u4E0B\u7684\u6587\u4EF6\u63D0\u4F9B\u4E86\u4E00\u4E9B\u5E95\u5C42\u529F\u80FD\u7528\u6765\u652F\u6301\u5176\u4ED6\u7684\u4EE3\u7801\u3002\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u4E3B\u8981\u662F\u5B9A\u4E49\u4E00\u4E2A\u7ED3\u6784\u4F53\u6765\u8BBF\u95EE\u8BF7\u6C42\u7684\u4E0A\u4E0B\u6587\uFF0C\u5904\u7406session\uFF0C\u5B9A\u4E49\u4E00\u4E2A\u7279\u522B\u7684\u9875\u9762\u6765\u7EE7\u627F\u3002\u4E0B\u9762\u662F\u901A\u8FC7\u8BBF\u95EE\u4E0A\u4E0B\u6587\u8BBE\u7F6E\u7528\u6237\u7684\u4F8B\u5B50\uFF1A\n\n`Go\npackage utils\n\nimport (\n  &quot;github.com/gorilla/context&quot;\n  &quot;github.com/larryprice/refermadness/models&quot;\n  &quot;net/http&quot;\n)\n\ntype CurrentUserAccessor struct {\n  key int\n}\n\nfunc NewCurrentUserAccessor(key int) *CurrentUserAccessor {\n  return &amp;CurrentUserAccessor{key}\n}\n\nfunc (cua CurrentUserAccessor) Set(r http.Request, user *models.User) {\n  context.Set(r, cua.key, user)\n}\n\nfunc (cua CurrentUserAccessor) Clear(r http.Request) {\n  context.Delete(r, cua.key)\n}\n\nfunc (cua CurrentUserAccessor) Get(r http.Request) models.User {\n  if rv := context.Get(r, cua.key); rv != nil {\n    return rv.(models.User)\n  }\n  return nil\n}\n`\n\nmodels/\n\nmodel \u662F\u4E3A\u4E86\u63CF\u8FF0\u6570\u636E\u5E93\u4E2D\u7684\u6570\u636E\u7684\u6570\u636E\u7ED3\u6784\u3002\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\u4F7F\u7528model\u6765\u8BBF\u95EE\u6570\u636E\u5E93\uFF0C\u521B\u5EFA\u4E00\u4E2A\u7A7A\u7684model\uFF0C\u7136\u540E\u901A\u8FC7\u67E5\u8BE2\u6570\u636E\u5E93\u4E3A\u5176\u8D4B\u503C\u3002\u4E0B\u9762\u662F\u4E00\u4E2A\u4F8B\u5B50\uFF1A\n\n`Go\npackage models\n\nimport (\n  &quot;gopkg.in/mgo.v2&quot;\n  &quot;gopkg.in/mgo.v2/bson&quot;\n  &quot;strings&quot;\n  &quot;time&quot;\n)\n\ntype Service struct {\n  // identification information\n  ID          bson.ObjectId bson:&quot;_id&quot;\n  Name        string        bson:&quot;name&quot;\n  Description string        bson:&quot;description&quot;\n  URL         string        bson:&quot;url&quot;\n  Search      string        bson:&quot;search&quot;\n}\n\nfunc NewService(name, description, url string, creatorID bson.ObjectId) *Service {\n  url = strings.TrimPrefix(strings.TrimPrefix(url, &quot;http://&quot;), &quot;https://&quot;)\n  return &amp;Service{\n    ID:            bson.NewObjectId(),\n    Name:          name,\n    URL:           url,\n    Description:   description,\n    Search:        strings.ToLower(name) + &quot;;&quot; + strings.ToLower(description) + &quot;;&quot; + strings.ToLower(url),\n  }\n}\n\nfunc (s Service) Save(db mgo.Database) error {\n  _, err := s.coll(db).UpsertId(s.ID, s)\n  return err\n}\n\nfunc (s Service) FindByID(id bson.ObjectId, db mgo.Database) error {\n  return s.coll(db).FindId(id).One(s)\n}\n\nfunc (Service) coll(db mgo.Database) *mgo.Collection {\n  return db.C(&quot;service&quot;)\n}\n\ntype Services []Service\n\nfunc (s Services) FindByIDs(ids []bson.ObjectId, db mgo.Database) error {\n  return s.coll(db).Find(bson.M{&quot;_id&quot;: bson.M{&quot;$in&quot;: ids}}).Sort(&quot;name&quot;).All(s)\n}\n\nfunc (Services) coll(db mgo.Database) *mgo.Collection {\n  return db.C(&quot;service&quot;)\n}\n\n`\n\nviews/\n\n\u5C06Golang\u7684\u6A21\u677F\u6587\u4EF6\u653E\u5230views\u76EE\u5F55\u4E0B\u3002\u8FD9\u6837\uFF0C\u4E0D\u7BA1\u7528\u4EC0\u4E48\u6837\u7684\u6A21\u677F\u5F15\u64CE\u90FD\u53EF\u4EE5\u76F4\u63A5\u653E\u5230views\u4E0B\u3002\n\npublic/\n\n\u8DDF\u4EE5\u524D\u4E00\u6837\uFF0C\u8FD9\u4E2A\u6587\u4EF6\u90FD\u662F\u653E\u516C\u5F00\u7684\u6587\u4EF6\u7684\uFF0C\u4F8B\u5982css,img,scripts\u3002\n\n\u5982\u4F55\u8FD0\u884C\n\n\u6BEB\u65E0\u7591\u95EE\uFF0C\u6211\u6700\u559C\u6B22\u7684\u5C31\u662Fdocker\uFF0C\u56E0\u6B64\u6211\u5C06\u4F7F\u7528\u4ED6\u6765\u8FD0\u884C\u8FD9\u4E2A\u5E94\u7528\u3002\u5982\u679C\u4E0D\u4F7F\u7528docker\uFF0C\u90A3\u4E48\u53EF\u4EE5\u5C06\u6587\u4EF6\u653E\u5230$GOPATH/src/github.com/larryprice/refermadness,\u8FD0\u884Cgo get\u6765\u83B7\u53D6\u6240\u6709\u7684\u4F9D\u8D56\uFF0C\u7136\u540E\u8FD0\u884C go run main.go\u6216\u8005go build; ./refermadness\u8FD0\u884C\u7A0B\u5E8F\u3002\u5982\u679C\u4F60\u4E5F\u559C\u6B22\u4F7F\u7528docker\uFF0C\u90A3\u4E48\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7Dockerfile\u6765\u8FD0\u884C\u3002\n\n`bash\nFROM golang:1.4\n\nRUN go get github.com/codegangsta/gin\n\nADD . /go/src/github.com/larryprice/refermadness\nWORKDIR /go/src/github.com/larryprice/refermadness\nRUN go get\n`\n\n\u540C\u65F6\u6211\u4E5F\u5F88\u559C\u6B22compose\uFF0C\u6240\u4EE5\u6211\u4E5F\u901A\u8FC7compose \u6587\u4EF6\u6765\u8FD0\u884C\u6240\u6709\u7684\u5E94\u7528\u3002\u6211\u7528\u4E86JSC \uFF0CSASS\u548Cmongodb\uFF0C\u6240\u4EE5\u4E00\u4E0B\u662F\u6211\u7684docker-compose.yml\u6587\u4EF6\u3002\n\nGo\nmain:\n  build: .\n  command: gin run\n  env_file: .env\n  volumes:\n    - ./:/go/src/github.com/larryprice/refermadness\n  working_dir: /go/src/github.com/larryprice/refermadness\n  ports:\n    - &quot;3000:3000&quot;\n  links:\n    - db\nsass:\n  image: larryprice/sass\n  volumes:\n    - ./public/css:/src\njsx:\n  image: larryprice/jsx\n  volumes:\n    - ./public/scripts:/src\ndb:\n  image: mongo:3.0\n  command: mongod --smallfiles --quiet --logpath=/dev/null\n  volumes_from:\n    - dbvolume\ndbvolume:\n  image: busybox:ubuntu-14.04\n  volumes:\n    - /data/db\n\n\n\u7136\u540E\u8FD0\u884Cdocker-compose up\u6765\u8FD0\u884C\u6240\u6709\u7684\u5BB9\u5668\u5E76\u542F\u52A8\u670D\u52A1\u5668\u3002','readingtime':19,'url':'/cates/Backend/post/2015-11-11/Go-Web-architecture','dirs':['go'],'relatives':[{'url':'/cates/Backend/post/2015-11-12/HTTP-2-And-GO','title':'HTTP/2 \u548CGO'},{'url':'/cates/Backend/post/2015-11-15/create-a-homepage-for-Go-Web-App','title':'\u4E3AGo Web App \u521B\u5EFA\u4E00\u4E2A\u4E3B\u9875\u9762'},{'url':'/cates/Backend/post/2015-11-12/develop-HTTP-middleware-using-Go','title':'\u4F7F\u7528Go\u5F00\u53D1HTTP\u4E2D\u95F4\u4EF6'},{'url':'/cates/Backend/post/2015-11-13/http-Handler-And-Go-error-handle','title':'http.Handler \u4E0EGo\u7684\u9519\u8BEF\u5904\u7406'}]},{'title':'HTTP/2 \u548CGO','iso8601Date':'2015-11-12T19:39:21+08:00','basename':'HTTP-2-And-GO','cover':'https://coding.net/u/shjie047/p/images/git/raw/master/stock-photo-252006883.jpg','tags':['Http','HTTP/2','Translate','Go','Backend'],'date':'2015-11-12','cate':'Backend','summary':'\u539F\u6587\u5730\u5740\n\nHTTP/2\u662F\u4E00\u4E2A\u6DFB\u52A0\u4E86\u4E00\u4E9B\u65B0\u529F\u80FD\u7684HTTP\u7684\u65B0\u7248\u672C\uFF0C\u8FD9\u4E9B\u529F\u80FD\u5305\u62EC\u8FDE\u63A5\u590D\u7528\uFF0C\u9996\u90E8\u538B\u7F29\u3002\u518DGo\u7684\u6807\u51C6\u5E93\u4E2D\u6682\u65F6\u8FD8\u6CA1\u6709HTTP/2\u7684\u5B9E\u73B0\uFF0C\u4F46\u662F\u73B0\u5728\u6709\u5F88\u591A\u6B63\u5728\u5F00\u53D1\u7684\u5E93\u53EF\u4EE5\u7528\u6765\u5728Go\u4E2D\u5B9E\u73B0HTTP/2\u7684server\u548Cclient\u3002\n\nBrad Fitzpatrick\u5B9E\u73B0\u4E86\u4E00\u4E2Agolang.org/x/net/http2\u7684\u5E93\uFF0C\u8FD9\u4E2A\u5E93\u751A\u81F3\u6700\u7EC8\u4F1A\u52A0\u5165\u5230\u6807\u51C6\u5E93\u4E2D\uFF0C\u4E0D\u8FC7\u4ED6\u73B0\u5728\u6B63\u5728\u5F00\u53D1\uFF0C\u6240\u4EE5\u5728\u5176\u4ED6\u7684\u5E93\u4E2D\u3002\u56E0\u4E3A\u4ED6\u73B0\u5728\u7684\u5F00\u53D1\u5F88\u6D3B\u8DC3\uFF0C\u6240\u6709\u60C5\u51B5\u56E0\u4EBA\u800C\u5F02\uFF0C\u4F46\u662F\u5982\u679C\u4F60\u60F3\u5B9E\u73B0HTTP/2\u7684\u670D\u52A1\u5668\uFF0C\u4ECD\u7136\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E2A\u5E93\u3002\n\n\u521B\u5EFAHTTP/2\u670D\u52A1\u5668\n\n\u4F7F\u7528http2\u7684\u5E93\u5199\u4E00\u4E2A\u670D\u52A1\u5668\u662F\u5F88\u7B80\u5355\u7684\u3002http2\u5E93\u548C\u6807\u51C6\u5E93\u7684http\u5305\u96C6\u6210\u5728\u4E00\u8D77\uFF0C\u9700\u8981\u8C03\u7528http2.ConfigureServer()\u6765\u914D\u7F6E\u4E00\u4E2A\u666E\u901Ahttp\u4F7F\u7528HTTP/2\u534F\u8BAE\u3002\u5982\u679C\u9700\u8981\u901A\u8FC7\u6D4F\u89C8\u5668\u8BBF\u95EE\u6216\u8005\u964D\u7EA7\u5230HTTP 1.x \u534F\u8BAE\uFF0C\u90A3\u4E48\u4F60\u9700\u8981\u8BBE\u7F6ETLS \u52A0\u5BC6\u3002\u867D\u7136\u52A0\u5BC6\u4E0D\u662F\u5FC5\u987B\u7684\uFF0C\u4F46\u662F\u73B0\u5728\u8FD8\u6CA1\u6709\u6D4F\u89C8\u5668\u652F\u6301\u975E\u52A0\u5BC6\u7684HTTP/2\u534F\u8BAE\u3002\n\n`Go\npackage main\n\nimport (\n    &quot;log&quot;\n    &quot;net/http&quot;\n    &quot;os&quot;\n\n&quot;golang.org/x/net/http2&quot;\n\n)\n\nfunc main() {\n    cwd, err := os.Getwd()\n    if err != nil {\n        log.Fatal(err)\n    }\n\nsrv := &amp;http.Server{\n    Addr:    &quot;:8000&quot;, // Normally &quot;:443&quot;\n    Handler: http.FileServer(http.Dir(cwd)),\n}\nhttp2.ConfigureServer(srv, &amp;http2.Server{})\nlog.Fatal(srv.ListenAndServeTLS(&quot;server.crt&quot;, &quot;server.key&quot;))\n\n}\n`\n\n\u521B\u5EFAHTTP/2 \u5BA2\u6237\u7AEF\n\n\u73B0\u5728\u4F7F\u7528http2\u7684\u5E93\u521B\u5EFA\u5BA2\u6237\u7AEF\u5F88hacky\u3002\u867D\u7136\u5B83\u4F1A\u8F93\u51FA\u5F88\u591A\u8C03\u8BD5\u65E5\u5FD7\uFF0C\u4F46\u662F\u5BF9\u4E8E\u5927\u591A\u6570\u60C5\u51B5\u4E0B\u8FD0\u884C\u7684\u5F88\u597D\u3002\u53EF\u4EE5\u4F7F\u7528http2.Transport\u5BF9\u8C61\uFF0C\u5C06\u4ED6\u4F20\u7ED9http\u5305\u7684client\u3002\n\n`Go\npackage main\n\nimport (\n    &quot;fmt&quot;\n    &quot;io/ioutil&quot;\n    &quot;log&quot;\n    &quot;net/http&quot;\n\n&quot;golang.org/x/net/http2&quot;\n\n)\n\nfunc main() {\n    client := http.Client{\n        // InsecureTLSDial is temporary and will likely be\n        // replaced by a different API later.\n        Transport: &amp;http2.Transport{InsecureTLSDial: true},\n    }\n\nresp, err := client.Get(&quot;https://localhost:8000/&quot;)\nif err != nil {\n    log.Fatal(err)\n}\n\nbody, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    log.Fatal(err)\n}\n\nfmt.Println(string(body))\n\n}\n`\n\n\u66F4\u591A\u9605\u8BFB\n\n\u5982\u679C\u4F60\u5BF9HTTP/2\u534F\u8BAE\u611F\u5174\u8DA3\uFF0C\u90A3\u4E48\u53EF\u4EE5\u53C2\u8003HTTP/2 \u4E3B\u9875\uFF0C\u8FD9\u4E2A\u9875\u9762\u6709\u5F88\u591A\u5176\u4ED6\u8D44\u6599\u7684\u8FDE\u63A5\u8FD8\u6709\u5176\u4ED6\u8BED\u8A00\u7684\u5B9E\u73B0\u3002\n\n\u5982\u679C\u4F60\u60F3\u77E5\u9053HTTP/2\u7684\u670D\u52A1\u7AEF\u548C\u5BA2\u6237\u7AEF\u662F\u5982\u4F55\u5B9E\u73B0\u7684\uFF0C\u90A3\u4E48Jxck&#39;s http2 implementation\u7684\u5B9E\u73B0\u5C31\u5F88\u503C\u5F97\u4E00\u8BFB\u3002Jxck\u901A\u8FC7\u5BF9\u6807\u51C6\u7684HTTP\u5E93\u7684TLSNextProto\u8BBE\u7F6E\u4E00\u4E2A\u94A9\u5B50\u6765\u5B9E\u73B0\u7684\u3002\u4F60\u53EF\u4EE5\u518D\u8FD9\u91CC\u9605\u8BFB\u4E00\u4E9B\u793A\u4F8B\u3002\n\ngrpc-go \u5E93\u540C\u6837\u4E5F\u6709\u81EA\u5DF1\u7684\u670D\u52A1\u7AEF\u548C\u5BA2\u6237\u7AEF\u7684\u5B9E\u73B0\u3002','readingtime':5,'url':'/cates/Backend/post/2015-11-12/HTTP-2-And-GO','dirs':['go'],'relatives':[{'url':'/cates/Backend/post/2015-11-11/Go-Web-architecture','title':'Go Web \u67B6\u6784'},{'url':'/cates/Backend/post/2015-11-15/create-a-homepage-for-Go-Web-App','title':'\u4E3AGo Web App \u521B\u5EFA\u4E00\u4E2A\u4E3B\u9875\u9762'},{'url':'/cates/Backend/post/2015-11-12/develop-HTTP-middleware-using-Go','title':'\u4F7F\u7528Go\u5F00\u53D1HTTP\u4E2D\u95F4\u4EF6'},{'url':'/cates/Backend/post/2015-11-13/http-Handler-And-Go-error-handle','title':'http.Handler \u4E0EGo\u7684\u9519\u8BEF\u5904\u7406'}]},{'title':'\u4F7F\u7528Go\u5F00\u53D1HTTP\u4E2D\u95F4\u4EF6','iso8601Date':'2015-11-12T20:07:49+08:00','basename':'develop-HTTP-middleware-using-Go','cover':'https://coding.net/u/shjie047/p/images/git/raw/master/stock-photo-228204533.jpg','tags':['HTTP','Go','Middleware','Backend'],'date':'2015-11-12','cate':'Backend','summary':'\u539F\u6587\u5730\u5740\n\n \u518Dweb\u5F00\u53D1\u7684\u80CC\u666F\u4E0B\uFF0C\u201C\u4E2D\u95F4\u4EF6\u201D\u901A\u5E38\u610F\u601D\u662F\u201C\u5305\u88C5\u539F\u59CB\u5E94\u7528\u5E76\u6DFB\u52A0\u4E00\u4E9B\u989D\u5916\u7684\u529F\u80FD\u7684\u5E94\u7528\u7684\u4E00\u90E8\u5206\u201D\u3002\u8FD9\u4E2A\u6982\u5FF5\u4F3C\u4E4E\u603B\u662F\u4E0D\u88AB\u4EBA\u7406\u89E3\uFF0C\u4F46\u662F\u6211\u8BA4\u4E3A\u4E2D\u95F4\u4EF6\u975E\u5E38\u68D2\u3002\n \u9996\u5148\uFF0C\u4E00\u4E2A\u597D\u7684\u4E2D\u95F4\u4EF6\u6709\u4E00\u4E2A\u8D23\u4EFB\u5C31\u662F\u53EF\u63D2\u62D4\u5E76\u4E14\u81EA\u8DB3\u3002\u8FD9\u5C31\u610F\u5473\u7740\u4F60\u53EF\u4EE5\u5728\u63A5\u53E3\u7EA7\u522B\u5D4C\u5165\u4F60\u7684\u4E2D\u95F4\u4EF6\u4ED6\u5C31\u80FD\u76F4\u63A5\u8FD0\u884C\u3002\u5B83\u4E0D\u4F1A\u5F71\u54CD\u4F60\u7F16\u7801\u65B9\u5F0F\uFF0C\u4E0D\u662F\u6846\u67B6\uFF0C\u4EC5\u4EC5\u662F\u4F60\u8BF7\u6C42\u5904\u7406\u91CC\u9762\u7684\u4E00\u5C42\u800C\u5DF2\u3002\u5B8C\u5168\u6CA1\u5FC5\u8981\u91CD\u5199\u4F60\u7684\u4EE3\u7801\uFF0C\u5982\u679C\u4F60\u60F3\u4F7F\u7528\u4E2D\u95F4\u4EF6\u7684\u4E00\u4E2A\u529F\u80FD\uFF0C\u4F60\u5C31\u5E2E\u4ED6\u63D2\u5165\u5230\u90A3\u91CC\uFF0C\u5982\u679C\u4E0D\u60F3\u4F7F\u7528\u4E86\uFF0C\u5C31\u53EF\u4EE5\u76F4\u63A5\u79FB\u9664\u3002\n \u7EB5\u89C2Go\u8BED\u8A00\uFF0C\u4E2D\u95F4\u4EF6\u662F\u975E\u5E38\u666E\u904D\u7684\uFF0C\u5373\u4F7F\u5728\u6807\u51C6\u5E93\u4E2D\u3002\u867D\u7136\u5F00\u59CB\u7684\u65F6\u5019\u4E0D\u4F1A\u90A3\u4E48\u660E\u663E\uFF0C\u5728\u6807\u51C6\u5E93net/http\u4E2D\u7684\u51FD\u6570StripText\u6216\u8005TimeoutHandler\u5C31\u662F\u6211\u4EEC\u8981\u5B9A\u4E49\u548C\u7684\u4E2D\u95F4\u4EF6\u7684\u6837\u5B50\uFF0C\u5904\u7406\u8BF7\u6C42\u548C\u76F8\u5E94\u7684\u65F6\u5019\u4ED6\u4EEC\u5305\u88C5\u4F60\u7684handler\uFF0C\u5E76\u5904\u7406\u4E00\u4E9B\u989D\u5916\u7684\u6B65\u9AA4\u3002\n \u6211\u6700\u8FD1\u5199\u7684Go\u5305nosurf\u540C\u6837\u4E5F\u662F\u4E2A\u4E2D\u95F4\u4EF6\u3002\u6211\u7279\u610F\u5C06\u4ED6\u4ECE\u5934\u5F00\u59CB\u8BBE\u8BA1\u3002\u5728\u5927\u591A\u6570\u60C5\u51B5\u4E0B\uFF0C\u4F60\u4E0D\u9700\u8981\u5728\u5E94\u7528\u5C42\u62C5\u5FC3CSRF\u653B\u51FB\uFF0Cnosurf\u50CF\u5176\u4ED6\u7684\u4E2D\u95F4\u4EF6\u4E00\u6837\u53EF\u4EE5\u81EA\u8DB3\uFF0C\u5E76\u4E14\u548Cnet/http\u7684\u63A5\u53E3\u65E0\u7F1D\u8854\u63A5\u3002\n \u540C\u6837\u4F60\u8FD8\u53EF\u4EE5\u4F7F\u7528\u4E2D\u95F4\u4EF6\u505A\uFF1A\n \u9690\u85CF\u957F\u5EA6\u9632\u6B62\u7F13\u51B2\u653B\u51FB\n \u901F\u5EA6\u9650\u5236\n \u5C4F\u853D\u722C\u866B\n \u63D0\u4F9B\u8C03\u8BD5\u4FE1\u606F\n \u6DFB\u52A0HSTS\uFF0CX-Frame-Options\u5934\n \u4ECE\u9519\u8BEF\u4E2D\u6062\u590D\n* \u7B49\u7B49\n\n\u7F16\u5199\u4E00\u4E2A\u7B80\u5355\u7684\u4E2D\u95F4\u4EF6\n\n \u6211\u4EEC\u7684\u7B2C\u4E00\u4E2A\u4F8B\u5B50\u662F\u5199\u4E00\u4E2A\u53EA\u5141\u8BB8\u4E00\u4E2A\u57DF\u540D\u4E0B\u7684\u7528\u6237\u8BBF\u95EE\u7684\u4E2D\u95F4\u4EF6\uFF0C\u901A\u8FC7HTTP\u7684HOSTheader\u5B9E\u73B0\u3002\u8FD9\u6837\u7684\u4E2D\u95F4\u4EF6\u53EF\u4EE5\u9632\u6B62\u4E3B\u673A\u6B3A\u9A97\u653B\u51FB\u3002\n\n\u7C7B\u578B\u7684\u673A\u6784\n\n \u9996\u5148\u6211\u4EEC\u5B9A\u4E49\u4E00\u4E2A\u7ED3\u6784\u4F53\uFF0C\u53EB\u505ASingleHost\n\nGo\ntype SingleHost struct {\n    handler     http.Handler\n    allowedHost string\n}\n\n\n \u5B83\u53EA\u5305\u542B\u4E24\u4E2Afield\u3002\n \u5982\u679C\u662F\u4E00\u4E2A\u53EF\u7528\u7684Host\uFF0C\u90A3\u4E48\u6211\u4EEC\u4F1A\u8C03\u7528\u5D4C\u5165\u7684handler\u3002\n allowedHost \u5C31\u662F\u5141\u8BB8\u7684Host\u3002\n \u56E0\u4E3A\u6211\u4EEC\u5C06\u5176\u9996\u5B57\u6BCD\u5C0F\u5199\uFF0C\u56E0\u6B64\u4ED6\u4EEC\u53EA\u5BF9\u672C\u5305\u53EF\u89C1\u3002\u6211\u4EEC\u9700\u8981\u7ED9\u5B83\u5B9A\u4E49\u5DF2\u7ED9\u6784\u9020\u51FD\u6570\u3002\n\nGo\nfunc NewSingleHost(handler http.Handler, allowedHost string) *SingleHost {\n    return &amp;SingleHost{handler: handler, allowedHost: allowedHost}\n}\n\n\n\u8BF7\u6C42\u5904\u7406\n\n \u73B0\u5728\u9700\u8981\u5B9E\u73B0\u771F\u6B63\u7684\u903B\u8F91\u529F\u80FD\u4E86\u3002\u60F3\u8981\u5B9E\u73B0http.Handler\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u5B9E\u73B0\u4ED6\u7684\u4E00\u4E2A\u65B9\u6CD5\u3002\n\nGo\ntype Handler interface {\n        ServeHTTP(ResponseWriter, *Request)\n}\n\n\n \u5B9E\u73B0\u5982\u4E0B\uFF1A\n\nGo\nfunc (s *SingleHost) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    host := r.Host\n    if host == s.allowedHost {\n        s.handler.ServeHTTP(w, r)\n    } else {\n        w.WriteHeader(403)\n    }\n}\n\n\nServeHTTP\u53EA\u662F\u68C0\u67E5\u8BF7\u6C42\u7684Host\uFF1A\n \u5982\u679CHost\u548C\u914D\u7F6E\u7684allowed\u4E00\u76F4\uFF0C\u90A3\u4E48\u8C03\u7528handler\u7684ServeHTTP\u3002\n \u5982\u679C\u4E0D\u4E00\u76F4\u8FD4\u56DE403\n\u5BF9\u4E8E\u540E\u4E00\u79CD\u60C5\u51B5\uFF0C\u4E0D\u4EC5\u4E0D\u4F1A\u5F97\u5230\u5E94\u7B54\uFF0C\u8BBE\u7F6E\u4E0D\u77E5\u9053\u6709\u8FD9\u4E2A\u8BF7\u6C42\u3002\n\u73B0\u5728\u6211\u4EEC\u5DF2\u7ECF\u5F00\u53D1\u54C8\u4E86\u4E2D\u95F4\u4EF6\uFF0C\u53EA\u9700\u8981\u5C06\u5176\u63D2\u5165\u5230\u9700\u8981\u7684\u5730\u65B9\u3002\n\nGo\nsingleHosted = NewSingleHost(myHandler, &quot;example.com&quot;)\nhttp.ListenAndServe(&quot;:8080&quot;, singleHosted)\n\n\n\u53E6\u4E00\u79CD\u65B9\u5F0F\n\n \u6211\u4EEC\u521A\u521A\u5199\u7684\u90A3\u4E2A\u4E2D\u95F4\u4EF6\u5F88\u7B80\u5355\uFF0C\u5B83\u53EA\u670915\u884C\u4EE3\u7801\u3002\u5199\u8FD9\u6837\u7684\u4E2D\u95F4\u4EF6\uFF0C\u53EF\u4EE5\u4F7F\u7528\u6837\u677F\u65B9\u6CD5\u3002\u7531\u4E8EGo\u652F\u6301\u51FD\u6570\u4E3A\u4E00\u7B49\u516C\u6C11\u548C\u95ED\u5305\uFF0C\u5E76\u4E14\u6709http.HandlerFunc\u5305\u88C5\u51FD\u6570\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u4ED6\u521B\u5EFA\u4E00\u4E2A\u4E2D\u95F4\u4EF6\uFF0C\u800C\u4E0D\u662F\u5C06\u5176\u653E\u5165\u5230\u4E00\u4E2A\u7ED3\u6784\u4F53\u4E2D\u3002\u4E0B\u9762\u662F\u8FD9\u4E2A\u4E2D\u95F4\u4EF6\u7684\u5199\u6CD5\u3002\n\nGo\nfunc SingleHost(handler http.Handler, allowedHost string) http.Handler {\n    ourFunc := func(w http.ResponseWriter, r *http.Request) {\n        host := r.Host\n        if host == allowedHost {\n            handler.ServeHTTP(w, r)\n        } else {\n            w.WriteHeader(403)\n        }\n    }\n    return http.HandlerFunc(ourFunc)\n}\n\n \u6211\u4EEC\u5B9A\u4E49\u4E86\u4E00\u4E2A\u7B80\u5355\u7684\u51FD\u6570SingleHost\uFF0C\u5B83\u5305\u88C5\u4E86Handler\u548C\u5141\u8BB8\u7684Host\uFF0C\u5728\u5176\u5185\u90E8\u6211\u4EEC\u5B9E\u73B0\u4E86\u4E00\u4E2A\u8DDF\u4E0A\u9762\u4E2D\u95F4\u4EF6\u7C7B\u4F3C\u7684\u529F\u80FD\u3002\u6211\u4EEC\u5185\u90E8\u7684\u51FD\u6570\u5C31\u662F\u4E00\u4E2A\u95ED\u5305\uFF0C\u56E0\u6B64\u4ED6\u53EF\u4EE5\u8BBF\u95EE\u5916\u90E8\u51FD\u6570\u7684\u53D8\u91CF\u3002\u6700\u7EC8HandlerFunc\u8BA9\u6211\u4EEC\u53EF\u4EE5\u5C06\u5176\u53D8\u4E3AHandler\u3002\n \u89C9\u5F97\u662F\u4F7F\u7528HandlerFunc\u8FD8\u662F\u81EA\u5DF1\u5B9E\u73B0\u4E00\u4E2Ahttp.Handler\u5B8C\u5168\u53D6\u51B3\u4E8E\u4F60\u81EA\u5DF1\u3002\u5BF9\u4E8E\u7B80\u5355\u7684\u60C5\u51B5\uFF0C\u4E00\u4E2A\u7B80\u5355\u7684\u51FD\u6570\u5C31\u5B8C\u5168\u591F\u4E86\u3002\u5982\u679C\u4F60\u7684\u4E2D\u95F4\u4EF6\u8D8A\u6765\u8D8A\u591A\uFF0C\u90A3\u4E48\u5C31\u53EF\u4EE5\u8003\u8651\u5B9E\u73B0\u81EA\u5DF1\u7684\u7ED3\u6784\u5E76\u628A\u5B83\u4EEC\u5206\u5F00\u3002\n \u540C\u65F6\u6807\u51C6\u5E93\u540C\u65F6\u4F7F\u7528\u4E86\u4E24\u79CD\u529F\u80FD\u3002StripPrefix\u4F7F\u7528\u7684\u662FHandlerFunc\uFF0CTimeoutHandler\u4F7F\u7528\u7684\u662F\u81EA\u5B9A\u4E49\u7684\u7ED3\u6784\u4F53\u3002\n\n\u4E00\u4E2A\u66F4\u590D\u6742\u7684\u4F8B\u5B50\n\n \u6211\u4EEC\u7684SingleHost\u5E76\u4E0D\u91CD\u8981\uFF0C\u6211\u4EEC\u53EA\u68C0\u6D4B\u4E00\u4E2A\u5C5E\u6027\uFF0C\u8981\u4E48\u5C06\u4ED6\u4F20\u9012\u7ED9\u5176\u4ED6\u7684handler\uFF0C\u8981\u4E48\u76F4\u63A5\u8FD4\u56DE\u3002\u7136\u800C\u5B58\u5728\u8FD9\u79CD\u60C5\u51B5\uFF0C\u6211\u4EEC\u7684\u7A0B\u5E8F\u9700\u8981\u5BF9\u5904\u7406\u5B8C\u8FDB\u884C\u540E\u7EED\u5904\u7406\u3002\n\n\u6DFB\u52A0\u6570\u636E\u662F\u7B80\u5355\u7684\n\n \u5982\u679C\u53EA\u662F\u60F3\u7B80\u5355\u7684\u6DFB\u52A0\u6570\u636E\uFF0C\u90A3\u4E48\u4F7F\u7528Write\u5C31\u53EF\u4EE5\u4E86\u3002\n\n`Go\ntype AppendMiddleware struct {\n    handler http.Handler\n}\n\nfunc (a AppendMiddleware) ServeHTTP(w http.ResponseWriter, r http.Request) {\n    a.handler.ServeHTTP(w, r)\n    w.Write([]byte(&quot;Middleware says hello.&quot;))\n}\n`\n\n \u8FD4\u56DE\u7684\u7ED3\u6784\u80AF\u5B9A\u4F1A\u5305\u542BMiddleware says hello.\n\n\u95EE\u9898\n\n \u4F46\u662F\u64CD\u4F5C\u5176\u4ED6\u7684\u6570\u636E\u6709\u70B9\u56F0\u96BE\u3002\u4F8B\u5982\u6211\u4EEC\u60F3\u8981\u5728\u5B83\u524D\u9762\u6DFB\u52A0\u6570\u636E\u800C\u4E0D\u662F\u540E\u9762\u8FFD\u52A0\u3002\u5982\u679C\u6211\u4EEC\u5728\u539FHandler\u4E4B\u524D\u8C03\u7528Write\uFF0C\u90A3\u4E48\u5C06\u4F1A\u5931\u53BB\u63A7\u5236\uFF0C\u56E0\u4E3A\u7B2C\u4E00\u4E2AWrite\u5DF2\u7ECF\u5C06\u4ED6\u5199\u5165\u4E86\u3002\n \u901A\u8FC7\u5176\u4ED6\u65B9\u6CD5\u4FEE\u6539\u539F\u59CB\u8F93\u51FA\uFF0C\u4F8B\u5982\u66FF\u6362\u5B57\u7B26\u4E32\uFF0C\u6539\u53D8\u54CD\u5E94header\uFF0C\u6216\u8005\u8BBE\u7F6E\u72B6\u6001\u7801\u90FD\u4E0D\u4F1A\u8D77\u4F5C\u7528\uFF0C\u56E0\u4E3A\u5F53handler\u8FD4\u56DE\u7684\u65F6\u5019\u6570\u636E\u5DF2\u7ECF\u8FD4\u56DE\u5230\u5BA2\u6237\u7AEF\u4E86\u3002\n \u4E3A\u4E86\u5B9E\u73B0\u8FD9\u4E2A\u529F\u80FD\uFF0C\u6211\u4EEC\u9700\u8981\u4E00\u4E2A\u7279\u6B8A\u7684ResponseWriter\uFF0C\u4ED6\u53EF\u4EE5\u60F3buffer\u4E00\u6837\u5DE5\u4F5C\uFF0C\u6536\u96C6\u6570\u636E\uFF0C\u5B58\u50A8\u4EE5\u5907\u4F7F\u7528\u548C\u4FEE\u6539\u3002\u7136\u540E\u6211\u4EEC\u5C06\u8FD9\u4E2AResponseWriter\u4F20\u9012\u7ED9handler\uFF0C\u800C\u4E0D\u662F\u4F20\u9012\u771F\u662F\u7684RW\uFF0C\u8FD9\u6837\u5728\u5176\u4E4B\u524D\u6211\u4EEC\u5DF2\u7ECF\u4FEE\u6539\u4E86\u5B83\u4E86\u3002\n \u5E78\u8FD0\u7684\u662F\u5728\u6807\u51C6\u5E93\u4E2D\u6709\u8FD9\u6837\u7684\u4E00\u4E2A\u5DE5\u5177\u3002\u5728net/http/httptest\u5305\u91CC\u7684ResponseRecorder\u80FD\u505A\u6240\u6709\u6211\u4EEC\u9700\u8981\u7684\uFF1A\u4FDD\u5B58\u72B6\u6001\u7801\uFF0C\u4E00\u4E2A\u54CD\u5E94header\u7684map\uFF0C\u5C06body\u653E\u5165byte \u7F13\u51B2\u4E2D\u3002\u867D\u7136\u5B83\u662F\u518D\u6D4B\u8BD5\u4E2D\u4E2D\u4F7F\u7528\u7684\uFF0C\u4F46\u662F\u5F88\u670D\u52A1\u6211\u4EEC\u7684\u60C5\u51B5\u3002\n\n`Go\ntype ModifierMiddleware struct {\n    handler http.Handler\n}\n\nfunc (m ModifierMiddleware) ServeHTTP(w http.ResponseWriter, r http.Request) {\n    rec := httptest.NewRecorder()\n    // passing a ResponseRecorder instead of the original RW\n    m.handler.ServeHTTP(rec, r)\n    // after this finishes, we have the response recorded\n    // and can modify it before copying it to the original RW\n\n// we copy the original headers first\nfor k, v := range rec.Header() {\n    w.Header()[k] = v\n}\n// and set an additional one\nw.Header().Set(&quot;X-We-Modified-This&quot;, &quot;Yup&quot;)\n// only then the status code, as this call writes out the headers \nw.WriteHeader(418)\n\n// The body hasn&#39;t been written (to the real RW) yet,\n// so we can prepend some data.\ndata := []byte(&quot;Middleware says hello again. &quot;)\n\n// But the Content-Length might have been set already,\n// we should modify it by adding the length\n// of our own data.\n// Ignoring the error is fine here:\n// if Content-Length is empty or otherwise invalid,\n// Atoi() will return zero,\n// which is just what we&#39;d want in that case.\nclen, _ := strconv.Atoi(r.Header.Get(&quot;Content-Length&quot;))\nclen += len(data)\nr.Header.Set(&quot;Content-Length&quot;, strconv.Itoa(clen))\n\n// finally, write out our data\nw.Write(data)\n// then write out the original body\nw.Write(rec.Body.Bytes())\n\n}\n`\n\u6700\u540E\u50F5\u5C38\u6211\u4EEC\u4E2D\u95F4\u4EF6\u7684\u8F93\u51FA\uFF1A\n\n`\nHTTP/1.1 418 I&#39;m a teapot\nX-We-Modified-This: Yup\nContent-Type: text/plain; charset=utf-8\nContent-Length: 37\nDate: Tue, 03 Sep 2013 18:41:39 GMT\n\nMiddleware says hello again. Success!\n`\n\u8FD9\u6837\u5C31\u5F00\u542F\u4E86\u4E00\u79CD\u65B0\u7684\u53EF\u80FD\uFF0C\u5305\u88C5\u7684handler\u5B8C\u5168\u624B\u63A7\u5236\u3002\n\n\u548C\u5176\u4ED6handler\u5206\u4EAB\u6570\u636E\n\n \u5728\u5176\u4ED6\u4F8B\u5B50\u4E2D\uFF0C\u4E2D\u95F4\u4EF6\u53EF\u80FD\u9700\u8981\u66B4\u9732\u4E00\u4E9B\u4FE1\u606F\u7ED9\u5176\u4ED6\u4E2D\u95F4\u4EF6\u6216\u8005\u5E94\u7528\u672C\u8EAB\u3002\u4F8B\u5982nosurf\u9700\u8981\u7ED9\u5176\u4ED6\u7528\u6237\u8BBF\u95EECSRF token\u7684\u6743\u9650\u3002\n \u6700\u7B80\u5355\u662F\u662F\u4F7F\u7528\u4E00\u4E2Amap\uFF0C\u4F46\u662F\u901A\u5E38\u4E0D\u5E0C\u671B\u8FD9\u6837\u3002\u5B83\u5C06http.Request \u7684\u6307\u9488\u4F5C\u4E3Akey\uFF0C\u5176\u4ED6\u6570\u636E\u4F5C\u4E3Avalue\u3002\u4E0B\u9762\u662Fnosurf\u7684\u4F8B\u5B50\uFF0CGo\u7684map\u975E\u7EBF\u7A0B\u5B89\u5168\uFF0C\u6240\u4EE5\u8981\u81EA\u5DF1\u662F\u5B9E\u73B0\u3002\n\n`Go\ntype csrfContext struct {\n    token string\n    reason error\n}\n\nvar (\n    contextMap = make(map[http.Request]csrfContext)\n    cmMutex    = new(sync.RWMutex)\n)\n`\n \u6570\u636E\u7531Token\u8BBE\u7F6E\uFF1A\n\n`Go\nfunc Token(req *http.Request) string {\n    cmMutex.RLock()\n    defer cmMutex.RUnlock()\n\nctx, ok := contextMap[req]\nif !ok {\n        return &quot;&quot;\n}\n\nreturn ctx.token\n\n}\n`\n\u6E90\u7801\u53EF\u4EE5\u518Dnosurf\u7684\u9879\u76EE\u7684context.go\u4E2D\u627E\u5230\u3002','readingtime':11,'url':'/cates/Backend/post/2015-11-12/develop-HTTP-middleware-using-Go','dirs':['go'],'relatives':[{'url':'/cates/Backend/post/2015-11-11/Go-Web-architecture','title':'Go Web \u67B6\u6784'},{'url':'/cates/Backend/post/2015-11-12/HTTP-2-And-GO','title':'HTTP/2 \u548CGO'},{'url':'/cates/Backend/post/2015-11-15/create-a-homepage-for-Go-Web-App','title':'\u4E3AGo Web App \u521B\u5EFA\u4E00\u4E2A\u4E3B\u9875\u9762'},{'url':'/cates/Backend/post/2015-11-13/http-Handler-And-Go-error-handle','title':'http.Handler \u4E0EGo\u7684\u9519\u8BEF\u5904\u7406'}]},{'title':'http.Handler \u4E0EGo\u7684\u9519\u8BEF\u5904\u7406','iso8601Date':'2015-11-13T05:24:57+08:00','basename':'http-Handler-And-Go-error-handle','cover':'https://coding.net/u/shjie047/p/images/git/raw/master/stock-photo-186674453.jpg','tags':['Go','Translate','Backend'],'date':'2015-11-13','cate':'Backend','summary':'\u539F\u6587\u5730\u5740\n\n \u5728\u4E4B\u524D\u6211\u5199\u8FC7\u4E00\u7BC7\u5173\u4E8E\u901A\u8FC7\u4F7F\u7528http.HandlerFunc\u6765\u5B9E\u73B0\u4E00\u4E2A\u5B9A\u5236handler\u7C7B\u578B\u7528\u6765\u907F\u514D\u4E00\u4E9B\u5E73\u5E38\u7684\u9519\u8BEF\u7684\u6587\u7AE0\u3002func MyHandler(w http.ResponseWriter, r *http.Request)\u7684\u7B7E\u540D\u7ECF\u5E38\u53EF\u4EE5\u770B\u5230\u3002\u8FD9\u662F\u4E00\u4E2A\u6709\u7528\u7684\u901A\u7528\u7684\u5305\u542B\u4E00\u4E9B\u57FA\u672C\u529F\u80FD\u7684handler\u7C7B\u578B\uFF0C\u4F46\u662F\u548C\u5176\u4ED6\u4E8B\u60C5\u4E00\u6837\uFF0C\u4E5F\u6709\u4E00\u4E9B\u4E0D\u8DB3\uFF1A\n \u5F53\u4F60\u60F3\u8981\u5728\u4E00\u4E2Ahandler\u4E2D\u505C\u6B62\u5904\u7406\u7684\u65F6\u5019\uFF0C\u5FC5\u987B\u8BB0\u5F97\u663E\u793A\u7684\u8C03\u7528\u4E00\u4E2Areturn\u3002\u8FD9\u4E2A\u5728\u5F53\u4F60\u60F3\u8981\u8DD1\u51FA\u4E00\u4E2A\u4ECE\u5B9A\u5411\uFF08301\u3001302\uFF09\uFF0C\u672A\u627E\u5230\uFF08404\uFF09\u6216\u8005\u670D\u52A1\u5668\u7AEF\u9519\u8BEF\uFF08500\uFF09\u7684\u72B6\u6001\u7684\u65F6\u5019\u662F\u5F88\u5E73\u5E38\u7684\u3002\u5982\u679C\u4E0D\u8FD9\u4E48\u505A\u53EF\u80FD\u4F1A\u5F15\u8D77\u4E00\u4E9B\u5FAE\u5999\u7684\u9519\u8BEF\uFF08\u51FD\u6570\u4F1A\u7EE7\u7EED\u6267\u884C\uFF09\uFF0C\u56E0\u4E3A\u51FD\u6570\u4E0D\u9700\u8981\u4E00\u4E2A\u8FD4\u56DE\u503C\uFF0C\u7F16\u8BD1\u5668\u4E5F\u4E0D\u4F1A\u8B66\u544A\u4F60\u3002\n \u4E0D\u5BB9\u6613\u4F20\u9012\u989D\u5916\u7684\u53C2\u6570\uFF08\u4F8B\u5982\uFF0C\u6570\u636E\u5E93\u8FDE\u63A5\u6C60\uFF0C\u914D\u7F6E\uFF09\u3002\u4F60\u6700\u540E\u4E0D\u5F97\u4E0D\u5B9E\u7528\u4E00\u7CFB\u5217\u7684\u5168\u5C40\u53D8\u91CF\uFF08\u4E0D\u7B97\u592A\u574F\uFF0C\u4F46\u662F\u8DDF\u8E2A\u4ED6\u4EEC\u4F1A\u5BFC\u81F4\u96BE\u4EE5\u6269\u5C55\uFF09\u6216\u8005\u5C06\u4ED6\u4EEC\u5B58\u5230\u8BF7\u6C42\u4E0A\u4E0B\u6587\u4E2D\uFF0C\u7136\u540E\u6BCF\u6B21\u90FD\u4ECE\u5176\u53D6\u51FA\u3002\u8FD9\u6837\u505A\u5F88\u7B28\u91CD\u3002\n* \u4E00\u76F4\u5728\u4E0D\u65AD\u7684\u91CD\u590D\u540C\u6837\u7684\u8BED\u53E5\u3002\u60F3\u8981\u8BB0\u5F55\u6570\u636E\u5E93\u5305\u8FD4\u56DE\u7684\u9519\u8BEF\uFF1F\u65E2\u53EF\u4EE5\u518D\u6BCF\u4E2A\u67E5\u8BE2\u65B9\u6CD5\u4E2D\u8C03\u7528log.Printf\uFF0C\u4E5F\u53EF\u4EE5\u518D\u6BCF\u4E2Ahandler\u4E2D\u8FD4\u56DE\u9519\u8BEF\u3002\u5982\u679C\u4F60\u7684handler\u53EF\u4EE5\u8FD4\u56DE\u7ED9\u4E00\u4E2A\u96C6\u4E2D\u8BB0\u5F55\u9519\u8BEF\u7684\u51FD\u6570\uFF0C\u5E76\u4E14\u8DD1\u51FA\u4E00\u4E2A500\u7684\u9519\u8BEF\u5C31\u66F4\u597D\u4E86\u3002\n\n \u6211\u4EE5\u524D\u7684\u65B9\u6CD5\u4E2D\u4F7F\u7528\u4E86func(http.ResponseWriter, *http.Request)\u7B7E\u540D\u3002\u8FD9\u5DF2\u7ECF\u88AB\u8BC1\u660E\u662F\u4E00\u4E2A\u7B80\u4ECB\u7684\u65B9\u5F0F\uFF0C\u4F46\u662F\u6709\u4E2A\u5947\u602A\u7684\u5730\u65B9\u662F\uFF0C\u8FD4\u56DE\u4E00\u4E2A\u65E0\u9519\u8BEF\u7684\u72B6\u6001\uFF0C\u4F8B\u5982\uFF0C200,302,303\u5F80\u5F80\u662F\u591A\u4F59\u7684\uFF0C\u56E0\u4E3A\u8981\u4E48\u4F60\u5DF2\u7ECF\u5728\u5176\u4ED6\u5730\u65B9\u8BBE\u7F6E\u4E86\uFF0C\u8981\u4E48\u5C31\u662F\u6CA1\u7528\u7684\u3002\u4F8B\u5982\uFF1A\n\n`Go\nfunc SomeHandler(w http.ResponseWriter, r *http.Request) (int, error) {\n    db, err := someDBcall()\n    if err != nil {\n        // This makes sense.\n        return 500, err\n    }\n\nif user.LoggedIn {\n    http.Redirect(w, r, &quot;/dashboard&quot;, 302)\n    // Superfluous! Our http.Redirect function handles the 302, not \n    // our return value (which is effectively ignored).\n    return 302, nil\n}\n\n}\n`\n\n\u770B\u8D77\u6765\u8FD8\u884C\uFF0C\u4F46\u662F\u6211\u4EEC\u53EF\u4EE5\u505A\u7684\u66F4\u597D\n\n\u4E00\u4E9B\u533A\u522B\n\n \u90A3\u4E48\u6211\u4EEC\u5E94\u8BE5\u5982\u4F55\u6539\u8FDB\u5B83\uFF1F\u6211\u4EEC\u5148\u5217\u51FA\u4EE3\u7801\uFF1A\n\n`Go\npackage handler\n\n// Error represents a handler error. It provides methods for a HTTP status \n// code and embeds the built-in error interface.\ntype Error interface {\n    error\n    Status() int\n}\n\n// StatusError represents an error with an associated HTTP status code.\ntype StatusError struct {\n    Code int\n    Err  error\n}\n\n// Allows StatusError to satisfy the error interface.\nfunc (se StatusError) Error() string {\n    return se.Err.Error()\n}\n\n// Returns our HTTP status code.\nfunc (se StatusError) Status() int {\n    return se.Code\n}\n\n// A (simple) example of our application-wide configuration.\ntype Env struct {\n    DB   *sql.DB\n    Port string\n    Host string\n}\n\n// The Handler struct that takes a configured Env and a function matching\n// our useful signature.\ntype Handler struct {\n    Env\n    H func(e Env, w http.ResponseWriter, r *http.Request) error\n}\n\n// ServeHTTP allows our Handler type to satisfy http.Handler.\nfunc (h Handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    err := h.H(h.Env, w, r)\n    if err != nil {\n        switch e := err.(type) {\n        case Error:\n            // We can retrieve the status here and write out a specific\n            // HTTP status code.\n            log.Printf(&quot;HTTP %d - %s&quot;, e.Status(), e)\n            http.Error(w, e.Error(), e.Status())\n        default:\n            // Any error types we don&#39;t specifically look out for default\n            // to serving a HTTP 500\n            http.Error(w, http.StatusText(http.StatusInternalServerError),\n                http.StatusInternalServerError)\n        }\n    }\n}\n`\n\n \u4E0A\u9762\u7684\u4EE3\u7801\u4E0D\u8A00\u81EA\u660E\uFF0C\u4F46\u662F\u8981\u8BF4\u660E\u4E00\u4E0B\u4E00\u4E9B\u7A81\u51FA\u7684\u89C2\u70B9\uFF1A\n\n\u6211\u4EEC\u81EA\u5B9A\u4E49\u4E86\u4E00\u4E2AError\u7C7B\u578B\uFF08\u63A5\u53E3\uFF09\uFF0C\u4ED6\u5185\u5D4C\u4E86Go\u7684\u5185\u5EFA\u7684error\u63A5\u53E3\uFF0C\u540C\u65F6\u63D0\u4F9B\u4E86\u4E00\u4E2AStatus() int\u65B9\u6CD5\u3002\u6211\u4EEC\u63D0\u4F9B\u4E86\u4E00\u4E2A\u7B80\u5355\u7684StatusError\u7C7B\u578B\uFF08\u7ED3\u6784\u4F53\uFF09\uFF0C\u5B83\u6EE1\u8DB3handler.Error\u7684\u63A5\u53E3\u3002StatusError\u63A5\u53D7\u4E00\u4E2AHTTP\u7684\u72B6\u6001\u7801\uFF08int\u7C7B\u578B\uFF09\uFF0C\u4E00\u4E2A\u53EF\u4EE5\u8BA9\u6211\u4EEC\u5305\u88C5\u9519\u8BEF\u7528\u6765\u8BB0\u5F55\u6216\u8005\u67E5\u8BE2\u7684error\u7C7B\u578B\u3002\u6211\u4EEC\u7684ServeHTTP\u65B9\u6CD5\u5305\u597D\u4E86\u4E00\u4E2A&quot;e := err.(type)&quot;\u7684\u7C7B\u578B\u65AD\u8A00\uFF0C\u5B83\u53EF\u4EE5\u6D4B\u8BD5\u6211\u4EEC\u9700\u8981\u5904\u7406\u7684\u9519\u8BEF\uFF0C\u5141\u8BB8\u6211\u4EEC\u5904\u7406\u90A3\u4E9B\u7279\u522B\u7684\u9519\u8BEF\u3002\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u4ED6\u662F\u53EA\u662F\u4E00\u4E2Ahandler.Error\u7C7B\u578B\u3002\u5176\u4ED6\u7684\u9519\u8BEF\uFF0C\u4F8B\u5982\u5176\u4ED6\u5305\u4E2D\u7684\u9519\u8BEF\u60F3net.Error\uFF0C\u6216\u8005\u5176\u4ED6\u6211\u4EEC\u5B9A\u4E49\u7684\u989D\u5916\u7684\u9519\u8BEF\uFF0C\u5982\u679C\u60F3\u8981\u68C0\u67E5\uFF0C\u540C\u6837\u4E5F\u53EF\u4EE5\u68C0\u67E5\u3002\u5982\u679C\u6211\u4EEC\u4E0D\u60F3\u6355\u6349\u90A3\u4E9B\u9519\u8BEF\uFF0C\u90A3\u4E48default\u5C06\u4F1A\u9ED8\u8BA4\u6355\u6349\u5230\u3002\u8BB0\u4F4F\u4E00\u70B9\uFF0CServeHTTP\u53EF\u4EE5\u4F7F\u6211\u4EEC\u7684Handler\u7C7B\u578B\u6EE1\u8DB3http.Handler\u63A5\u53E3\uFF0C\u8FD9\u6837\u4ED6\u5C31\u53EF\u4EE5\u5728\u4EFB\u4F55\u4F7F\u7528http.Handler\u7684\u5730\u65B9\u4F7F\u7528\u4E86\uFF0C\u4F8B\u5982Go\u7684net/http\u5305\u6216\u8005\u6240\u6709\u7684\u5176\u4ED6\u7684\u7B2C\u4E09\u65B9\u6846\u67B6\u3002\u8FD9\u6837\u4F7F\u5F97\u5B9A\u5236\u7684handler\u66F4\u6709\u7528\uFF0C\u4ED6\u4EEC\u7528\u8D77\u6765\u5F88\u7075\u6D3B\u3002\n\u6CE8\u610F net \u5305\u5904\u7406\u4E8B\u60C5\u5F88\u7B80\u5355\u3002\u5B83\u53C8\u4E00\u4E2Anet.Error\u7684\u63A5\u53E3\uFF0C\u5185\u5D4C\u4E86\u5185\u5EFA\u7684error\u63A5\u53E3\u3002\u4E00\u4E9B\u5177\u4F53\u7684\u7C7B\u578B\u5B9E\u73B0\u4E86\u5B83\u3002\u51FD\u6570\u8FD4\u56DE\u7684\u5177\u4F53\u7C7B\u578B\u8DDF\u9519\u8BEF\u7684\u7C7B\u578B\u76F8\u540C\uFF08DNS\u9519\u8BEF\uFF0C\u89E3\u6790\u9519\u8BEF\u7B49\uFF09\u3002\u518Ddatastore \u5305\u4E2D\u5B9A\u4E49\u7684DBError\u6709\u4E00\u4E2AQuery() string \u65B9\u6CD5\uFF0C\u53EF\u4EE5\u5F88\u597D\u7684\u89E3\u91CA\u3002\n\n\u6240\u6709\u793A\u4F8B\n\n \u5B83\u6700\u540E\u662F\u4EC0\u4E48\u6837\u5B50\u7684\uFF1F\u6211\u4EEC\u662F\u5426\u53EF\u4EE5\u5C06\u5176\u5206\u5230\u4E0D\u540C\u7684\u5305\u4E2D\uFF1F\n\n`Go\npackage handler\n\nimport (\n    &quot;net/http&quot;\n)\n\n// Error represents a handler error. It provides methods for a HTTP status \n// code and embeds the built-in error interface.\ntype Error interface {\n    error\n    Status() int\n}\n\n// StatusError represents an error with an associated HTTP status code.\ntype StatusError struct {\n    Code int\n    Err  error\n}\n\n// Allows StatusError to satisfy the error interface.\nfunc (se StatusError) Error() string {\n    return se.Err.Error()\n}\n\n// Returns our HTTP status code.\nfunc (se StatusError) Status() int {\n    return se.Code\n}\n\n// A (simple) example of our application-wide configuration.\ntype Env struct {\n    DB   *sql.DB\n    Port string\n    Host string\n}\n\n// The Handler struct that takes a configured Env and a function matching\n// our useful signature.\ntype Handler struct {\n    Env\n    H func(e Env, w http.ResponseWriter, r *http.Request) error\n}\n\n// ServeHTTP allows our Handler type to satisfy http.Handler.\nfunc (h Handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    err := h.H(h.Env, w, r)\n    if err != nil {\n        switch e := err.(type) {\n        case Error:\n            // We can retrieve the status here and write out a specific\n            // HTTP status code.\n            log.Printf(&quot;HTTP %d - %s&quot;, e.Status(), e)\n            http.Error(w, e.Error(), e.Status())\n        default:\n            // Any error types we don&#39;t specifically look out for default\n            // to serving a HTTP 500\n            http.Error(w, http.StatusText(http.StatusInternalServerError),\n                http.StatusInternalServerError)\n        }\n    }\n}\n\nfunc GetIndex(env Env, w http.ResponseWriter, r http.Request) error {\n    users, err := env.DB.GetAllUsers()\n    if err != nil {\n        // We return a status error here, which conveniently wraps the error\n        // returned from our DB queries. We can clearly define which errors \n        // are worth raising a HTTP 500 over vs. which might just be a HTTP \n        // 404, 403 or 401 (as appropriate). It&#39;s also clear where our \n        // handler should stop processing by returning early.\n        return StatusError{500, err}\n    }\n\nfmt.Fprintf(w, &quot;%+v&quot;, users)\nreturn nil\n\n}\n`\n\n main\u5305\uFF1A\n\n`Go\npackage main\n\nimport (\n    &quot;net/http&quot;\n    &quot;github.com/you/somepkg/handler&quot;\n)\n\nfunc main() {\n    db, err := sql.Open(&quot;connectionstringhere&quot;)\n    if err != nil {\n          log.Fatal(err)\n    }\n\n// Initialise our app-wide environment with the services/info we need.\nenv := &amp;handler.Env{\n    DB: db,\n    Port: os.Getenv(&quot;PORT&quot;),\n    Host: os.Getenv(&quot;HOST&quot;),\n    // We might also have a custom log.Logger, our \n    // template instance, and a config struct as fields \n    // in our Env struct.\n}\n\n// Note that we&#39;re using http.Handle, not http.HandleFunc. The \n// latter only accepts the http.HandlerFunc type, which is not \n// what we have here.\nhttp.Handle(&quot;/&quot;, handler.Handler{env, handler.GetIndex})\n\n// Logs the error if ListenAndServe fails.\nlog.Fatal(http.ListenAndServe(&quot;:8000&quot;, nil))\n\n}\n`\n\n \u5728\u5B9E\u9645\u4F7F\u7528\u65F6\uFF0C\u4F1A\u5C06handler\u548CEnv\u653E\u5165\u4E0D\u540C\u7684\u5305\u4E2D\uFF0C\u8FD9\u91CC\u53EA\u662F\u4E3A\u4E86\u7B80\u5355\u653E\u5728\u4E86\u540C\u4E00\u4E2A\u5305\u4E2D\u3002','readingtime':11,'url':'/cates/Backend/post/2015-11-13/http-Handler-And-Go-error-handle','dirs':['go'],'relatives':[{'url':'/cates/Backend/post/2015-11-11/Go-Web-architecture','title':'Go Web \u67B6\u6784'},{'url':'/cates/Backend/post/2015-11-12/HTTP-2-And-GO','title':'HTTP/2 \u548CGO'},{'url':'/cates/Backend/post/2015-11-15/create-a-homepage-for-Go-Web-App','title':'\u4E3AGo Web App \u521B\u5EFA\u4E00\u4E2A\u4E3B\u9875\u9762'},{'url':'/cates/Backend/post/2015-11-12/develop-HTTP-middleware-using-Go','title':'\u4F7F\u7528Go\u5F00\u53D1HTTP\u4E2D\u95F4\u4EF6'}]},{'title':'\u4E3AGo Web App \u521B\u5EFA\u4E00\u4E2A\u4E3B\u9875\u9762','iso8601Date':'2015-11-15T01:59:00+08:00','basename':'create-a-homepage-for-Go-Web-App','cover':'https://coding.net/u/shjie047/p/images/git/raw/master/stock-photo-252035635.jpg','tags':['Go','Translate','Backend'],'date':'2015-11-15','cate':'Backend','summary':'\u539F\u6587\u5730\u5740\n\n \u5927\u591A\u6570web app\u90FD\u6709\u4E00\u4E2A\u76F8\u540C\u7684\u5E03\u5C40\u3002\u8FD9\u4E2A\u5E03\u5C40\u53EF\u80FD\u5305\u542B\u4E00\u4E2Aheader\u6216\u8005footer\uFF0C\u751A\u81F3\u53EF\u80FD\u5305\u542B\u4E00\u4E2A\u5BFC\u822A\u83DC\u5355\u3002Go\u7684\u6807\u51C6\u5E93\u63D0\u4F9B\u4E00\u4E2A\u7B80\u5355\u7684\u65B9\u5F0F\u6765\u521B\u5EFA\u8FD9\u4E9B\u57FA\u672C\u5143\u7D20\uFF0C\u901A\u8FC7\u88AB\u4E0D\u540C\u7684\u9875\u9762\u91CD\u7528\uFF0C\u521B\u5EFA\u51FA\u6A21\u677F\u9875\u7684\u6548\u679C\u3002\n \u8FD9\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50\u6765\u89E3\u91CA\u5982\u4F55\u5B9E\u73B0\u7684\uFF1A\n \u8BA9\u6211\u4EEC\u6765\u521B\u5EFA\u4E00\u4E2A\u7B80\u5355\u7684\u5305\u542B\u4E24\u4E2Aview\u7684web app\uFF0C\u4E00\u4E2A\u662F main \u4E00\u4E2A\u662Fabout\u3002\u8FD9\u4E24\u4E2Aview\u90FD\u6709\u76F8\u540C\u7684header\u548Cfooter\u3002\n header\u6A21\u677F\u7684\u4EE3\u7801\u5982\u4E0B\uFF1A\n\nhtml\n{ { define &quot;header&quot; }}\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;{ {.Title}}&lt;/title&gt;\n        &lt;link rel=&quot;stylesheet&quot; href=&quot;//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;&gt;\n        &lt;link rel=&quot;stylesheet&quot; href=&quot;//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css&quot;&gt;\n        &lt;style type=&quot;text/css&quot;&gt;\n            body {padding-bottom: 70px;}\n            .content {margin:10px;}\n        &lt;/style&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;nav class=&quot;navbar navbar-default&quot; role=&quot;navigation&quot;&gt;\n          &lt;div class=&quot;navbar-header&quot;&gt;\n            &lt;a class=&quot;navbar-brand&quot; href=&quot;/&quot;&gt;Go App&lt;/a&gt;\n          &lt;/div&gt;\n          &lt;div class=&quot;collapse navbar-collapse navbar-ex1-collapse&quot;&gt;  \n            &lt;ul class=&quot;nav navbar-nav&quot;&gt;\n                &lt;li&gt;&lt;a href=&quot;/&quot;&gt;Main&lt;/a&gt;&lt;/li&gt;\n                &lt;li&gt;&lt;a href=&quot;/about&quot;&gt;About&lt;/a&gt;&lt;/li&gt;\n            &lt;/ul&gt;\n          &lt;/div&gt;\n        &lt;/nav&gt;\n{ { end }}\n\n\n footer\u6A21\u677F\u7684\u4EE3\u7801\u5982\u4E0B\uFF1A\n\n`html\n{ { define &quot;footer&quot; }}\n        &lt;p class=&quot;navbar-text navbar-fixed-bottom&quot;&gt;Go Rocks!&lt;/p&gt;          &lt;script src=&quot;//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n{ { end }}\n\n`\n\n main \u6A21\u677F\u7684\u4EE3\u7801\u5982\u4E0B\uFF1A\n\nhtml\n{ {define &quot;main&quot;}}\n{ { template &quot;header&quot; .}}\n&lt;div class=&quot;content&quot;&gt;\n    &lt;h2&gt;Main&lt;/h2&gt;\n    &lt;div&gt;This is the Main page&lt;/div&gt;\n&lt;/div&gt;\n{ {template &quot;footer&quot; .}}\n{ { end}}\n\n\n about \u6A21\u677F\u7684\u4EE3\u7801\u5982\u4E0B\uFF1A\n\nhtml\n{ {define &quot;about&quot;}}\n{ { template &quot;header&quot; .}}\n&lt;div class=&quot;content&quot;&gt;\n    &lt;h2&gt;About&lt;/h2&gt;\n    &lt;div&gt;This is the About page&lt;/div&gt;\n&lt;/div&gt;\n{ {template &quot;footer&quot; .}}\n{ { end}}\n\n\n \u670D\u52A1\u5668\u4EE3\u7801\u5982\u4E0B\uFF1A\n\n`Go\npackage main\n\nimport (\n    &quot;html/template&quot;\n    &quot;net/http&quot;\n)\n\n//Compile templates on start\nvar templates = template.Must(template.ParseFiles(&quot;header.html&quot;, &quot;footer.html&quot;, &quot;main.html&quot;, &quot;about.html&quot;))\n\n//A Page structure\ntype Page struct {\n    Title string\n}\n\n//Display the named template\nfunc display(w http.ResponseWriter, tmpl string, data interface{}) {\n    templates.ExecuteTemplate(w, tmpl, data)\n}\n\n//The handlers.\nfunc mainHandler(w http.ResponseWriter, r *http.Request) {\n    display(w, &quot;main&quot;, &amp;Page{Title: &quot;Home&quot;})\n}\n\nfunc aboutHandler(w http.ResponseWriter, r *http.Request) {\n    display(w, &quot;about&quot;, &amp;Page{Title: &quot;About&quot;})\n}\n\nfunc main() {\n    http.HandleFunc(&quot;/&quot;, mainHandler)\n    http.HandleFunc(&quot;/about&quot;, aboutHandler)\n\n//Listen on port 8080\nhttp.ListenAndServe(&quot;:8080&quot;, nil)\n\n}\n`\n\n \u6BCF\u4E00\u4E2A\u6A21\u677F\u9875\u90FD\u6709\u4E00\u4E2A { { define &quot;name&quot; }}\u7684\u547D\u4EE4\u6765\u5B9A\u4E49\u6A21\u677F\u7684\u540D\u5B57\u3002main\u548Cabout\u9875\u9762\u901A\u8FC7{ { template &quot;name&quot; }}\u6765\u5305\u542Bheader\u548Cfooter\u3002. \u51FA\u5165\u4E0A\u4E0B\u6587\u6765\u547D\u540D\u6A21\u677F\u3002\u73B0\u5728\uFF0C\u4E0D\u7BA1main\u548Cabout\u9875\u9762\u5982\u4F55\u6267\u884C\uFF0C\u4ED6\u4EEC\u7684\u9875\u9762\u90FD\u4F1A\u5305\u542Bheader\u548Cfooter\u3002\n \u4E24\u4E2A\u9875\u9762\u7684\u7ED3\u679C\u5982\u4E0B\uFF1A\n\n  ','readingtime':6,'url':'/cates/Backend/post/2015-11-15/create-a-homepage-for-Go-Web-App','dirs':['go'],'relatives':[{'url':'/cates/Backend/post/2015-11-11/Go-Web-architecture','title':'Go Web \u67B6\u6784'},{'url':'/cates/Backend/post/2015-11-12/HTTP-2-And-GO','title':'HTTP/2 \u548CGO'},{'url':'/cates/Backend/post/2015-11-12/develop-HTTP-middleware-using-Go','title':'\u4F7F\u7528Go\u5F00\u53D1HTTP\u4E2D\u95F4\u4EF6'},{'url':'/cates/Backend/post/2015-11-13/http-Handler-And-Go-error-handle','title':'http.Handler \u4E0EGo\u7684\u9519\u8BEF\u5904\u7406'}]}],'tag':'Go','tags':['Vagrant','Translate','Backend','Ansible','Go','Architecture','Web','Http','HTTP/2','HTTP','Middleware','Java','OKHttp','Mybatis','CPU','Linux','Dartlang','Dart','Flutter','CrossPlatform','Mobile','JS','Javascript','Frontend','NodeJS','Node','NPM','JSON','Jackson','ECMAScript','ECMAScript2016','ECMAScript2017','ECMAScript2018','ES6','ES7','Async','Await','Async/Await','Java8','APM','Performance','Spring','SpringMVC','Hyperapp','React']},'siteData':{'title':'\u4EE3\u7801\u62FE\u9057'}};</script><script defer="" type="text/javascript" src="https://shjie047.github.io/bootstrap.20edb0ba.js"></script><script defer="" type="text/javascript" src="https://shjie047.github.io/templates/src/containers/Tag.dc3ab84b.js"></script><script defer="" type="text/javascript" src="https://shjie047.github.io/main.9de66d54.js"></script></body></html>
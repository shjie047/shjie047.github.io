<!DOCTYPE html><html lang="en" data-reactroot=""><head><title data-react-helmet="true">代码拾遗 - 更懂代码的媒体</title><meta data-react-helmet="true" name="title" content="代码拾遗 - 更懂代码的媒体"/><meta data-react-helmet="true" property="og:description" content="简介

同许多其他的web框架一样，SpringMVC使用了前端控制器的设计模式，即一个以DispatcherServlet为核心的Servlet为处理请求提供了一个共享的算法，而实际的工作是由可配..."/><meta data-react-helmet="true" property="og:title" content="SpringMVC 教程 - DispatcherServlet"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="description" content="简介

同许多其他的web框架一样，SpringMVC使用了前端控制器的设计模式，即一个以DispatcherServlet为核心的Servlet为处理请求提供了一个共享的算法，而实际的工作是由可配..."/><meta data-react-helmet="true" name="keywords" content="Backend,Java,SpringMVC,Spring"/><link rel="preload" as="script" href="https://shjie047.github.io/bootstrap.aa1508cb.js"/><link rel="preload" as="script" href="https://shjie047.github.io/templates/src/containers/Post.dc601368.js"/><link rel="preload" as="script" href="https://shjie047.github.io/main.6c3a4af7.js"/><link rel="preload" as="style" href="https://shjie047.github.io/styles.a90d508c.css"/><link rel="stylesheet" href="https://shjie047.github.io/styles.a90d508c.css"/><link data-react-helmet="true" rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAABe3PX/Y972/2nf9v9v4Pb/cuD3/3bh9/954fj/e+L4/3ri+f954fj/duH3/3Lg9/9u4Pb/ad/1/2Td9v9d3PX/ZN32/2rf9v9w4Pf/duH3/3vi+P9/4/f/geT4/4Pk+P+C5Pj/guT4/3/j+P964vj/duH4/3Hg9/9r3/b/ZN32/2re9v9x4Pb/d+H4/37j+P+D5fb/h+b2/4vm9/+M5vf/jOb3/4vm9v+H5vb/g+X3/37j9/944ff/ceD2/2nf9/9v4Pb/deH3/37j9/+F5fj/i+X5/4/n+P+U5/n/luj5/5bo+f+V6Pj/j+b4/4vl+P+F5Pj/fuP4/3Xh9/9v4Pf/cuD2/3vi+P+C5Pj/iub4/5Hn+P+Y6fn/nOn6/5/p+/+f6vr/nen6/5no+v+S5vn/iuT4/4Pk+f954/f/ceD3/3fh9/+A4/j/iOX4/5Dm9v+Y6fr/nun5/6Pr+f+m6fj/p+v6/6Pp+P+e6fn/mOv6/5Hp+f+I5ff/gOP3/3bh9/954ff/g+T3/4rk9/+Y7fv/nOf2/6fu+/+x8Pn/ufj9/7Px+f+y9f3/qfP//5fh7/+N3+//jej5/4Lk9/964fj/eeH4/4Pj9v+Q7f//g8fW/2qWn/98qbP/aoWM/3OQl/9tiI7/cY+X/2OCif+Iv8n/ebXD/5Hv//+C4vb/eeH5/3rh+P+D4vX/k/L//3Ssuv9ihY7/d5+p/2eEiv92lJr/VGdp/2yMkf9ffIL/jcrW/3y9y/+P7P7/g+P3/3ri+P954fj/guT3/4rl+P+V6vr/f7zJ/5zc5f+w8f3/vvv//5LByv+p5/D/qvT//5/s+/+U6fv/i+X4/4Hk+P944fj/d+H3/4Dj+P+H5ff/j+b4/57z//+h7vv/o+r5/6bp+P+u9P7/puz6/57o+f+X6Pn/j+b4/4fl+P9/4/j/duH3/3Lg9/984vj/hOT4/4rm+P+Q5fb/l+j4/5zq+v+f6vr/nen4/5zp+f+Y6fn/kef4/4rm+P+D5ff/e+P3/3Pg9v9v3/b/duH3/37j+P+F5Pj/iuX6/4/m+f+U6Pj/luj5/5bp+f+T6Pj/kOb4/4vl+P+E5fj/feP4/3bh+P9v3/f/ad/2/3Dg9/934ff/fuP3/4Tk9/+I5ff/iuX4/4zl+f+N5fr/iuX4/4fl+P+E5Pj/f+P3/3fi9/9w4Pb/ad/2/2Pe9v9q3/b/cOD3/3Xh9/974vf/gOP3/4Lk+P+D5Pj/hOT4/4Lk+P9/4/j/e+L3/3bh9/9x4Pf/at/2/2Td9v9e3PX/Zd32/2re9v9u4Pb/cuD3/3fh9/954fj/euH4/3nh+P944fj/deH3/3Ph9v9v3/f/at72/2Td9v9d3Pb/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><style data-styled-components="enNFoQ fJTUOz jvzENE AjcTS ljxEMT gjHXKT hAbzAj fvIFII jUVlgh dOpkjW febhlo">
/* sc-component-id: sc-bdVaJa */
.AjcTS{position:absolute;width:100%;} .AjcTS.fixed{position:fixed;background:#fff;top:-65px;z-index:800;border-bottom:1px solid #e1e1e1;} .AjcTS .logo{background-image:url(https://shjie047.github.io/static/logo.2b22c228.png);} .AjcTS.frontend,.AjcTS.frontend > *{background-color:#108db8!important;} .AjcTS.backend,.AjcTS.backend > *{background-color:rgba(0,100,0,1)!important;} .AjcTS.mobile,.AjcTS.mobile > *{background-color:rgb(219,112,147)!important;} .AjcTS.mobile nav a,.AjcTS.frontend nav a,.AjcTS.backend nav a{color:#fff;} .AjcTS.mobile .logo,.AjcTS.frontend .logo,.AjcTS.backend .logo{background-image:url(https://shjie047.github.io/static/codemore_white.2439fcc8.png);}
/* sc-component-id: sc-bwzfXH */
.gjHXKT{height:50px;max-width:1000px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:#fff;} .gjHXKT.fixed{position:fixed;left:0;right:0;top:0;border-bottom:1px solid #f1f1f1;} .gjHXKT.showBorder{border-bottom:1px solid #e7e7e7;} @media only screen and (max-width:400px){.gjHXKT{padding:0 20px;}} .gjHXKT a{font-size:1.6rem;font-weight:normal;} .gjHXKT .icon-link{font-size:1.8rem;} .gjHXKT .icon-btn{-webkit-apparance:none;background-color:transparent;border:none;outline:none;color:#fff;cursor:pointer;}
/* sc-component-id: sc-htpNat */
@media only screen and (max-width:920px){.hAbzAj{display:none;}} .hAbzAj a{font-size:1.5rem;} .hAbzAj::before{content:'';height:2.1rem;width:1px;background-color:#00000038;display:inline-block;vertical-align:middle;}
/* sc-component-id: sc-bxivhb */
.fvIFII{margin-left:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;overflow:hidden;} .fvIFII .search{cursor:pointer;margin-left:10px;} .fvIFII .search i{font-size:20px;}
/* sc-component-id: sc-keyframes-enNFoQ */
@-webkit-keyframes enNFoQ{0%{opacity:0;bottom:100%;}100%{opacity:1;bottom:0;}} @keyframes enNFoQ{0%{opacity:0;bottom:100%;}100%{opacity:1;bottom:0;}}
/* sc-component-id: sc-bZQynM */
.jUVlgh::after{content:'';display:table;} @media screen and (max-width:717px){.jUVlgh{padding:1rem;}}
/* sc-component-id: sc-keyframes-fJTUOz */
@-webkit-keyframes fJTUOz{0%{width:0px;padding:4px 0;}100%{width:160px;padding:4px 5px;}} @keyframes fJTUOz{0%{width:0px;padding:4px 0;}100%{width:160px;padding:4px 5px;}}
/* sc-component-id: sc-htoDjs */
.ljxEMT{position:absolute;top:0;left:50%;top:50%;color:#fff;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-repeat:no-repeat;background-size:100% auto;width:10rem;height:2.5rem;}
/* sc-component-id: sc-kEYyzF */
.dOpkjW{position:relative;width:80%;max-width:740px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;} .dOpkjW::after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;box-shadow:0 0 0 5px #fff;} .dOpkjW .read-more{-webkit-text-decoration:none;text-decoration:none;} .dOpkjW .author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%;} .dOpkjW .post-header{margin-bottom:3.4rem;} .dOpkjW .post-title a{-webkit-text-decoration:none;text-decoration:none;} .dOpkjW .post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3;} .dOpkjW .post-excerpt p{margin:0;font-size:.9em;line-height:1.7em;} .dOpkjW .post-meta a{color:#9eabb3;-webkit-text-decoration:none;text-decoration:none;} .dOpkjW .post-meta a:hover{color:#9eabb3;-webkit-text-decoration:underline;text-decoration:underline;} .dOpkjW .post-date{display:inline-block;text-transform:uppercase;font-size:1.3rem;white-space:nowrap;} .dOpkjW .post-date.has-author{margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;} @media only screen and (max-width:900px){.dOpkjW{font-size:.95em;}} @media only screen and (max-width:500px){.dOpkjW{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em;}.dOpkjW .post-excerpt p{font-size:.85em;}.dOpkjW .post-meta{font-size:1.3rem;margin-top:1rem;}.dOpkjW pre{padding:0!important;}} .dOpkjW pre{padding:1.2rem;} .dOpkjW pre > code{overflow-x:auto;box-shadow:0 0 15px rgba(0,0,0,.35);padding:1.5rem;} .dOpkjW blockquote{border-left:3px solid #061e35!important;margin-left:-23px!important;padding-bottom:2px!important;padding-left:20px!important;color:#24292e!important;} .dOpkjW blockquote p{color:#24292e!important;} .dOpkjW blockquote a{color:#061e35!important;}
/* sc-component-id: sc-kkGfuU */
.febhlo{position:fixed;top:50%;-webkit-transform:translate(0,-50%);-ms-transform:translate(0,-50%);transform:translate(0,-50%);right:3rem;} .febhlo h3{font-size:16px;font-weight:400!important;} .febhlo ul{font-weight:300!important;margin:0;padding:0;font-size:12px;padding-left:3rem;padding-top:.2rem;} .febhlo li{max-width:160px;}</style></head><body><div id="root"><div class="sc-EHOje jvzENE" data-reactroot=""><div class="backend sc-bdVaJa AjcTS"><div style="max-width:1000px;margin:0 auto;background:#fff;height:65px;position:relative"><div class="logo sc-htoDjs ljxEMT"></div></div><nav class="main-nav sc-bwzfXH gjHXKT"><a class="icon-link active" aria-current="true" href="https://shjie047.github.io/"><i class="iconfont icon-home"></i></a><span class="sc-htpNat hAbzAj"><a aria-current="false" href="https://shjie047.github.io/tags/java">Java</a><a aria-current="false" href="https://shjie047.github.io/tags/go">Go</a><a aria-current="false" href="https://shjie047.github.io/tags/nodejs">NodeJS</a></span><div class="sc-bxivhb fvIFII"><a class="archive icon-link" aria-current="false" data-tip="归档" data-for="tip-one" href="https://shjie047.github.io/archives"><i class="iconfont icon-archive"></i></a><a class="search"><i class="iconfont icon-search"></i></a></div></nav></div><div style="height:115px"></div><div class="sc-bZQynM jUVlgh"><article class="sc-kEYyzF dOpkjW"><header class="post-header"><h1 class="post-title">SpringMVC 教程 - DispatcherServlet</h1><section class="post-meta "><time class="post-date" dateTime="2018-04-09">2018/4/9</time><span>, </span><span><span><a aria-current="false" href="https://shjie047.github.io/tags/backend">Backend</a><span>, </span></span><span><a aria-current="false" href="https://shjie047.github.io/tags/java">Java</a><span>, </span></span><span><a aria-current="false" href="https://shjie047.github.io/tags/springmvc">SpringMVC</a><span>, </span></span><span><a aria-current="false" href="https://shjie047.github.io/tags/spring">Spring</a></span></span></section><div style="max-width:1000px;max-height:667px;margin:3rem 0"><img style="width:100%;height:100%;left:0;top:0;margin:auto" class="cover" src="http://p6jqy6mfr.bkt.clouddn.com/stock-photo-239935763.jpg" alt=""/></div></header><section class="post-content markdown-body"><div><h5>简介</h5><p>同许多其他的web框架一样，SpringMVC使用了前端控制器的设计模式，即一个以<code>DispatcherServlet</code>为核心的<code>Servlet</code>为处理请求提供了一个共享的算法，而实际的工作是由可配置的委托组件执行的。这个模式即灵活又支持多样的工作流。
同其他的<code>Servlet</code>,依照Servlet 规范<code>DispatcherServlet</code>需要在web.xml或者Java配置中声明并映射URL。接着<code>DispatcherServlet</code>使用Spring的配置来查找委托组件，用来映射URL，解析视图，异常处理等。
下面这个示例是使用Java配置来注册并初始化<code>DispatcherServlet</code>，这个类由Servlet容器自动发现。</p><pre><code class="language-Java">public class MyWebApplicationInitializer implements WebApplicationInitializer {

    @Override
    public void onStartup(ServletContext servletCxt) {

        // Load Spring web application configuration
        AnnotationConfigWebApplicationContext ac = new AnnotationConfigWebApplicationContext();
        ac.register(AppConfig.class);
        ac.refresh();

        // Create and register the DispatcherServlet
        DispatcherServlet servlet = new DispatcherServlet(ac);
        ServletRegistration.Dynamic registration = servletCxt.addServlet(&quot;app&quot;, servlet);
        registration.setLoadOnStartup(1);
        registration.addMapping(&quot;/app/*&quot;);
    }
}</code></pre><p>下面这个示例是使用<code>web.xml</code>来注册并初始化的</p><pre><code class="language-xml">&lt;web-app&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;/WEB-INF/app-context.xml&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;app&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;app&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/app/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</code></pre><h5>层次结构</h5><p><code>DispatcherServlet</code>需要一个扩展了的<code>ApplicationContext</code>的<code>WebApplicationContext</code>来配置自己的信息。<code>WebApplicationContext</code>包含了<code>Servlet</code>的<code>ServletContext</code>的引用，可以使用<code>RequestContextUtils</code>中的静态方法从<code>WebApplicationContext</code>中查找<code>ServletContext</code>。
对于大多数应用来说一个<code>WebApplicationContext</code>就足够了。当然<code>WebApplicatioContext</code>也可以是有层次结构的，例如由多个Servlet共享的一个根<code>WebApplicationContext</code>，每个Servlet又有自己的子<code>WebApplicationContext</code>。
根<code>WebApplicationContext</code>一般包括需要在多个Servlet中共享的基础bean，例如数据仓库，业务逻辑等。在Servlet规范中，这些bean可以被有效的继承和改写，子<code>WebApplicationContext</code>仅包含在其属于的Servlet中。
<img style="display:block;margin:0 auto;margin-top:4rem;cursor:zoom-in" src="https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/mvc-context-hierarchy.png"/>
下面这个例子就是<code>WebApplicationContext</code>的层级配置</p><pre><code class="language-Java">public class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses() {
        return new Class&lt;?&gt;[] { RootConfig.class };
    }

    @Override
    protected Class&lt;?&gt;[] getServletConfigClasses() {
        return new Class&lt;?&gt;[] { App1Config.class };
    }

    @Override
    protected String[] getServletMappings() {
        return new String[] { &quot;/app1/*&quot; };
    }
} </code></pre><p>同样的，在web.xml中的配置</p><pre><code class="language-xml">&lt;web-app&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;/WEB-INF/root-context.xml&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;app1&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;/WEB-INF/app1-context.xml&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;app1&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/app1/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</code></pre><h5>特殊的bean类型</h5><p><code>DispatcherServlet</code>委托专用的bean来处理请求，渲染响应。专用的bean指的是Spring管理的，实现WebFlux框架约定的实例。这些bean一般都是内建的约定，但是可以定制他们的属性，扩展或者代替这些bean。</p><table><thead><tr><th style="text-align:left">bean 类型</th><th style="text-align:left">解释</th></tr></thead><tbody><tr><td style="text-align:left">HandlerMapping</td><td style="text-align:left">处理器映射，具体由其子类实现。两个重要的子类，<code>RequestMappingHandlerMapping</code>,<code>SimpleUrlHandlerMapping</code></td></tr><tr><td style="text-align:left">HandlerAdapter</td><td style="text-align:left">辅助<code>DispatcherServlet</code>执行特定的处理器。</td></tr><tr><td style="text-align:left">HandlerExceptionResolver</td><td style="text-align:left">将异常重定向到其他处理器或者是显示HTML的错误界面。</td></tr><tr><td style="text-align:left">ViewResolver</td><td style="text-align:left">通过处理器返回的视图字符串查找具体的视图并渲染。</td></tr><tr><td style="text-align:left">LocaleResolver, LocaleContextResolver</td><td style="text-align:left">支持国际化页面，使用例如时区等来解析本地化问题。</td></tr><tr><td style="text-align:left">ThemeResolver</td><td style="text-align:left">解析应用可用的主题，例如提供个性化框架</td></tr><tr><td style="text-align:left">MultipartResolver</td><td style="text-align:left">处理上传文件</td></tr><tr><td style="text-align:left">FlashMapManager</td><td style="text-align:left">保存和检索输入输出的FlashMap，它可以将属性从一个请求传递到另一个请求的输入输出，一般应用在重定向中。</td></tr></tbody></table><h5>Web MVC 配置</h5><p>应用可以声明在特殊的bean类型中列出的bean来处理请求。<code>DispatcherServlet</code>会检查每一个bean的<code>WebApplicationContext</code>。如果没有指定的bean，那么就会使用DispatcherServlet.properties中定义的bean。
MVC配置将会在以后详细的列出。</p><h5>Servlet 配置</h5><p>在Servlet 3.0+中，可以使用编程的方式来代替web.xml配置。下面这个例子就是通过编程注册<code>DispatcherServlet</code></p><pre><code class="language-Java">import org.springframework.web.WebApplicationInitializer;

public class MyWebApplicationInitializer implements WebApplicationInitializer {

    @Override
    public void onStartup(ServletContext container) {
        XmlWebApplicationContext appContext = new XmlWebApplicationContext();
        appContext.setConfigLocation(&quot;/WEB-INF/spring/dispatcher-config.xml&quot;);

        ServletRegistration.Dynamic registration = container.addServlet(&quot;dispatcher&quot;, new DispatcherServlet(appContext));
        registration.setLoadOnStartup(1);
        registration.addMapping(&quot;/&quot;);
    }
}</code></pre><p><code>WebApplicationInitializer</code>是由SpringMVC提供的接口，用来保证上述实现可以由支持Servlet 3.0的容器自动检测并初始化。抽象类<code>AbstractDispatcherServletInitializerl</code>实现了<code>WebApplicationInitializer</code> 可以更加容易的注册<code>DispathcerServlet</code>。
下面是使用Java配置的Spring</p><pre><code class="language-Java">public class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses() {
        return null;
    }

    @Override
    protected Class&lt;?&gt;[] getServletConfigClasses() {
        return new Class&lt;?&gt;[] { MyWebConfig.class };
    }

    @Override
    protected String[] getServletMappings() {
        return new String[] { &quot;/&quot; };
    }
}</code></pre><p>如果使用的是xml配置，需要直接继承<code>AbstractDispatcherServletInitializer</code></p><pre><code class="language-Java">public class MyWebAppInitializer extends AbstractDispatcherServletInitializer {

    @Override
    protected WebApplicationContext createRootApplicationContext() {
        return null;
    }

    @Override
    protected WebApplicationContext createServletApplicationContext() {
        XmlWebApplicationContext cxt = new XmlWebApplicationContext();
        cxt.setConfigLocation(&quot;/WEB-INF/spring/dispatcher-config.xml&quot;);
        return cxt;
    }

    @Override
    protected String[] getServletMappings() {
        return new String[] { &quot;/&quot; };
    }
}</code></pre><p><code>AbstractDispatcherServletInitializer</code>同样提供了一个方便的函数来添加过滤器。</p><pre><code class="language-Java">public class MyWebAppInitializer extends AbstractDispatcherServletInitializer {

    // ...

    @Override
    protected Filter[] getServletFilters() {
        return new Filter[] {
            new HiddenHttpMethodFilter(), new CharacterEncodingFilter() };
    }
}</code></pre><p>每个过滤器根据他具体的类型添加一个默认的名字，并且自动映射到DispatcherServlet。
<code>isAsyncSupported</code>方法是<code>AbstractDispatcherServletInitializer</code>的protect的方法，可以启动<code>DispatcherServlet</code>支持异步处理
如果要定义自己的DispatcherServlet，那么可以重写<code>createDispatcherServlet</code>方法。</p><h5>处理请求</h5><p><code>DispatcherServlet</code>处理请求的流程如下：  </p><ul><li>查找<code>WebApplicationContext</code>并将其作为request的一个属性保存起来，以便其他控制器或者处理链中的组件可以使用。默认保存键为<code>DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> </li><li>本地化解析器保存在request中，以便处理链中的其他组件使用他来处理请求做本地化处理。如果不需要本地化，那么就不需要使用他。</li><li>主题解析器保存在request中，以便其他组件，例如视图查找器使用，如果不需要要主题定制，直接忽略。</li><li>如果指定了文件上传解析器，那么就会检查请求是否有文件上传，如果有请求有<code>MultipartHttpServletRequest</code>封装，以便其他组件处理。</li><li>查找合适的处理器处理请求。如果找到了处理器，那么就依次执行处理链上的组件，返回一个model或者视图。如果是注解的controller也可以直接渲染而不需要返回视图。</li><li>如果返回一个model，会渲染一个视图，如果没有返回model，那么就无需渲染视图了，因为视图可能已经被渲染了。</li></ul><p>在请求处理过程中如果出现了一场那么就可以使用<code>WebApplicatioContext</code>中的<code>HandlerExceptionResolver</code>来定制异常处理。
SpringMVC 同样支持返回<code>last-modification-date</code>，对指定请求处理如何判断是否有<code>last-modification-date</code>非常直接：<code>DispatcherServlet</code>查找适合的处理器，并且检查其是否实现了<code>LastModified</code>接口，如果实现了，调用<code>long getLastModified(request)</code>返回给客户端。
通过web.xml中Servlet的初始化参数可以定制DispatcherServlet.</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">解释</th></tr></thead><tbody><tr><td style="text-align:left">contextClass</td><td style="text-align:left">实现<code>WebApplicationContext</code>的类，默认使用<code>XmlWebApplicationContext</code></td></tr><tr><td style="text-align:left">contextConfigLocation</td><td style="text-align:left">传递给Context 实例的字符串，包括了bean的定义</td></tr><tr><td style="text-align:left">namespace</td><td style="text-align:left"><code>WebApplicationContext</code> 的命名空间，默认<code>[servlet-name]-servlet</code></td></tr></tbody></table><h5>拦截器</h5><p><code>HandlerMapping</code>支持拦截器，在对某些请求添加处理的时候非常有用，比如，权限检查。拦截器必须实现<code>org.springframework.web.servlet</code>包中的<code>HandlerInterceptor</code>，这个接口有三个处理函数分别对应请求处理前，请求处理后，完成请求处理。</p><ul><li>preHandle(..) 在请求处理前执行</li><li>postHandle(..) 请求处理后执行</li><li>afterCompletion(..) 整个请求处理结束后执行
<code>preHandle(..)</code> 返回一个boolean值。可以使用这个值来中断处理请求链。当返回true的时候，处理将会继续执行，如果返回false，<code>DispatcherServelt</code>假定拦截器已经对请求正确处理了，例如渲染了一个页面等。将会中断请求处理链。
注意，<code>postHandle</code>方法很少使用<code>@ResponseBody</code>和<code>ResponseEntity</code>。因为响应已经在<code>postHandle</code>执行之前有<code>HandlerAdapter</code>返回了。意味着在<code>postHandle</code>的时候再修改响应已经晚了。对应这种场景可以继承<code>ResponseBodyAdvice</code>或者实现ControllerAdvice或者直接配置<code>RequestMappingHandlerAdapter</code>来实现。</li></ul><h5>异常处理</h5><p>如果在请求映射或者处理请求的时候抛出异常，<code>DispatcherServelt</code>会委托<code>HandlerExceptionResolver</code>来解析异常并提供可选择的处理，即返一个错误响应。
下表是<code>HandlerExceptionResolver</code>的实现</p><table><thead><tr><th style="text-align:left">HandlerExceptionResolver</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">SimpleMappingExceptionResolver</td><td style="text-align:left">异常类名和错误页面名的映射。浏览器渲染错误页面的时候非常实用</td></tr><tr><td style="text-align:left">DefaultHandlerExceptionResolver</td><td style="text-align:left">解析SpringMVC抛出的异常，同时将其映射到HTTP的错误码上</td></tr><tr><td style="text-align:left">ResponseStatusExceptionResolver</td><td style="text-align:left">解析@ResponseStatus注解，同时根据其注解值将其映射到HTTP的错误码上</td></tr><tr><td style="text-align:left">ExceptionHandlerExceptionResolver</td><td style="text-align:left">调用@Controller 或者@ControllerAdvice 类中使用@ExceptionHandler注解的方法</td></tr></tbody></table><h6>解析链</h6><p>可以通过在Spring的配置中声明多个<code>HandlerExceptionResolver</code>bean，来构成一个异常处理解析链，如果需要的话，同时可以设置他们解析的顺序。序号越大，处理越靠后。
<code>HandlerExceptionResolver</code>可以返回：</p><ul><li>指向错误页面的 <code>ModelAndView</code></li><li>如果异常在解析链中被处理返回空<code>ModelAndView</code></li><li>如果异常为被处理返回<code>null</code>，后续的解析起继续处理异常，如果异常一直未被处理，那么将会冒泡到Servlet容器处理
Spring MVC的异常是有MVC配置自动声明的，@ResponseStatus注解异常，支持@ExceptionHandler方法的异常。这些处理器都是可以定制和替换的</li></ul><h6>Servlet容器异常</h6><p>如果<code>HandlerExceptionResolver</code>无法处理异常，那么异常将会继续传播，或者是返回了错误的HTTP状态码，例如4xx，5xx。Servlet容器可能会渲染一个错误的页面。这个页面也是可以定制的：</p><pre><code class="language-xml">&lt;error-page&gt;
    &lt;location&gt;/error&lt;/location&gt;
&lt;/error-page&gt;</code></pre><p>根据上述代码，当出现了无法处理的异常，或者返回错误码，容器会根据配置返回一个错误的URL。这个请求将会继续被DispatcherServlet处理，比如映射到一个@Controller的错误处理控制器上：</p><pre><code class="language-Java">@RestController
public class ErrorController {

    @RequestMapping(path = &quot;/error&quot;)
    public Map&lt;String, Object&gt; handle(HttpServletRequest request) {
        Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
        map.put(&quot;status&quot;, request.getAttribute(&quot;javax.servlet.error.status_code&quot;));
        map.put(&quot;reason&quot;, request.getAttribute(&quot;javax.servlet.error.message&quot;));
        return map;
    }
}</code></pre><h5>视图解析</h5><p>Spring MVC通过定义了<code>ViewResolver</code>和<code>View</code>两个接口可以让我们直接通过返回model来渲染视图，而不需要指定某一个特定的视图技术。<code>ViewResolver</code>提供了视图名和视图之间的映射关系。在提交给特定视图技术之前由<code>View</code>来准备数据。
下列表格展示了ViewResolver的层级：</p><table><thead><tr><th style="text-align:left">ViewResolver</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">AbstractCachingViewResolver</td><td style="text-align:left">缓存解析过的视图。可设置cache属性为false来关闭缓存。在需要刷新缓存的场景可调用<code>removeFromCache(String viewName, Locale loc)</code>刷新。</td></tr><tr><td style="text-align:left">XmlViewResolver</td><td style="text-align:left">实现<code>ViewResolver</code>，可以接收一个同Spring XML bean同DTD的xml配置文件。默认在/WEB-INF/views.xml</td></tr><tr><td style="text-align:left">ResourceBundleViewResolver</td><td style="text-align:left">解析定义在<code>ResourceBundle</code>中的视图，使用viewname.class作为视图类，viewname.url作为视图名</td></tr><tr><td style="text-align:left">UrlBasedViewResolver</td><td style="text-align:left">无需明确指定映射，直接通过解析url来查找视图名。</td></tr><tr><td style="text-align:left">InternalResourceViewResolver</td><td style="text-align:left">实现<code>UrlBasedViewResolver</code>,<code>JstlView</code>,<code>TilesView</code>，支持<code>InternalResourceView</code>例如：jsp，servlet class等。</td></tr><tr><td style="text-align:left">FreeMarkerViewResolver</td><td style="text-align:left"><code>UrlBasedViewResolver</code>的子类，用来支持FreeMarker</td></tr><tr><td style="text-align:left">ContentNegotiatingViewResolver</td><td style="text-align:left">根据请求的文件名或者Accept来确定视图</td></tr></tbody></table><h6>视图处理</h6><p>如果需要的话，可以声明多个视图处理器，通过设置<code>order</code>属性来确定他们的顺序。order越大，处理越靠后。
默认情况下<code>ViewResolver</code>可以返回null代表找不到视图。当然在JSP中，使用InternalResourceViewResolver来检查JSP是否存在的唯一方式就是通过<code>RequestDispatcher</code>执行一次调度。因此<code>InternalResourceViewResolver</code>必须是最后一个视图解析器。</p><h6>视图redirect</h6><p>视图前缀<code>redirect:</code> 表示视图需要执行一次redirect。<code>UrlBasedViewResolver</code>和其子类会识别出这是要给重定向，剩下的部分就是视图名。
这个效果和Controller返回一个<code>RedirectView</code>一样，但是使用这个指令，controller就可以简单的返回一个视图名就可以了。视图名<code>redirect:/myapp/some/resource</code>将会返回相对于当前Servlet Context的视图，<code>redirect:http://myhost.com/some/arbitrary/path</code> 这种则会返回绝对URL。
注意，如果一个controller被<code>@ResponseStatus</code>修饰，那么注解值优先级高于<code>RedirectView</code></p><h6>视图Forwarding</h6><p>视图前缀<code>forward:</code>表示视图执行forwarding。同样由<code>UrlBasedViewResolver</code>和其子类解析。通过创建<code>InternalResourceView</code>执行<code>RequestDispatcher.forward()</code>实现。因此这个指令对于<code>InternalResourceViewResolver</code>和<code>InternalResourceViewResolver</code>没啥用，但是对于使用了其他的视图技术但是仍然想用强制使用JSP或者Servlet的时候就很有用了。</p><h6>视图内容协商</h6><p><code>ContentNegotiatingViewResolver</code>并不会解析视图，而是将其委托给其他视图解析器，并且选择客户端请求描述选择视图。描述可以是Accept头或者参数，例如<code>/path?format=pdf</code>
<code>ContentNegotiatingViewResolver</code>通过对比请求的媒体类型和<code>ViewResolvers</code>支持的媒体类型来选择合适的View。被选中的列表中的第一个View将会被返回给客户端。</p><h5>本地化</h5><p>同Spring MVC，大多数Spring架构支持国际化。<code>DispatcherServlet</code>通过<code>LocaleResolver</code>根据客户端的区域自动解析消息。
当请求到来时<code>DispatcherServlet</code>查找本地化解析器，如果找到则会设置本地化。通过<code>RequestContext.getLocale()</code>方法可以获取由本地化解析器解析的本地化语言。
为了自动化解析，可以通过拦截器对具体的场景进行本地化解析，例如根据请求参数来解析。
本地化解析器和拦截器定义在<code>org.springframework.web.servlet.i18n</code>包中，可以在应用中配置。下面是一些Spring使用的配置</p><h6>TimeZone</h6><p>通过获取客户端的时区来做本地化。<code>LocaleContextResolver</code>接口扩展了<code>LocalResolver</code>，提供了一个可能包含时区信息的<code>LocaleContext</code>。
如果可以，用户的时区可以通过<code>RequestContext.getTimeZone()</code>方法获取。时区信息可以自动的被注册到Spring中的ConversionService 日期时间的Converter和Formatter使用。</p><h6>Header resolver</h6><p>这个解析器检查<code>accept-language</code>头，一般来说包含的是客户端操作系统的区域。注意这个不支持时区。</p><h6>Cookie resolver</h6><p>这个解析器检查cookie中可能包含的<code>TimeZone</code>和<code>Locale</code>。通过如下定义来使用：</p><pre><code class="language-xml">&lt;bean id=&quot;localeResolver&quot; class=&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;&gt;

    &lt;property name=&quot;cookieName&quot; value=&quot;clientlanguage&quot;/&gt;

    &lt;!-- in seconds. If set to -1, the cookie is not persisted (deleted when browser shuts down) --&gt;
    &lt;property name=&quot;cookieMaxAge&quot; value=&quot;100000&quot;/&gt;

&lt;/bean&gt;</code></pre><p>CookieLocaleResolver的属性：</p><table><thead><tr><th style="text-align:left">名字</th><th style="text-align:left">默认值</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">cookieName</td><td style="text-align:left">classname + LOCALE</td><td style="text-align:left">cookie名</td></tr><tr><td style="text-align:left">cookieMaxAge</td><td style="text-align:left">Servlet容器默认值</td><td style="text-align:left">cookie生效时间</td></tr><tr><td style="text-align:left">cookiePath</td><td style="text-align:left">/</td><td style="text-align:left">cookie 保存位置</td></tr></tbody></table><h6>Session resolver</h6><p><code>SessionLocaleResolver</code>通过从session中检查可能包含的<code>TimeZone</code>和<code>Locale</code>。相对于<code>CookieLocaleResolver</code>，他将信息保存在<code>HttpSession</code>中。</p><h6>Locale interceptor</h6><p>可以通过拦截器启动针对某些映射的本地化策略，例如如下：</p><pre><code class="language-xml">&lt;bean id=&quot;localeChangeInterceptor&quot;
        class=&quot;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&quot;&gt;
    &lt;property name=&quot;paramName&quot; value=&quot;siteLanguage&quot;/&gt;
&lt;/bean&gt;

&lt;bean id=&quot;localeResolver&quot;
        class=&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;/&gt;

&lt;bean id=&quot;urlMapping&quot;
        class=&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;&gt;
    &lt;property name=&quot;interceptors&quot;&gt;
        &lt;list&gt;
            &lt;ref bean=&quot;localeChangeInterceptor&quot;/&gt;
        &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name=&quot;mappings&quot;&gt;
        &lt;value&gt;/**/*.view=someController&lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;</code></pre><h5>主题</h5><p>可以通过设置Spring MVC的主题来整体设置应用的外观，从而提高用户体验。主题是一些静态资源的集合，主要是可以影响外观的样式表和图片。
为了应用主题，首先要设置一个<code>org.springframework.ui.context.ThemeSource</code>的接口。<code>WebApplicationContext</code>继承了<code>ThemeSource</code>，但是将其实现委托给了子类。默认使用的是<code>org.springframework.ui.context.support.ResourceBundleThemeSource</code>来从classpath的根目录下加载配置文件。配置文件格式如下：</p><pre><code class="language-null">styleSheet=/themes/cool/style.css
background=/themes/cool/img/coolBg.jpg</code></pre><p>配置文件的名字是视图代码中的变量名。对于JSP而言可以如下显示：</p><pre><code class="language-JSP">&lt;%@ taglib prefix=&quot;spring&quot; uri=&quot;http://www.springframework.org/tags&quot;%&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;&lt;spring:theme code=&#x27;styleSheet&#x27;/&gt;&quot; type=&quot;text/css&quot;/&gt;
    &lt;/head&gt;
    &lt;body style=&quot;background=&lt;spring:theme code=&#x27;background&#x27;/&gt;&quot;&gt;
        ...
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p>默认情况下<code>ResourceBundleThemeSource</code>使用空的前缀名，这样配置文件直接从classpath根目录下加载。这样就可以将<code>cool.properties</code>定义放到classpath根目录下，<code>ResourceBundleThemeSource</code>默认使用标准的Java资源加载工具，同时也完全支持国际化，所以通过命名来支持<code>cool_nl.properties</code>。</p><h6>解析主题</h6><p><code>DispatcherServlet</code>通过bean的名字<code>themeResolver</code>来查找<code>ThemeResolver</code>的实现。
ThemeResolver 的实现如下：</p><table><thead><tr><th style="text-align:left">Class</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">FixedThemeResolver</td><td style="text-align:left">选中一个固定的主题，设置<code>defaultThemeName</code>属性</td></tr><tr><td style="text-align:left">SessionThemeResolver</td><td style="text-align:left">主题由用户session维护。每个session只需要设置一次</td></tr><tr><td style="text-align:left">CookieThemeResolver</td><td style="text-align:left">通过cookie选择主题</td></tr></tbody></table><h5>Multipart resolver</h5><p><code>org.springframework.web.multipart</code>中的<code>MultipartResolver</code>是用来处理multipart请求的。共有给予Common Fileupload和Servlet 3.0 两种实现。
为了使用multipart，需要在<code>DispatcherServlet</code>的Spring配置中声明一个名字为<code>multipartResolver</code>的bean。当POST请求的<code>content-type</code>是<code>multipart/form-data</code>的时候，解析器解析这个请求并且将<code>HttpServletRequest</code>封装成<code>MultipartHttpServletRequest</code>来处理请求。</p><h6>Apache FileUpload</h6><p>使用Apache Commons FileUpload 只需要简单的配置一个类型为<code>CommonsMultipartResolver</code>，名字为<code>multipartResolver</code>的bean即可。当然也需要将<code>commons-fileupload</code>加入到依赖中。</p><h6>Servlet 3.0</h6><p>使用Servlet 3.0则需要Servlet 容器的配置</p><ul><li>使用Java配置，在Servlet注册中设置<code>MultipartConfigElement</code>。</li><li>使用web.xml 添加要给<code>&lt;multipart-config&gt;</code>的配置
如下是使用Java的配置：</li></ul><pre><code class="language-Java">public class AppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

    // ...

    @Override
    protected void customizeRegistration(ServletRegistration.Dynamic registration) {

        // Optionally also set maxFileSize, maxRequestSize, fileSizeThreshold
        registration.setMultipartConfig(new MultipartConfigElement(&quot;/tmp&quot;));
    }

}</code></pre><p>Servlet 3.0配置好之后，只需要添加类型为<code>StandardServletMultipartResolver</code>，名字为<code>multipartResolver</code>的配置即可。</p></div></section><section class="post-footer"></section><div class="sc-kkGfuU febhlo"><h3>相关阅读:</h3><ul><li><a aria-current="false" href="https://shjie047.github.io/cates/backend/post/2018-04-07/deep-in-spring-mvc">深入理解Spring MVC</a></li><li><a aria-current="false" href="https://shjie047.github.io/cates/backend/post/2018-04-10/spring-mvc-controller">SpringMVC 教程 - Controller</a></li><li><a aria-current="false" href="https://shjie047.github.io/cates/backend/post/2018-04-09/spring-mvc-filter">SpringMVC 教程 - Filter</a></li></ul></div></article></div><div class="__react_component_tooltip place-top type-dark " data-id="tooltip"></div><div class="__react_component_tooltip place-top type-dark " data-id="tooltip"></div></div></div><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"https://shjie047.github.io/styles.a90d508c.css"}</script><script type="text/javascript">
                window.__routeInfo = {'path':'cates/backend/post/2018-04-09/spring-mvc-dispatcher-servlet','templateID':4,'sharedPropsHashes':{'tags':'1C8cqm'},'localProps':null,'allProps':{'post':{'title':'SpringMVC \u6559\u7A0B - DispatcherServlet','cover':'http://p6jqy6mfr.bkt.clouddn.com/stock-photo-239935763.jpg','iso8601Date':'2018-04-09T08:39:10+08:00','basename':'spring-mvc-dispatcher-servlet','tags':['Backend','Java','SpringMVC','Spring'],'date':'2018-04-09','cate':'backend','summary':'\u7B80\u4ECB\n\n\u540C\u8BB8\u591A\u5176\u4ED6\u7684web\u6846\u67B6\u4E00\u6837\uFF0CSpringMVC\u4F7F\u7528\u4E86\u524D\u7AEF\u63A7\u5236\u5668\u7684\u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u5373\u4E00\u4E2A\u4EE5DispatcherServlet\u4E3A\u6838\u5FC3\u7684Servlet\u4E3A\u5904\u7406\u8BF7\u6C42\u63D0\u4F9B\u4E86\u4E00\u4E2A\u5171\u4EAB\u7684\u7B97\u6CD5\uFF0C\u800C\u5B9E\u9645\u7684\u5DE5\u4F5C\u662F\u7531\u53EF\u914D\u7F6E\u7684\u59D4\u6258\u7EC4\u4EF6\u6267\u884C\u7684\u3002\u8FD9\u4E2A\u6A21\u5F0F\u5373\u7075\u6D3B\u53C8\u652F\u6301\u591A\u6837\u7684\u5DE5\u4F5C\u6D41\u3002\n\u540C\u5176\u4ED6\u7684Servlet,\u4F9D\u7167Servlet \u89C4\u8303DispatcherServlet\u9700\u8981\u5728web.xml\u6216\u8005Java\u914D\u7F6E\u4E2D\u58F0\u660E\u5E76\u6620\u5C04URL\u3002\u63A5\u7740DispatcherServlet\u4F7F\u7528Spring\u7684\u914D\u7F6E\u6765\u67E5\u627E\u59D4\u6258\u7EC4\u4EF6\uFF0C\u7528\u6765\u6620\u5C04URL\uFF0C\u89E3\u6790\u89C6\u56FE\uFF0C\u5F02\u5E38\u5904\u7406\u7B49\u3002\n\u4E0B\u9762\u8FD9\u4E2A\u793A\u4F8B\u662F\u4F7F\u7528Java\u914D\u7F6E\u6765\u6CE8\u518C\u5E76\u521D\u59CB\u5316DispatcherServlet\uFF0C\u8FD9\u4E2A\u7C7B\u7531Servlet\u5BB9\u5668\u81EA\u52A8\u53D1\u73B0\u3002\n`Java\npublic class MyWebApplicationInitializer implements WebApplicationInitializer {\n\n@Override\npublic void onStartup(ServletContext servletCxt) {\n\n    // Load Spring web application configuration\n    AnnotationConfigWebApplicationContext ac = new AnnotationConfigWebApplicationContext();\n    ac.register(AppConfig.class);\n    ac.refresh();\n\n    // Create and register the DispatcherServlet\n    DispatcherServlet servlet = new DispatcherServlet(ac);\n    ServletRegistration.Dynamic registration = servletCxt.addServlet(&quot;app&quot;, servlet);\n    registration.setLoadOnStartup(1);\n    registration.addMapping(&quot;/app/*&quot;);\n}\n\n}\n`\n\n\u4E0B\u9762\u8FD9\u4E2A\u793A\u4F8B\u662F\u4F7F\u7528web.xml\u6765\u6CE8\u518C\u5E76\u521D\u59CB\u5316\u7684\n`xml\n&lt;web-app&gt;\n\n&lt;listener&gt;\n    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;\n&lt;/listener&gt;\n\n&lt;context-param&gt;\n    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n    &lt;param-value&gt;/WEB-INF/app-context.xml&lt;/param-value&gt;\n&lt;/context-param&gt;\n\n&lt;servlet&gt;\n    &lt;servlet-name&gt;app&lt;/servlet-name&gt;\n    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;\n    &lt;init-param&gt;\n        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n        &lt;param-value&gt;&lt;/param-value&gt;\n    &lt;/init-param&gt;\n    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n&lt;/servlet&gt;\n\n&lt;servlet-mapping&gt;\n    &lt;servlet-name&gt;app&lt;/servlet-name&gt;\n    &lt;url-pattern&gt;/app/*&lt;/url-pattern&gt;\n&lt;/servlet-mapping&gt;\n\n&lt;/web-app&gt;\n`\n\n\u5C42\u6B21\u7ED3\u6784\n\nDispatcherServlet\u9700\u8981\u4E00\u4E2A\u6269\u5C55\u4E86\u7684ApplicationContext\u7684WebApplicationContext\u6765\u914D\u7F6E\u81EA\u5DF1\u7684\u4FE1\u606F\u3002WebApplicationContext\u5305\u542B\u4E86Servlet\u7684ServletContext\u7684\u5F15\u7528\uFF0C\u53EF\u4EE5\u4F7F\u7528RequestContextUtils\u4E2D\u7684\u9759\u6001\u65B9\u6CD5\u4ECEWebApplicationContext\u4E2D\u67E5\u627EServletContext\u3002\n\u5BF9\u4E8E\u5927\u591A\u6570\u5E94\u7528\u6765\u8BF4\u4E00\u4E2AWebApplicationContext\u5C31\u8DB3\u591F\u4E86\u3002\u5F53\u7136WebApplicatioContext\u4E5F\u53EF\u4EE5\u662F\u6709\u5C42\u6B21\u7ED3\u6784\u7684\uFF0C\u4F8B\u5982\u7531\u591A\u4E2AServlet\u5171\u4EAB\u7684\u4E00\u4E2A\u6839WebApplicationContext\uFF0C\u6BCF\u4E2AServlet\u53C8\u6709\u81EA\u5DF1\u7684\u5B50WebApplicationContext\u3002\n\u6839WebApplicationContext\u4E00\u822C\u5305\u62EC\u9700\u8981\u5728\u591A\u4E2AServlet\u4E2D\u5171\u4EAB\u7684\u57FA\u7840bean\uFF0C\u4F8B\u5982\u6570\u636E\u4ED3\u5E93\uFF0C\u4E1A\u52A1\u903B\u8F91\u7B49\u3002\u5728Servlet\u89C4\u8303\u4E2D\uFF0C\u8FD9\u4E9Bbean\u53EF\u4EE5\u88AB\u6709\u6548\u7684\u7EE7\u627F\u548C\u6539\u5199\uFF0C\u5B50WebApplicationContext\u4EC5\u5305\u542B\u5728\u5176\u5C5E\u4E8E\u7684Servlet\u4E2D\u3002\n\n\u4E0B\u9762\u8FD9\u4E2A\u4F8B\u5B50\u5C31\u662FWebApplicationContext\u7684\u5C42\u7EA7\u914D\u7F6E\n`Java\npublic class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n@Override\nprotected Class&lt;?&gt;[] getRootConfigClasses() {\n    return new Class&lt;?&gt;[] { RootConfig.class };\n}\n\n@Override\nprotected Class&lt;?&gt;[] getServletConfigClasses() {\n    return new Class&lt;?&gt;[] { App1Config.class };\n}\n\n@Override\nprotected String[] getServletMappings() {\n    return new String[] { &quot;/app1/*&quot; };\n}\n\n} \n`\n\n\u540C\u6837\u7684\uFF0C\u5728web.xml\u4E2D\u7684\u914D\u7F6E\n`xml\n&lt;web-app&gt;\n\n&lt;listener&gt;\n    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;\n&lt;/listener&gt;\n\n&lt;context-param&gt;\n    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n    &lt;param-value&gt;/WEB-INF/root-context.xml&lt;/param-value&gt;\n&lt;/context-param&gt;\n\n&lt;servlet&gt;\n    &lt;servlet-name&gt;app1&lt;/servlet-name&gt;\n    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;\n    &lt;init-param&gt;\n        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n        &lt;param-value&gt;/WEB-INF/app1-context.xml&lt;/param-value&gt;\n    &lt;/init-param&gt;\n    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n&lt;/servlet&gt;\n\n&lt;servlet-mapping&gt;\n    &lt;servlet-name&gt;app1&lt;/servlet-name&gt;\n    &lt;url-pattern&gt;/app1/*&lt;/url-pattern&gt;\n&lt;/servlet-mapping&gt;\n\n&lt;/web-app&gt;\n`\n\n\u7279\u6B8A\u7684bean\u7C7B\u578B\n\nDispatcherServlet\u59D4\u6258\u4E13\u7528\u7684bean\u6765\u5904\u7406\u8BF7\u6C42\uFF0C\u6E32\u67D3\u54CD\u5E94\u3002\u4E13\u7528\u7684bean\u6307\u7684\u662FSpring\u7BA1\u7406\u7684\uFF0C\u5B9E\u73B0WebFlux\u6846\u67B6\u7EA6\u5B9A\u7684\u5B9E\u4F8B\u3002\u8FD9\u4E9Bbean\u4E00\u822C\u90FD\u662F\u5185\u5EFA\u7684\u7EA6\u5B9A\uFF0C\u4F46\u662F\u53EF\u4EE5\u5B9A\u5236\u4ED6\u4EEC\u7684\u5C5E\u6027\uFF0C\u6269\u5C55\u6216\u8005\u4EE3\u66FF\u8FD9\u4E9Bbean\u3002\n\nbean \u7C7B\u578B | \u89E3\u91CA\n:---------- | :---------\nHandlerMapping | \u5904\u7406\u5668\u6620\u5C04\uFF0C\u5177\u4F53\u7531\u5176\u5B50\u7C7B\u5B9E\u73B0\u3002\u4E24\u4E2A\u91CD\u8981\u7684\u5B50\u7C7B\uFF0CRequestMappingHandlerMapping,SimpleUrlHandlerMapping\nHandlerAdapter | \u8F85\u52A9DispatcherServlet\u6267\u884C\u7279\u5B9A\u7684\u5904\u7406\u5668\u3002\nHandlerExceptionResolver | \u5C06\u5F02\u5E38\u91CD\u5B9A\u5411\u5230\u5176\u4ED6\u5904\u7406\u5668\u6216\u8005\u662F\u663E\u793AHTML\u7684\u9519\u8BEF\u754C\u9762\u3002\nViewResolver | \u901A\u8FC7\u5904\u7406\u5668\u8FD4\u56DE\u7684\u89C6\u56FE\u5B57\u7B26\u4E32\u67E5\u627E\u5177\u4F53\u7684\u89C6\u56FE\u5E76\u6E32\u67D3\u3002 \nLocaleResolver, LocaleContextResolver | \u652F\u6301\u56FD\u9645\u5316\u9875\u9762\uFF0C\u4F7F\u7528\u4F8B\u5982\u65F6\u533A\u7B49\u6765\u89E3\u6790\u672C\u5730\u5316\u95EE\u9898\u3002 \nThemeResolver | \u89E3\u6790\u5E94\u7528\u53EF\u7528\u7684\u4E3B\u9898\uFF0C\u4F8B\u5982\u63D0\u4F9B\u4E2A\u6027\u5316\u6846\u67B6 \nMultipartResolver | \u5904\u7406\u4E0A\u4F20\u6587\u4EF6 \nFlashMapManager | \u4FDD\u5B58\u548C\u68C0\u7D22\u8F93\u5165\u8F93\u51FA\u7684FlashMap\uFF0C\u5B83\u53EF\u4EE5\u5C06\u5C5E\u6027\u4ECE\u4E00\u4E2A\u8BF7\u6C42\u4F20\u9012\u5230\u53E6\u4E00\u4E2A\u8BF7\u6C42\u7684\u8F93\u5165\u8F93\u51FA\uFF0C\u4E00\u822C\u5E94\u7528\u5728\u91CD\u5B9A\u5411\u4E2D\u3002 \n\nWeb MVC \u914D\u7F6E\n\n\u5E94\u7528\u53EF\u4EE5\u58F0\u660E\u5728\u7279\u6B8A\u7684bean\u7C7B\u578B\u4E2D\u5217\u51FA\u7684bean\u6765\u5904\u7406\u8BF7\u6C42\u3002DispatcherServlet\u4F1A\u68C0\u67E5\u6BCF\u4E00\u4E2Abean\u7684WebApplicationContext\u3002\u5982\u679C\u6CA1\u6709\u6307\u5B9A\u7684bean\uFF0C\u90A3\u4E48\u5C31\u4F1A\u4F7F\u7528DispatcherServlet.properties\u4E2D\u5B9A\u4E49\u7684bean\u3002\nMVC\u914D\u7F6E\u5C06\u4F1A\u5728\u4EE5\u540E\u8BE6\u7EC6\u7684\u5217\u51FA\u3002\n\nServlet \u914D\u7F6E\n\n\u5728Servlet 3.0+\u4E2D\uFF0C\u53EF\u4EE5\u4F7F\u7528\u7F16\u7A0B\u7684\u65B9\u5F0F\u6765\u4EE3\u66FFweb.xml\u914D\u7F6E\u3002\u4E0B\u9762\u8FD9\u4E2A\u4F8B\u5B50\u5C31\u662F\u901A\u8FC7\u7F16\u7A0B\u6CE8\u518CDispatcherServlet\n`Java\nimport org.springframework.web.WebApplicationInitializer;\n\npublic class MyWebApplicationInitializer implements WebApplicationInitializer {\n\n@Override\npublic void onStartup(ServletContext container) {\n    XmlWebApplicationContext appContext = new XmlWebApplicationContext();\n    appContext.setConfigLocation(&quot;/WEB-INF/spring/dispatcher-config.xml&quot;);\n\n    ServletRegistration.Dynamic registration = container.addServlet(&quot;dispatcher&quot;, new DispatcherServlet(appContext));\n    registration.setLoadOnStartup(1);\n    registration.addMapping(&quot;/&quot;);\n}\n\n}\n`\n\nWebApplicationInitializer\u662F\u7531SpringMVC\u63D0\u4F9B\u7684\u63A5\u53E3\uFF0C\u7528\u6765\u4FDD\u8BC1\u4E0A\u8FF0\u5B9E\u73B0\u53EF\u4EE5\u7531\u652F\u6301Servlet 3.0\u7684\u5BB9\u5668\u81EA\u52A8\u68C0\u6D4B\u5E76\u521D\u59CB\u5316\u3002\u62BD\u8C61\u7C7BAbstractDispatcherServletInitializerl\u5B9E\u73B0\u4E86WebApplicationInitializer \u53EF\u4EE5\u66F4\u52A0\u5BB9\u6613\u7684\u6CE8\u518CDispathcerServlet\u3002\n\u4E0B\u9762\u662F\u4F7F\u7528Java\u914D\u7F6E\u7684Spring\n`Java\npublic class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n@Override\nprotected Class&lt;?&gt;[] getRootConfigClasses() {\n    return null;\n}\n\n@Override\nprotected Class&lt;?&gt;[] getServletConfigClasses() {\n    return new Class&lt;?&gt;[] { MyWebConfig.class };\n}\n\n@Override\nprotected String[] getServletMappings() {\n    return new String[] { &quot;/&quot; };\n}\n\n}\n`\n\n\u5982\u679C\u4F7F\u7528\u7684\u662Fxml\u914D\u7F6E\uFF0C\u9700\u8981\u76F4\u63A5\u7EE7\u627FAbstractDispatcherServletInitializer\n`Java\npublic class MyWebAppInitializer extends AbstractDispatcherServletInitializer {\n\n@Override\nprotected WebApplicationContext createRootApplicationContext() {\n    return null;\n}\n\n@Override\nprotected WebApplicationContext createServletApplicationContext() {\n    XmlWebApplicationContext cxt = new XmlWebApplicationContext();\n    cxt.setConfigLocation(&quot;/WEB-INF/spring/dispatcher-config.xml&quot;);\n    return cxt;\n}\n\n@Override\nprotected String[] getServletMappings() {\n    return new String[] { &quot;/&quot; };\n}\n\n}\n`\n\nAbstractDispatcherServletInitializer\u540C\u6837\u63D0\u4F9B\u4E86\u4E00\u4E2A\u65B9\u4FBF\u7684\u51FD\u6570\u6765\u6DFB\u52A0\u8FC7\u6EE4\u5668\u3002\n`Java\npublic class MyWebAppInitializer extends AbstractDispatcherServletInitializer {\n\n// ...\n\n@Override\nprotected Filter[] getServletFilters() {\n    return new Filter[] {\n        new HiddenHttpMethodFilter(), new CharacterEncodingFilter() };\n}\n\n}\n`\n\n\u6BCF\u4E2A\u8FC7\u6EE4\u5668\u6839\u636E\u4ED6\u5177\u4F53\u7684\u7C7B\u578B\u6DFB\u52A0\u4E00\u4E2A\u9ED8\u8BA4\u7684\u540D\u5B57\uFF0C\u5E76\u4E14\u81EA\u52A8\u6620\u5C04\u5230DispatcherServlet\u3002\nisAsyncSupported\u65B9\u6CD5\u662FAbstractDispatcherServletInitializer\u7684protect\u7684\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u542F\u52A8DispatcherServlet\u652F\u6301\u5F02\u6B65\u5904\u7406\n\u5982\u679C\u8981\u5B9A\u4E49\u81EA\u5DF1\u7684DispatcherServlet\uFF0C\u90A3\u4E48\u53EF\u4EE5\u91CD\u5199createDispatcherServlet\u65B9\u6CD5\u3002\n\n\u5904\u7406\u8BF7\u6C42\n\nDispatcherServlet\u5904\u7406\u8BF7\u6C42\u7684\u6D41\u7A0B\u5982\u4E0B\uFF1A  - \u67E5\u627EWebApplicationContext\u5E76\u5C06\u5176\u4F5C\u4E3Arequest\u7684\u4E00\u4E2A\u5C5E\u6027\u4FDD\u5B58\u8D77\u6765\uFF0C\u4EE5\u4FBF\u5176\u4ED6\u63A7\u5236\u5668\u6216\u8005\u5904\u7406\u94FE\u4E2D\u7684\u7EC4\u4EF6\u53EF\u4EE5\u4F7F\u7528\u3002\u9ED8\u8BA4\u4FDD\u5B58\u952E\u4E3ADispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE \n  - \u672C\u5730\u5316\u89E3\u6790\u5668\u4FDD\u5B58\u5728request\u4E2D\uFF0C\u4EE5\u4FBF\u5904\u7406\u94FE\u4E2D\u7684\u5176\u4ED6\u7EC4\u4EF6\u4F7F\u7528\u4ED6\u6765\u5904\u7406\u8BF7\u6C42\u505A\u672C\u5730\u5316\u5904\u7406\u3002\u5982\u679C\u4E0D\u9700\u8981\u672C\u5730\u5316\uFF0C\u90A3\u4E48\u5C31\u4E0D\u9700\u8981\u4F7F\u7528\u4ED6\u3002\n  - \u4E3B\u9898\u89E3\u6790\u5668\u4FDD\u5B58\u5728request\u4E2D\uFF0C\u4EE5\u4FBF\u5176\u4ED6\u7EC4\u4EF6\uFF0C\u4F8B\u5982\u89C6\u56FE\u67E5\u627E\u5668\u4F7F\u7528\uFF0C\u5982\u679C\u4E0D\u9700\u8981\u8981\u4E3B\u9898\u5B9A\u5236\uFF0C\u76F4\u63A5\u5FFD\u7565\u3002\n  - \u5982\u679C\u6307\u5B9A\u4E86\u6587\u4EF6\u4E0A\u4F20\u89E3\u6790\u5668\uFF0C\u90A3\u4E48\u5C31\u4F1A\u68C0\u67E5\u8BF7\u6C42\u662F\u5426\u6709\u6587\u4EF6\u4E0A\u4F20\uFF0C\u5982\u679C\u6709\u8BF7\u6C42\u6709MultipartHttpServletRequest\u5C01\u88C5\uFF0C\u4EE5\u4FBF\u5176\u4ED6\u7EC4\u4EF6\u5904\u7406\u3002\n  - \u67E5\u627E\u5408\u9002\u7684\u5904\u7406\u5668\u5904\u7406\u8BF7\u6C42\u3002\u5982\u679C\u627E\u5230\u4E86\u5904\u7406\u5668\uFF0C\u90A3\u4E48\u5C31\u4F9D\u6B21\u6267\u884C\u5904\u7406\u94FE\u4E0A\u7684\u7EC4\u4EF6\uFF0C\u8FD4\u56DE\u4E00\u4E2Amodel\u6216\u8005\u89C6\u56FE\u3002\u5982\u679C\u662F\u6CE8\u89E3\u7684controller\u4E5F\u53EF\u4EE5\u76F4\u63A5\u6E32\u67D3\u800C\u4E0D\u9700\u8981\u8FD4\u56DE\u89C6\u56FE\u3002\n  - \u5982\u679C\u8FD4\u56DE\u4E00\u4E2Amodel\uFF0C\u4F1A\u6E32\u67D3\u4E00\u4E2A\u89C6\u56FE\uFF0C\u5982\u679C\u6CA1\u6709\u8FD4\u56DEmodel\uFF0C\u90A3\u4E48\u5C31\u65E0\u9700\u6E32\u67D3\u89C6\u56FE\u4E86\uFF0C\u56E0\u4E3A\u89C6\u56FE\u53EF\u80FD\u5DF2\u7ECF\u88AB\u6E32\u67D3\u4E86\u3002\n\n\u5728\u8BF7\u6C42\u5904\u7406\u8FC7\u7A0B\u4E2D\u5982\u679C\u51FA\u73B0\u4E86\u4E00\u573A\u90A3\u4E48\u5C31\u53EF\u4EE5\u4F7F\u7528WebApplicatioContext\u4E2D\u7684HandlerExceptionResolver\u6765\u5B9A\u5236\u5F02\u5E38\u5904\u7406\u3002\nSpringMVC \u540C\u6837\u652F\u6301\u8FD4\u56DElast-modification-date\uFF0C\u5BF9\u6307\u5B9A\u8BF7\u6C42\u5904\u7406\u5982\u4F55\u5224\u65AD\u662F\u5426\u6709last-modification-date\u975E\u5E38\u76F4\u63A5\uFF1ADispatcherServlet\u67E5\u627E\u9002\u5408\u7684\u5904\u7406\u5668\uFF0C\u5E76\u4E14\u68C0\u67E5\u5176\u662F\u5426\u5B9E\u73B0\u4E86LastModified\u63A5\u53E3\uFF0C\u5982\u679C\u5B9E\u73B0\u4E86\uFF0C\u8C03\u7528long getLastModified(request)\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002\n\u901A\u8FC7web.xml\u4E2DServlet\u7684\u521D\u59CB\u5316\u53C2\u6570\u53EF\u4EE5\u5B9A\u5236DispatcherServlet.\n\n\u53C2\u6570 | \u89E3\u91CA |\n:---------- | :---------\ncontextClass | \u5B9E\u73B0WebApplicationContext\u7684\u7C7B\uFF0C\u9ED8\u8BA4\u4F7F\u7528XmlWebApplicationContext \ncontextConfigLocation | \u4F20\u9012\u7ED9Context \u5B9E\u4F8B\u7684\u5B57\u7B26\u4E32\uFF0C\u5305\u62EC\u4E86bean\u7684\u5B9A\u4E49 \nnamespace | WebApplicationContext \u7684\u547D\u540D\u7A7A\u95F4\uFF0C\u9ED8\u8BA4[servlet-name]-servlet \n\n\u62E6\u622A\u5668\n\nHandlerMapping\u652F\u6301\u62E6\u622A\u5668\uFF0C\u5728\u5BF9\u67D0\u4E9B\u8BF7\u6C42\u6DFB\u52A0\u5904\u7406\u7684\u65F6\u5019\u975E\u5E38\u6709\u7528\uFF0C\u6BD4\u5982\uFF0C\u6743\u9650\u68C0\u67E5\u3002\u62E6\u622A\u5668\u5FC5\u987B\u5B9E\u73B0org.springframework.web.servlet\u5305\u4E2D\u7684HandlerInterceptor\uFF0C\u8FD9\u4E2A\u63A5\u53E3\u6709\u4E09\u4E2A\u5904\u7406\u51FD\u6570\u5206\u522B\u5BF9\u5E94\u8BF7\u6C42\u5904\u7406\u524D\uFF0C\u8BF7\u6C42\u5904\u7406\u540E\uFF0C\u5B8C\u6210\u8BF7\u6C42\u5904\u7406\u3002\n  - preHandle(..) \u5728\u8BF7\u6C42\u5904\u7406\u524D\u6267\u884C\n  - postHandle(..) \u8BF7\u6C42\u5904\u7406\u540E\u6267\u884C\n  - afterCompletion(..) \u6574\u4E2A\u8BF7\u6C42\u5904\u7406\u7ED3\u675F\u540E\u6267\u884C\npreHandle(..) \u8FD4\u56DE\u4E00\u4E2Aboolean\u503C\u3002\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E2A\u503C\u6765\u4E2D\u65AD\u5904\u7406\u8BF7\u6C42\u94FE\u3002\u5F53\u8FD4\u56DEtrue\u7684\u65F6\u5019\uFF0C\u5904\u7406\u5C06\u4F1A\u7EE7\u7EED\u6267\u884C\uFF0C\u5982\u679C\u8FD4\u56DEfalse\uFF0CDispatcherServelt\u5047\u5B9A\u62E6\u622A\u5668\u5DF2\u7ECF\u5BF9\u8BF7\u6C42\u6B63\u786E\u5904\u7406\u4E86\uFF0C\u4F8B\u5982\u6E32\u67D3\u4E86\u4E00\u4E2A\u9875\u9762\u7B49\u3002\u5C06\u4F1A\u4E2D\u65AD\u8BF7\u6C42\u5904\u7406\u94FE\u3002\n\u6CE8\u610F\uFF0CpostHandle\u65B9\u6CD5\u5F88\u5C11\u4F7F\u7528@ResponseBody\u548CResponseEntity\u3002\u56E0\u4E3A\u54CD\u5E94\u5DF2\u7ECF\u5728postHandle\u6267\u884C\u4E4B\u524D\u6709HandlerAdapter\u8FD4\u56DE\u4E86\u3002\u610F\u5473\u7740\u5728postHandle\u7684\u65F6\u5019\u518D\u4FEE\u6539\u54CD\u5E94\u5DF2\u7ECF\u665A\u4E86\u3002\u5BF9\u5E94\u8FD9\u79CD\u573A\u666F\u53EF\u4EE5\u7EE7\u627FResponseBodyAdvice\u6216\u8005\u5B9E\u73B0ControllerAdvice\u6216\u8005\u76F4\u63A5\u914D\u7F6ERequestMappingHandlerAdapter\u6765\u5B9E\u73B0\u3002\n\n\u5F02\u5E38\u5904\u7406\n\n\u5982\u679C\u5728\u8BF7\u6C42\u6620\u5C04\u6216\u8005\u5904\u7406\u8BF7\u6C42\u7684\u65F6\u5019\u629B\u51FA\u5F02\u5E38\uFF0CDispatcherServelt\u4F1A\u59D4\u6258HandlerExceptionResolver\u6765\u89E3\u6790\u5F02\u5E38\u5E76\u63D0\u4F9B\u53EF\u9009\u62E9\u7684\u5904\u7406\uFF0C\u5373\u8FD4\u4E00\u4E2A\u9519\u8BEF\u54CD\u5E94\u3002\n\u4E0B\u8868\u662FHandlerExceptionResolver\u7684\u5B9E\u73B0\n\n HandlerExceptionResolver | \u63CF\u8FF0 \n:---------- | :---------\nSimpleMappingExceptionResolver | \u5F02\u5E38\u7C7B\u540D\u548C\u9519\u8BEF\u9875\u9762\u540D\u7684\u6620\u5C04\u3002\u6D4F\u89C8\u5668\u6E32\u67D3\u9519\u8BEF\u9875\u9762\u7684\u65F6\u5019\u975E\u5E38\u5B9E\u7528 \nDefaultHandlerExceptionResolver | \u89E3\u6790SpringMVC\u629B\u51FA\u7684\u5F02\u5E38\uFF0C\u540C\u65F6\u5C06\u5176\u6620\u5C04\u5230HTTP\u7684\u9519\u8BEF\u7801\u4E0AResponseStatusExceptionResolver | \u89E3\u6790@ResponseStatus\u6CE8\u89E3\uFF0C\u540C\u65F6\u6839\u636E\u5176\u6CE8\u89E3\u503C\u5C06\u5176\u6620\u5C04\u5230HTTP\u7684\u9519\u8BEF\u7801\u4E0AExceptionHandlerExceptionResolver | \u8C03\u7528@Controller \u6216\u8005@ControllerAdvice \u7C7B\u4E2D\u4F7F\u7528@ExceptionHandler\u6CE8\u89E3\u7684\u65B9\u6CD5 \n\n\u89E3\u6790\u94FE\n\n\u53EF\u4EE5\u901A\u8FC7\u5728Spring\u7684\u914D\u7F6E\u4E2D\u58F0\u660E\u591A\u4E2AHandlerExceptionResolverbean\uFF0C\u6765\u6784\u6210\u4E00\u4E2A\u5F02\u5E38\u5904\u7406\u89E3\u6790\u94FE\uFF0C\u5982\u679C\u9700\u8981\u7684\u8BDD\uFF0C\u540C\u65F6\u53EF\u4EE5\u8BBE\u7F6E\u4ED6\u4EEC\u89E3\u6790\u7684\u987A\u5E8F\u3002\u5E8F\u53F7\u8D8A\u5927\uFF0C\u5904\u7406\u8D8A\u9760\u540E\u3002\nHandlerExceptionResolver\u53EF\u4EE5\u8FD4\u56DE\uFF1A\n  - \u6307\u5411\u9519\u8BEF\u9875\u9762\u7684 ModelAndView\n  - \u5982\u679C\u5F02\u5E38\u5728\u89E3\u6790\u94FE\u4E2D\u88AB\u5904\u7406\u8FD4\u56DE\u7A7AModelAndView\n  - \u5982\u679C\u5F02\u5E38\u4E3A\u88AB\u5904\u7406\u8FD4\u56DEnull\uFF0C\u540E\u7EED\u7684\u89E3\u6790\u8D77\u7EE7\u7EED\u5904\u7406\u5F02\u5E38\uFF0C\u5982\u679C\u5F02\u5E38\u4E00\u76F4\u672A\u88AB\u5904\u7406\uFF0C\u90A3\u4E48\u5C06\u4F1A\u5192\u6CE1\u5230Servlet\u5BB9\u5668\u5904\u7406\nSpring MVC\u7684\u5F02\u5E38\u662F\u6709MVC\u914D\u7F6E\u81EA\u52A8\u58F0\u660E\u7684\uFF0C@ResponseStatus\u6CE8\u89E3\u5F02\u5E38\uFF0C\u652F\u6301@ExceptionHandler\u65B9\u6CD5\u7684\u5F02\u5E38\u3002\u8FD9\u4E9B\u5904\u7406\u5668\u90FD\u662F\u53EF\u4EE5\u5B9A\u5236\u548C\u66FF\u6362\u7684\n\nServlet\u5BB9\u5668\u5F02\u5E38\n\n\u5982\u679CHandlerExceptionResolver\u65E0\u6CD5\u5904\u7406\u5F02\u5E38\uFF0C\u90A3\u4E48\u5F02\u5E38\u5C06\u4F1A\u7EE7\u7EED\u4F20\u64AD\uFF0C\u6216\u8005\u662F\u8FD4\u56DE\u4E86\u9519\u8BEF\u7684HTTP\u72B6\u6001\u7801\uFF0C\u4F8B\u59824xx\uFF0C5xx\u3002Servlet\u5BB9\u5668\u53EF\u80FD\u4F1A\u6E32\u67D3\u4E00\u4E2A\u9519\u8BEF\u7684\u9875\u9762\u3002\u8FD9\u4E2A\u9875\u9762\u4E5F\u662F\u53EF\u4EE5\u5B9A\u5236\u7684\uFF1A\nxml\n&lt;error-page&gt;\n    &lt;location&gt;/error&lt;/location&gt;\n&lt;/error-page&gt;\n\n\n\u6839\u636E\u4E0A\u8FF0\u4EE3\u7801\uFF0C\u5F53\u51FA\u73B0\u4E86\u65E0\u6CD5\u5904\u7406\u7684\u5F02\u5E38\uFF0C\u6216\u8005\u8FD4\u56DE\u9519\u8BEF\u7801\uFF0C\u5BB9\u5668\u4F1A\u6839\u636E\u914D\u7F6E\u8FD4\u56DE\u4E00\u4E2A\u9519\u8BEF\u7684URL\u3002\u8FD9\u4E2A\u8BF7\u6C42\u5C06\u4F1A\u7EE7\u7EED\u88ABDispatcherServlet\u5904\u7406\uFF0C\u6BD4\u5982\u6620\u5C04\u5230\u4E00\u4E2A@Controller\u7684\u9519\u8BEF\u5904\u7406\u63A7\u5236\u5668\u4E0A\uFF1A\n`Java\n@RestController\npublic class ErrorController {\n\n@RequestMapping(path = &quot;/error&quot;)\npublic Map&lt;String, Object&gt; handle(HttpServletRequest request) {\n    Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();\n    map.put(&quot;status&quot;, request.getAttribute(&quot;javax.servlet.error.status_code&quot;));\n    map.put(&quot;reason&quot;, request.getAttribute(&quot;javax.servlet.error.message&quot;));\n    return map;\n}\n\n}\n`\n\n\u89C6\u56FE\u89E3\u6790\n\nSpring MVC\u901A\u8FC7\u5B9A\u4E49\u4E86ViewResolver\u548CView\u4E24\u4E2A\u63A5\u53E3\u53EF\u4EE5\u8BA9\u6211\u4EEC\u76F4\u63A5\u901A\u8FC7\u8FD4\u56DEmodel\u6765\u6E32\u67D3\u89C6\u56FE\uFF0C\u800C\u4E0D\u9700\u8981\u6307\u5B9A\u67D0\u4E00\u4E2A\u7279\u5B9A\u7684\u89C6\u56FE\u6280\u672F\u3002ViewResolver\u63D0\u4F9B\u4E86\u89C6\u56FE\u540D\u548C\u89C6\u56FE\u4E4B\u95F4\u7684\u6620\u5C04\u5173\u7CFB\u3002\u5728\u63D0\u4EA4\u7ED9\u7279\u5B9A\u89C6\u56FE\u6280\u672F\u4E4B\u524D\u7531View\u6765\u51C6\u5907\u6570\u636E\u3002\n\u4E0B\u5217\u8868\u683C\u5C55\u793A\u4E86ViewResolver\u7684\u5C42\u7EA7\uFF1A\n\n ViewResolver | \u63CF\u8FF0 \n:---------- | :---------\nAbstractCachingViewResolver | \u7F13\u5B58\u89E3\u6790\u8FC7\u7684\u89C6\u56FE\u3002\u53EF\u8BBE\u7F6Ecache\u5C5E\u6027\u4E3Afalse\u6765\u5173\u95ED\u7F13\u5B58\u3002\u5728\u9700\u8981\u5237\u65B0\u7F13\u5B58\u7684\u573A\u666F\u53EF\u8C03\u7528removeFromCache(String viewName, Locale loc)\u5237\u65B0\u3002\nXmlViewResolver | \u5B9E\u73B0ViewResolver\uFF0C\u53EF\u4EE5\u63A5\u6536\u4E00\u4E2A\u540CSpring XML bean\u540CDTD\u7684xml\u914D\u7F6E\u6587\u4EF6\u3002\u9ED8\u8BA4\u5728/WEB-INF/views.xml\nResourceBundleViewResolver | \u89E3\u6790\u5B9A\u4E49\u5728ResourceBundle\u4E2D\u7684\u89C6\u56FE\uFF0C\u4F7F\u7528viewname.class\u4F5C\u4E3A\u89C6\u56FE\u7C7B\uFF0Cviewname.url\u4F5C\u4E3A\u89C6\u56FE\u540D\nUrlBasedViewResolver | \u65E0\u9700\u660E\u786E\u6307\u5B9A\u6620\u5C04\uFF0C\u76F4\u63A5\u901A\u8FC7\u89E3\u6790url\u6765\u67E5\u627E\u89C6\u56FE\u540D\u3002\nInternalResourceViewResolver | \u5B9E\u73B0UrlBasedViewResolver,JstlView,TilesView\uFF0C\u652F\u6301InternalResourceView\u4F8B\u5982\uFF1Ajsp\uFF0Cservlet class\u7B49\u3002\nFreeMarkerViewResolver | UrlBasedViewResolver\u7684\u5B50\u7C7B\uFF0C\u7528\u6765\u652F\u6301FreeMarker\nContentNegotiatingViewResolver | \u6839\u636E\u8BF7\u6C42\u7684\u6587\u4EF6\u540D\u6216\u8005Accept\u6765\u786E\u5B9A\u89C6\u56FE\n\n\u89C6\u56FE\u5904\u7406\n\n\u5982\u679C\u9700\u8981\u7684\u8BDD\uFF0C\u53EF\u4EE5\u58F0\u660E\u591A\u4E2A\u89C6\u56FE\u5904\u7406\u5668\uFF0C\u901A\u8FC7\u8BBE\u7F6Eorder\u5C5E\u6027\u6765\u786E\u5B9A\u4ED6\u4EEC\u7684\u987A\u5E8F\u3002order\u8D8A\u5927\uFF0C\u5904\u7406\u8D8A\u9760\u540E\u3002\n\u9ED8\u8BA4\u60C5\u51B5\u4E0BViewResolver\u53EF\u4EE5\u8FD4\u56DEnull\u4EE3\u8868\u627E\u4E0D\u5230\u89C6\u56FE\u3002\u5F53\u7136\u5728JSP\u4E2D\uFF0C\u4F7F\u7528InternalResourceViewResolver\u6765\u68C0\u67E5JSP\u662F\u5426\u5B58\u5728\u7684\u552F\u4E00\u65B9\u5F0F\u5C31\u662F\u901A\u8FC7RequestDispatcher\u6267\u884C\u4E00\u6B21\u8C03\u5EA6\u3002\u56E0\u6B64InternalResourceViewResolver\u5FC5\u987B\u662F\u6700\u540E\u4E00\u4E2A\u89C6\u56FE\u89E3\u6790\u5668\u3002\n\n\u89C6\u56FEredirect\n\n\u89C6\u56FE\u524D\u7F00redirect: \u8868\u793A\u89C6\u56FE\u9700\u8981\u6267\u884C\u4E00\u6B21redirect\u3002UrlBasedViewResolver\u548C\u5176\u5B50\u7C7B\u4F1A\u8BC6\u522B\u51FA\u8FD9\u662F\u8981\u7ED9\u91CD\u5B9A\u5411\uFF0C\u5269\u4E0B\u7684\u90E8\u5206\u5C31\u662F\u89C6\u56FE\u540D\u3002\n\u8FD9\u4E2A\u6548\u679C\u548CController\u8FD4\u56DE\u4E00\u4E2ARedirectView\u4E00\u6837\uFF0C\u4F46\u662F\u4F7F\u7528\u8FD9\u4E2A\u6307\u4EE4\uFF0Ccontroller\u5C31\u53EF\u4EE5\u7B80\u5355\u7684\u8FD4\u56DE\u4E00\u4E2A\u89C6\u56FE\u540D\u5C31\u53EF\u4EE5\u4E86\u3002\u89C6\u56FE\u540Dredirect:/myapp/some/resource\u5C06\u4F1A\u8FD4\u56DE\u76F8\u5BF9\u4E8E\u5F53\u524DServlet Context\u7684\u89C6\u56FE\uFF0Credirect:http://myhost.com/some/arbitrary/path \u8FD9\u79CD\u5219\u4F1A\u8FD4\u56DE\u7EDD\u5BF9URL\u3002\n\u6CE8\u610F\uFF0C\u5982\u679C\u4E00\u4E2Acontroller\u88AB@ResponseStatus\u4FEE\u9970\uFF0C\u90A3\u4E48\u6CE8\u89E3\u503C\u4F18\u5148\u7EA7\u9AD8\u4E8ERedirectView\n\n\u89C6\u56FEForwarding\n\n\u89C6\u56FE\u524D\u7F00forward:\xA0\u8868\u793A\u89C6\u56FE\u6267\u884Cforwarding\u3002\u540C\u6837\u7531UrlBasedViewResolver\u548C\u5176\u5B50\u7C7B\u89E3\u6790\u3002\u901A\u8FC7\u521B\u5EFAInternalResourceView\u6267\u884CRequestDispatcher.forward()\u5B9E\u73B0\u3002\u56E0\u6B64\u8FD9\u4E2A\u6307\u4EE4\u5BF9\u4E8EInternalResourceViewResolver\u548CInternalResourceViewResolver\u6CA1\u5565\u7528\uFF0C\u4F46\u662F\u5BF9\u4E8E\u4F7F\u7528\u4E86\u5176\u4ED6\u7684\u89C6\u56FE\u6280\u672F\u4F46\u662F\u4ECD\u7136\u60F3\u7528\u5F3A\u5236\u4F7F\u7528JSP\u6216\u8005Servlet\u7684\u65F6\u5019\u5C31\u5F88\u6709\u7528\u4E86\u3002\n\n\u89C6\u56FE\u5185\u5BB9\u534F\u5546\n\nContentNegotiatingViewResolver\u5E76\u4E0D\u4F1A\u89E3\u6790\u89C6\u56FE\uFF0C\u800C\u662F\u5C06\u5176\u59D4\u6258\u7ED9\u5176\u4ED6\u89C6\u56FE\u89E3\u6790\u5668\uFF0C\u5E76\u4E14\u9009\u62E9\u5BA2\u6237\u7AEF\u8BF7\u6C42\u63CF\u8FF0\u9009\u62E9\u89C6\u56FE\u3002\u63CF\u8FF0\u53EF\u4EE5\u662FAccept\u5934\u6216\u8005\u53C2\u6570\uFF0C\u4F8B\u5982/path?format=pdf\nContentNegotiatingViewResolver\u901A\u8FC7\u5BF9\u6BD4\u8BF7\u6C42\u7684\u5A92\u4F53\u7C7B\u578B\u548CViewResolvers\u652F\u6301\u7684\u5A92\u4F53\u7C7B\u578B\u6765\u9009\u62E9\u5408\u9002\u7684View\u3002\u88AB\u9009\u4E2D\u7684\u5217\u8868\u4E2D\u7684\u7B2C\u4E00\u4E2AView\u5C06\u4F1A\u88AB\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002\n\n\u672C\u5730\u5316\n\n\u540CSpring MVC\uFF0C\u5927\u591A\u6570Spring\u67B6\u6784\u652F\u6301\u56FD\u9645\u5316\u3002DispatcherServlet\u901A\u8FC7LocaleResolver\u6839\u636E\u5BA2\u6237\u7AEF\u7684\u533A\u57DF\u81EA\u52A8\u89E3\u6790\u6D88\u606F\u3002\n\u5F53\u8BF7\u6C42\u5230\u6765\u65F6DispatcherServlet\u67E5\u627E\u672C\u5730\u5316\u89E3\u6790\u5668\uFF0C\u5982\u679C\u627E\u5230\u5219\u4F1A\u8BBE\u7F6E\u672C\u5730\u5316\u3002\u901A\u8FC7RequestContext.getLocale()\u65B9\u6CD5\u53EF\u4EE5\u83B7\u53D6\u7531\u672C\u5730\u5316\u89E3\u6790\u5668\u89E3\u6790\u7684\u672C\u5730\u5316\u8BED\u8A00\u3002\n\u4E3A\u4E86\u81EA\u52A8\u5316\u89E3\u6790\uFF0C\u53EF\u4EE5\u901A\u8FC7\u62E6\u622A\u5668\u5BF9\u5177\u4F53\u7684\u573A\u666F\u8FDB\u884C\u672C\u5730\u5316\u89E3\u6790\uFF0C\u4F8B\u5982\u6839\u636E\u8BF7\u6C42\u53C2\u6570\u6765\u89E3\u6790\u3002\n\u672C\u5730\u5316\u89E3\u6790\u5668\u548C\u62E6\u622A\u5668\u5B9A\u4E49\u5728org.springframework.web.servlet.i18n\u5305\u4E2D\uFF0C\u53EF\u4EE5\u5728\u5E94\u7528\u4E2D\u914D\u7F6E\u3002\u4E0B\u9762\u662F\u4E00\u4E9BSpring\u4F7F\u7528\u7684\u914D\u7F6E\n\nTimeZone\n\n\u901A\u8FC7\u83B7\u53D6\u5BA2\u6237\u7AEF\u7684\u65F6\u533A\u6765\u505A\u672C\u5730\u5316\u3002LocaleContextResolver\u63A5\u53E3\u6269\u5C55\u4E86LocalResolver\uFF0C\u63D0\u4F9B\u4E86\u4E00\u4E2A\u53EF\u80FD\u5305\u542B\u65F6\u533A\u4FE1\u606F\u7684LocaleContext\u3002\n\u5982\u679C\u53EF\u4EE5\uFF0C\u7528\u6237\u7684\u65F6\u533A\u53EF\u4EE5\u901A\u8FC7RequestContext.getTimeZone()\u65B9\u6CD5\u83B7\u53D6\u3002\u65F6\u533A\u4FE1\u606F\u53EF\u4EE5\u81EA\u52A8\u7684\u88AB\u6CE8\u518C\u5230Spring\u4E2D\u7684ConversionService \u65E5\u671F\u65F6\u95F4\u7684Converter\u548CFormatter\u4F7F\u7528\u3002\n\nHeader resolver\n\n\u8FD9\u4E2A\u89E3\u6790\u5668\u68C0\u67E5accept-language\u5934\uFF0C\u4E00\u822C\u6765\u8BF4\u5305\u542B\u7684\u662F\u5BA2\u6237\u7AEF\u64CD\u4F5C\u7CFB\u7EDF\u7684\u533A\u57DF\u3002\u6CE8\u610F\u8FD9\u4E2A\u4E0D\u652F\u6301\u65F6\u533A\u3002\n\nCookie resolver\n\n\u8FD9\u4E2A\u89E3\u6790\u5668\u68C0\u67E5cookie\u4E2D\u53EF\u80FD\u5305\u542B\u7684TimeZone\u548CLocale\u3002\u901A\u8FC7\u5982\u4E0B\u5B9A\u4E49\u6765\u4F7F\u7528\uFF1A\n`xml\n&lt;bean id=&quot;localeResolver&quot; class=&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;&gt;\n\n&lt;property name=&quot;cookieName&quot; value=&quot;clientlanguage&quot;/&gt;\n\n&lt;!-- in seconds. If set to -1, the cookie is not persisted (deleted when browser shuts down) --&gt;\n&lt;property name=&quot;cookieMaxAge&quot; value=&quot;100000&quot;/&gt;\n\n&lt;/bean&gt;\n`\n\nCookieLocaleResolver\u7684\u5C5E\u6027\uFF1A\n\n \u540D\u5B57 | \u9ED8\u8BA4\u503C | \u63CF\u8FF0 \n:---------- | :--------- | :----------\ncookieName | classname + LOCALE | cookie\u540D\ncookieMaxAge | Servlet\u5BB9\u5668\u9ED8\u8BA4\u503C | cookie\u751F\u6548\u65F6\u95F4\ncookiePath | / | cookie \u4FDD\u5B58\u4F4D\u7F6E\n\nSession resolver\n\nSessionLocaleResolver\u901A\u8FC7\u4ECEsession\u4E2D\u68C0\u67E5\u53EF\u80FD\u5305\u542B\u7684TimeZone\u548CLocale\u3002\u76F8\u5BF9\u4E8ECookieLocaleResolver\uFF0C\u4ED6\u5C06\u4FE1\u606F\u4FDD\u5B58\u5728HttpSession\u4E2D\u3002\n\nLocale interceptor\n\n\u53EF\u4EE5\u901A\u8FC7\u62E6\u622A\u5668\u542F\u52A8\u9488\u5BF9\u67D0\u4E9B\u6620\u5C04\u7684\u672C\u5730\u5316\u7B56\u7565\uFF0C\u4F8B\u5982\u5982\u4E0B\uFF1A\n`xml\n&lt;bean id=&quot;localeChangeInterceptor&quot;\n        class=&quot;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&quot;&gt;\n    &lt;property name=&quot;paramName&quot; value=&quot;siteLanguage&quot;/&gt;\n&lt;/bean&gt;\n\n&lt;bean id=&quot;localeResolver&quot;\n        class=&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;/&gt;\n\n&lt;bean id=&quot;urlMapping&quot;\n        class=&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;&gt;\n    &lt;property name=&quot;interceptors&quot;&gt;\n        &lt;list&gt;\n            &lt;ref bean=&quot;localeChangeInterceptor&quot;/&gt;\n        &lt;/list&gt;\n    &lt;/property&gt;\n    &lt;property name=&quot;mappings&quot;&gt;\n        &lt;value&gt;/**/*.view=someController&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/bean&gt;\n`\n\n\u4E3B\u9898\n\n\u53EF\u4EE5\u901A\u8FC7\u8BBE\u7F6ESpring MVC\u7684\u4E3B\u9898\u6765\u6574\u4F53\u8BBE\u7F6E\u5E94\u7528\u7684\u5916\u89C2\uFF0C\u4ECE\u800C\u63D0\u9AD8\u7528\u6237\u4F53\u9A8C\u3002\u4E3B\u9898\u662F\u4E00\u4E9B\u9759\u6001\u8D44\u6E90\u7684\u96C6\u5408\uFF0C\u4E3B\u8981\u662F\u53EF\u4EE5\u5F71\u54CD\u5916\u89C2\u7684\u6837\u5F0F\u8868\u548C\u56FE\u7247\u3002\n\u4E3A\u4E86\u5E94\u7528\u4E3B\u9898\uFF0C\u9996\u5148\u8981\u8BBE\u7F6E\u4E00\u4E2Aorg.springframework.ui.context.ThemeSource\u7684\u63A5\u53E3\u3002WebApplicationContext\u7EE7\u627F\u4E86ThemeSource\uFF0C\u4F46\u662F\u5C06\u5176\u5B9E\u73B0\u59D4\u6258\u7ED9\u4E86\u5B50\u7C7B\u3002\u9ED8\u8BA4\u4F7F\u7528\u7684\u662Forg.springframework.ui.context.support.ResourceBundleThemeSource\u6765\u4ECEclasspath\u7684\u6839\u76EE\u5F55\u4E0B\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\u3002\u914D\u7F6E\u6587\u4EF6\u683C\u5F0F\u5982\u4E0B\uFF1A\n\nstyleSheet=/themes/cool/style.css\nbackground=/themes/cool/img/coolBg.jpg\n\n\u914D\u7F6E\u6587\u4EF6\u7684\u540D\u5B57\u662F\u89C6\u56FE\u4EE3\u7801\u4E2D\u7684\u53D8\u91CF\u540D\u3002\u5BF9\u4E8EJSP\u800C\u8A00\u53EF\u4EE5\u5982\u4E0B\u663E\u793A\uFF1A\nJSP\n&lt;%@ taglib prefix=&quot;spring&quot; uri=&quot;http://www.springframework.org/tags&quot;%&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;link rel=&quot;stylesheet&quot; href=&quot;&lt;spring:theme code=&#39;styleSheet&#39;/&gt;&quot; type=&quot;text/css&quot;/&gt;\n    &lt;/head&gt;\n    &lt;body style=&quot;background=&lt;spring:theme code=&#39;background&#39;/&gt;&quot;&gt;\n        ...\n    &lt;/body&gt;\n&lt;/html&gt;\n\n\n\u9ED8\u8BA4\u60C5\u51B5\u4E0BResourceBundleThemeSource\u4F7F\u7528\u7A7A\u7684\u524D\u7F00\u540D\uFF0C\u8FD9\u6837\u914D\u7F6E\u6587\u4EF6\u76F4\u63A5\u4ECEclasspath\u6839\u76EE\u5F55\u4E0B\u52A0\u8F7D\u3002\u8FD9\u6837\u5C31\u53EF\u4EE5\u5C06cool.properties\u5B9A\u4E49\u653E\u5230classpath\u6839\u76EE\u5F55\u4E0B\uFF0CResourceBundleThemeSource\u9ED8\u8BA4\u4F7F\u7528\u6807\u51C6\u7684Java\u8D44\u6E90\u52A0\u8F7D\u5DE5\u5177\uFF0C\u540C\u65F6\u4E5F\u5B8C\u5168\u652F\u6301\u56FD\u9645\u5316\uFF0C\u6240\u4EE5\u901A\u8FC7\u547D\u540D\u6765\u652F\u6301cool_nl.properties\u3002\n\n\u89E3\u6790\u4E3B\u9898\n\nDispatcherServlet\u901A\u8FC7bean\u7684\u540D\u5B57themeResolver\u6765\u67E5\u627EThemeResolver\u7684\u5B9E\u73B0\u3002\nThemeResolver \u7684\u5B9E\u73B0\u5982\u4E0B\uFF1A\n\nClass | \u63CF\u8FF0 \n:---------- | :---------\nFixedThemeResolver | \u9009\u4E2D\u4E00\u4E2A\u56FA\u5B9A\u7684\u4E3B\u9898\uFF0C\u8BBE\u7F6EdefaultThemeName\u5C5E\u6027\nSessionThemeResolver | \u4E3B\u9898\u7531\u7528\u6237session\u7EF4\u62A4\u3002\u6BCF\u4E2Asession\u53EA\u9700\u8981\u8BBE\u7F6E\u4E00\u6B21\nCookieThemeResolver | \u901A\u8FC7cookie\u9009\u62E9\u4E3B\u9898\n\nMultipart resolver\n\norg.springframework.web.multipart\u4E2D\u7684MultipartResolver\u662F\u7528\u6765\u5904\u7406multipart\u8BF7\u6C42\u7684\u3002\u5171\u6709\u7ED9\u4E88Common Fileupload\u548CServlet 3.0 \u4E24\u79CD\u5B9E\u73B0\u3002\n\u4E3A\u4E86\u4F7F\u7528multipart\uFF0C\u9700\u8981\u5728DispatcherServlet\u7684Spring\u914D\u7F6E\u4E2D\u58F0\u660E\u4E00\u4E2A\u540D\u5B57\u4E3AmultipartResolver\u7684bean\u3002\u5F53POST\u8BF7\u6C42\u7684content-type\u662Fmultipart/form-data\u7684\u65F6\u5019\uFF0C\u89E3\u6790\u5668\u89E3\u6790\u8FD9\u4E2A\u8BF7\u6C42\u5E76\u4E14\u5C06HttpServletRequest\u5C01\u88C5\u6210MultipartHttpServletRequest\u6765\u5904\u7406\u8BF7\u6C42\u3002\n\nApache FileUpload\n\n\u4F7F\u7528Apache Commons FileUpload \u53EA\u9700\u8981\u7B80\u5355\u7684\u914D\u7F6E\u4E00\u4E2A\u7C7B\u578B\u4E3ACommonsMultipartResolver\uFF0C\u540D\u5B57\u4E3AmultipartResolver\u7684bean\u5373\u53EF\u3002\u5F53\u7136\u4E5F\u9700\u8981\u5C06commons-fileupload\u52A0\u5165\u5230\u4F9D\u8D56\u4E2D\u3002\n\nServlet 3.0\n\n\u4F7F\u7528Servlet 3.0\u5219\u9700\u8981Servlet \u5BB9\u5668\u7684\u914D\u7F6E\n  - \u4F7F\u7528Java\u914D\u7F6E\uFF0C\u5728Servlet\u6CE8\u518C\u4E2D\u8BBE\u7F6EMultipartConfigElement\u3002\n  - \u4F7F\u7528web.xml \u6DFB\u52A0\u8981\u7ED9&lt;multipart-config&gt;\u7684\u914D\u7F6E\n\u5982\u4E0B\u662F\u4F7F\u7528Java\u7684\u914D\u7F6E\uFF1A\n\n`Java\npublic class AppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n// ...\n\n@Override\nprotected void customizeRegistration(ServletRegistration.Dynamic registration) {\n\n    // Optionally also set maxFileSize, maxRequestSize, fileSizeThreshold\n    registration.setMultipartConfig(new MultipartConfigElement(&quot;/tmp&quot;));\n}\n\n}\n`\n\nServlet 3.0\u914D\u7F6E\u597D\u4E4B\u540E\uFF0C\u53EA\u9700\u8981\u6DFB\u52A0\u7C7B\u578B\u4E3AStandardServletMultipartResolver\uFF0C\u540D\u5B57\u4E3AmultipartResolver\u7684\u914D\u7F6E\u5373\u53EF\u3002','readingtime':24,'url':'/cates/backend/post/2018-04-09/spring-mvc-dispatcher-servlet','dirs':['spring-mvc'],'relatives':[{'url':'/cates/backend/post/2018-04-07/deep-in-spring-mvc','title':'\u6DF1\u5165\u7406\u89E3Spring MVC'},{'url':'/cates/backend/post/2018-04-10/spring-mvc-controller','title':'SpringMVC \u6559\u7A0B - Controller'},{'url':'/cates/backend/post/2018-04-09/spring-mvc-filter','title':'SpringMVC \u6559\u7A0B - Filter'}],'body':'\n\n##### \u7B80\u4ECB\n\u540C\u8BB8\u591A\u5176\u4ED6\u7684web\u6846\u67B6\u4E00\u6837\uFF0CSpringMVC\u4F7F\u7528\u4E86\u524D\u7AEF\u63A7\u5236\u5668\u7684\u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u5373\u4E00\u4E2A\u4EE5`DispatcherServlet`\u4E3A\u6838\u5FC3\u7684`Servlet`\u4E3A\u5904\u7406\u8BF7\u6C42\u63D0\u4F9B\u4E86\u4E00\u4E2A\u5171\u4EAB\u7684\u7B97\u6CD5\uFF0C\u800C\u5B9E\u9645\u7684\u5DE5\u4F5C\u662F\u7531\u53EF\u914D\u7F6E\u7684\u59D4\u6258\u7EC4\u4EF6\u6267\u884C\u7684\u3002\u8FD9\u4E2A\u6A21\u5F0F\u5373\u7075\u6D3B\u53C8\u652F\u6301\u591A\u6837\u7684\u5DE5\u4F5C\u6D41\u3002\n\u540C\u5176\u4ED6\u7684`Servlet`,\u4F9D\u7167Servlet \u89C4\u8303`DispatcherServlet`\u9700\u8981\u5728web.xml\u6216\u8005Java\u914D\u7F6E\u4E2D\u58F0\u660E\u5E76\u6620\u5C04URL\u3002\u63A5\u7740`DispatcherServlet`\u4F7F\u7528Spring\u7684\u914D\u7F6E\u6765\u67E5\u627E\u59D4\u6258\u7EC4\u4EF6\uFF0C\u7528\u6765\u6620\u5C04URL\uFF0C\u89E3\u6790\u89C6\u56FE\uFF0C\u5F02\u5E38\u5904\u7406\u7B49\u3002\n\u4E0B\u9762\u8FD9\u4E2A\u793A\u4F8B\u662F\u4F7F\u7528Java\u914D\u7F6E\u6765\u6CE8\u518C\u5E76\u521D\u59CB\u5316`DispatcherServlet`\uFF0C\u8FD9\u4E2A\u7C7B\u7531Servlet\u5BB9\u5668\u81EA\u52A8\u53D1\u73B0\u3002\n```Java\npublic class MyWebApplicationInitializer implements WebApplicationInitializer {\n\n    @Override\n    public void onStartup(ServletContext servletCxt) {\n\n        // Load Spring web application configuration\n        AnnotationConfigWebApplicationContext ac = new AnnotationConfigWebApplicationContext();\n        ac.register(AppConfig.class);\n        ac.refresh();\n\n        // Create and register the DispatcherServlet\n        DispatcherServlet servlet = new DispatcherServlet(ac);\n        ServletRegistration.Dynamic registration = servletCxt.addServlet("app", servlet);\n        registration.setLoadOnStartup(1);\n        registration.addMapping("/app/*");\n    }\n}\n```\n\n\u4E0B\u9762\u8FD9\u4E2A\u793A\u4F8B\u662F\u4F7F\u7528`web.xml`\u6765\u6CE8\u518C\u5E76\u521D\u59CB\u5316\u7684\n```xml\n<web-app>\n\n    <listener>\n        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n    </listener>\n\n    <context-param>\n        <param-name>contextConfigLocation</param-name>\n        <param-value>/WEB-INF/app-context.xml</param-value>\n    </context-param>\n\n    <servlet>\n        <servlet-name>app</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <init-param>\n            <param-name>contextConfigLocation</param-name>\n            <param-value></param-value>\n        </init-param>\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app</servlet-name>\n        <url-pattern>/app/*</url-pattern>\n    </servlet-mapping>\n\n</web-app>\n```\n\n##### \u5C42\u6B21\u7ED3\u6784\n`DispatcherServlet`\u9700\u8981\u4E00\u4E2A\u6269\u5C55\u4E86\u7684`ApplicationContext`\u7684`WebApplicationContext`\u6765\u914D\u7F6E\u81EA\u5DF1\u7684\u4FE1\u606F\u3002`WebApplicationContext`\u5305\u542B\u4E86`Servlet`\u7684`ServletContext`\u7684\u5F15\u7528\uFF0C\u53EF\u4EE5\u4F7F\u7528`RequestContextUtils`\u4E2D\u7684\u9759\u6001\u65B9\u6CD5\u4ECE`WebApplicationContext`\u4E2D\u67E5\u627E`ServletContext`\u3002\n\u5BF9\u4E8E\u5927\u591A\u6570\u5E94\u7528\u6765\u8BF4\u4E00\u4E2A`WebApplicationContext`\u5C31\u8DB3\u591F\u4E86\u3002\u5F53\u7136`WebApplicatioContext`\u4E5F\u53EF\u4EE5\u662F\u6709\u5C42\u6B21\u7ED3\u6784\u7684\uFF0C\u4F8B\u5982\u7531\u591A\u4E2AServlet\u5171\u4EAB\u7684\u4E00\u4E2A\u6839`WebApplicationContext`\uFF0C\u6BCF\u4E2AServlet\u53C8\u6709\u81EA\u5DF1\u7684\u5B50`WebApplicationContext`\u3002\n\u6839`WebApplicationContext`\u4E00\u822C\u5305\u62EC\u9700\u8981\u5728\u591A\u4E2AServlet\u4E2D\u5171\u4EAB\u7684\u57FA\u7840bean\uFF0C\u4F8B\u5982\u6570\u636E\u4ED3\u5E93\uFF0C\u4E1A\u52A1\u903B\u8F91\u7B49\u3002\u5728Servlet\u89C4\u8303\u4E2D\uFF0C\u8FD9\u4E9Bbean\u53EF\u4EE5\u88AB\u6709\u6548\u7684\u7EE7\u627F\u548C\u6539\u5199\uFF0C\u5B50`WebApplicationContext`\u4EC5\u5305\u542B\u5728\u5176\u5C5E\u4E8E\u7684Servlet\u4E2D\u3002\n![spring mvc context](https://raw.githubusercontent.com/mashuai/hexo-blog/master/images/mvc-context-hierarchy.png)\n\u4E0B\u9762\u8FD9\u4E2A\u4F8B\u5B50\u5C31\u662F`WebApplicationContext`\u7684\u5C42\u7EA7\u914D\u7F6E\n```Java\npublic class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n    @Override\n    protected Class<?>[] getRootConfigClasses() {\n        return new Class<?>[] { RootConfig.class };\n    }\n\n    @Override\n    protected Class<?>[] getServletConfigClasses() {\n        return new Class<?>[] { App1Config.class };\n    }\n\n    @Override\n    protected String[] getServletMappings() {\n        return new String[] { "/app1/*" };\n    }\n} \n```\n\n\u540C\u6837\u7684\uFF0C\u5728web.xml\u4E2D\u7684\u914D\u7F6E\n```xml\n<web-app>\n\n    <listener>\n        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n    </listener>\n\n    <context-param>\n        <param-name>contextConfigLocation</param-name>\n        <param-value>/WEB-INF/root-context.xml</param-value>\n    </context-param>\n\n    <servlet>\n        <servlet-name>app1</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <init-param>\n            <param-name>contextConfigLocation</param-name>\n            <param-value>/WEB-INF/app1-context.xml</param-value>\n        </init-param>\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n\n    <servlet-mapping>\n        <servlet-name>app1</servlet-name>\n        <url-pattern>/app1/*</url-pattern>\n    </servlet-mapping>\n\n</web-app>\n```\n\n##### \u7279\u6B8A\u7684bean\u7C7B\u578B\n`DispatcherServlet`\u59D4\u6258\u4E13\u7528\u7684bean\u6765\u5904\u7406\u8BF7\u6C42\uFF0C\u6E32\u67D3\u54CD\u5E94\u3002\u4E13\u7528\u7684bean\u6307\u7684\u662FSpring\u7BA1\u7406\u7684\uFF0C\u5B9E\u73B0WebFlux\u6846\u67B6\u7EA6\u5B9A\u7684\u5B9E\u4F8B\u3002\u8FD9\u4E9Bbean\u4E00\u822C\u90FD\u662F\u5185\u5EFA\u7684\u7EA6\u5B9A\uFF0C\u4F46\u662F\u53EF\u4EE5\u5B9A\u5236\u4ED6\u4EEC\u7684\u5C5E\u6027\uFF0C\u6269\u5C55\u6216\u8005\u4EE3\u66FF\u8FD9\u4E9Bbean\u3002\n\nbean \u7C7B\u578B | \u89E3\u91CA\n:---------- | :---------\nHandlerMapping | \u5904\u7406\u5668\u6620\u5C04\uFF0C\u5177\u4F53\u7531\u5176\u5B50\u7C7B\u5B9E\u73B0\u3002\u4E24\u4E2A\u91CD\u8981\u7684\u5B50\u7C7B\uFF0C`RequestMappingHandlerMapping`,`SimpleUrlHandlerMapping`\nHandlerAdapter | \u8F85\u52A9`DispatcherServlet`\u6267\u884C\u7279\u5B9A\u7684\u5904\u7406\u5668\u3002\nHandlerExceptionResolver | \u5C06\u5F02\u5E38\u91CD\u5B9A\u5411\u5230\u5176\u4ED6\u5904\u7406\u5668\u6216\u8005\u662F\u663E\u793AHTML\u7684\u9519\u8BEF\u754C\u9762\u3002\nViewResolver | \u901A\u8FC7\u5904\u7406\u5668\u8FD4\u56DE\u7684\u89C6\u56FE\u5B57\u7B26\u4E32\u67E5\u627E\u5177\u4F53\u7684\u89C6\u56FE\u5E76\u6E32\u67D3\u3002 \nLocaleResolver, LocaleContextResolver | \u652F\u6301\u56FD\u9645\u5316\u9875\u9762\uFF0C\u4F7F\u7528\u4F8B\u5982\u65F6\u533A\u7B49\u6765\u89E3\u6790\u672C\u5730\u5316\u95EE\u9898\u3002 \nThemeResolver | \u89E3\u6790\u5E94\u7528\u53EF\u7528\u7684\u4E3B\u9898\uFF0C\u4F8B\u5982\u63D0\u4F9B\u4E2A\u6027\u5316\u6846\u67B6 \nMultipartResolver | \u5904\u7406\u4E0A\u4F20\u6587\u4EF6 \nFlashMapManager | \u4FDD\u5B58\u548C\u68C0\u7D22\u8F93\u5165\u8F93\u51FA\u7684FlashMap\uFF0C\u5B83\u53EF\u4EE5\u5C06\u5C5E\u6027\u4ECE\u4E00\u4E2A\u8BF7\u6C42\u4F20\u9012\u5230\u53E6\u4E00\u4E2A\u8BF7\u6C42\u7684\u8F93\u5165\u8F93\u51FA\uFF0C\u4E00\u822C\u5E94\u7528\u5728\u91CD\u5B9A\u5411\u4E2D\u3002 \n\n##### Web MVC \u914D\u7F6E\n\u5E94\u7528\u53EF\u4EE5\u58F0\u660E\u5728\u7279\u6B8A\u7684bean\u7C7B\u578B\u4E2D\u5217\u51FA\u7684bean\u6765\u5904\u7406\u8BF7\u6C42\u3002`DispatcherServlet`\u4F1A\u68C0\u67E5\u6BCF\u4E00\u4E2Abean\u7684`WebApplicationContext`\u3002\u5982\u679C\u6CA1\u6709\u6307\u5B9A\u7684bean\uFF0C\u90A3\u4E48\u5C31\u4F1A\u4F7F\u7528DispatcherServlet.properties\u4E2D\u5B9A\u4E49\u7684bean\u3002\nMVC\u914D\u7F6E\u5C06\u4F1A\u5728\u4EE5\u540E\u8BE6\u7EC6\u7684\u5217\u51FA\u3002\n##### Servlet \u914D\u7F6E\n\u5728Servlet 3.0+\u4E2D\uFF0C\u53EF\u4EE5\u4F7F\u7528\u7F16\u7A0B\u7684\u65B9\u5F0F\u6765\u4EE3\u66FFweb.xml\u914D\u7F6E\u3002\u4E0B\u9762\u8FD9\u4E2A\u4F8B\u5B50\u5C31\u662F\u901A\u8FC7\u7F16\u7A0B\u6CE8\u518C`DispatcherServlet`\n```Java\nimport org.springframework.web.WebApplicationInitializer;\n\npublic class MyWebApplicationInitializer implements WebApplicationInitializer {\n\n    @Override\n    public void onStartup(ServletContext container) {\n        XmlWebApplicationContext appContext = new XmlWebApplicationContext();\n        appContext.setConfigLocation("/WEB-INF/spring/dispatcher-config.xml");\n\n        ServletRegistration.Dynamic registration = container.addServlet("dispatcher", new DispatcherServlet(appContext));\n        registration.setLoadOnStartup(1);\n        registration.addMapping("/");\n    }\n}\n```\n\n`WebApplicationInitializer`\u662F\u7531SpringMVC\u63D0\u4F9B\u7684\u63A5\u53E3\uFF0C\u7528\u6765\u4FDD\u8BC1\u4E0A\u8FF0\u5B9E\u73B0\u53EF\u4EE5\u7531\u652F\u6301Servlet 3.0\u7684\u5BB9\u5668\u81EA\u52A8\u68C0\u6D4B\u5E76\u521D\u59CB\u5316\u3002\u62BD\u8C61\u7C7B`AbstractDispatcherServletInitializerl`\u5B9E\u73B0\u4E86`WebApplicationInitializer` \u53EF\u4EE5\u66F4\u52A0\u5BB9\u6613\u7684\u6CE8\u518C`DispathcerServlet`\u3002\n\u4E0B\u9762\u662F\u4F7F\u7528Java\u914D\u7F6E\u7684Spring\n```Java\npublic class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n    @Override\n    protected Class<?>[] getRootConfigClasses() {\n        return null;\n    }\n\n    @Override\n    protected Class<?>[] getServletConfigClasses() {\n        return new Class<?>[] { MyWebConfig.class };\n    }\n\n    @Override\n    protected String[] getServletMappings() {\n        return new String[] { "/" };\n    }\n}\n```\n\n\u5982\u679C\u4F7F\u7528\u7684\u662Fxml\u914D\u7F6E\uFF0C\u9700\u8981\u76F4\u63A5\u7EE7\u627F`AbstractDispatcherServletInitializer`\n```Java\npublic class MyWebAppInitializer extends AbstractDispatcherServletInitializer {\n\n    @Override\n    protected WebApplicationContext createRootApplicationContext() {\n        return null;\n    }\n\n    @Override\n    protected WebApplicationContext createServletApplicationContext() {\n        XmlWebApplicationContext cxt = new XmlWebApplicationContext();\n        cxt.setConfigLocation("/WEB-INF/spring/dispatcher-config.xml");\n        return cxt;\n    }\n\n    @Override\n    protected String[] getServletMappings() {\n        return new String[] { "/" };\n    }\n}\n```\n\n`AbstractDispatcherServletInitializer`\u540C\u6837\u63D0\u4F9B\u4E86\u4E00\u4E2A\u65B9\u4FBF\u7684\u51FD\u6570\u6765\u6DFB\u52A0\u8FC7\u6EE4\u5668\u3002\n```Java\npublic class MyWebAppInitializer extends AbstractDispatcherServletInitializer {\n\n    // ...\n\n    @Override\n    protected Filter[] getServletFilters() {\n        return new Filter[] {\n            new HiddenHttpMethodFilter(), new CharacterEncodingFilter() };\n    }\n}\n```\n\n\u6BCF\u4E2A\u8FC7\u6EE4\u5668\u6839\u636E\u4ED6\u5177\u4F53\u7684\u7C7B\u578B\u6DFB\u52A0\u4E00\u4E2A\u9ED8\u8BA4\u7684\u540D\u5B57\uFF0C\u5E76\u4E14\u81EA\u52A8\u6620\u5C04\u5230DispatcherServlet\u3002\n`isAsyncSupported`\u65B9\u6CD5\u662F`AbstractDispatcherServletInitializer`\u7684protect\u7684\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u542F\u52A8`DispatcherServlet`\u652F\u6301\u5F02\u6B65\u5904\u7406\n\u5982\u679C\u8981\u5B9A\u4E49\u81EA\u5DF1\u7684DispatcherServlet\uFF0C\u90A3\u4E48\u53EF\u4EE5\u91CD\u5199`createDispatcherServlet`\u65B9\u6CD5\u3002\n##### \u5904\u7406\u8BF7\u6C42\n`DispatcherServlet`\u5904\u7406\u8BF7\u6C42\u7684\u6D41\u7A0B\u5982\u4E0B\uFF1A  \n  - \u67E5\u627E`WebApplicationContext`\u5E76\u5C06\u5176\u4F5C\u4E3Arequest\u7684\u4E00\u4E2A\u5C5E\u6027\u4FDD\u5B58\u8D77\u6765\uFF0C\u4EE5\u4FBF\u5176\u4ED6\u63A7\u5236\u5668\u6216\u8005\u5904\u7406\u94FE\u4E2D\u7684\u7EC4\u4EF6\u53EF\u4EE5\u4F7F\u7528\u3002\u9ED8\u8BA4\u4FDD\u5B58\u952E\u4E3A`DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE` \n  - \u672C\u5730\u5316\u89E3\u6790\u5668\u4FDD\u5B58\u5728request\u4E2D\uFF0C\u4EE5\u4FBF\u5904\u7406\u94FE\u4E2D\u7684\u5176\u4ED6\u7EC4\u4EF6\u4F7F\u7528\u4ED6\u6765\u5904\u7406\u8BF7\u6C42\u505A\u672C\u5730\u5316\u5904\u7406\u3002\u5982\u679C\u4E0D\u9700\u8981\u672C\u5730\u5316\uFF0C\u90A3\u4E48\u5C31\u4E0D\u9700\u8981\u4F7F\u7528\u4ED6\u3002\n  - \u4E3B\u9898\u89E3\u6790\u5668\u4FDD\u5B58\u5728request\u4E2D\uFF0C\u4EE5\u4FBF\u5176\u4ED6\u7EC4\u4EF6\uFF0C\u4F8B\u5982\u89C6\u56FE\u67E5\u627E\u5668\u4F7F\u7528\uFF0C\u5982\u679C\u4E0D\u9700\u8981\u8981\u4E3B\u9898\u5B9A\u5236\uFF0C\u76F4\u63A5\u5FFD\u7565\u3002\n  - \u5982\u679C\u6307\u5B9A\u4E86\u6587\u4EF6\u4E0A\u4F20\u89E3\u6790\u5668\uFF0C\u90A3\u4E48\u5C31\u4F1A\u68C0\u67E5\u8BF7\u6C42\u662F\u5426\u6709\u6587\u4EF6\u4E0A\u4F20\uFF0C\u5982\u679C\u6709\u8BF7\u6C42\u6709`MultipartHttpServletRequest`\u5C01\u88C5\uFF0C\u4EE5\u4FBF\u5176\u4ED6\u7EC4\u4EF6\u5904\u7406\u3002\n  - \u67E5\u627E\u5408\u9002\u7684\u5904\u7406\u5668\u5904\u7406\u8BF7\u6C42\u3002\u5982\u679C\u627E\u5230\u4E86\u5904\u7406\u5668\uFF0C\u90A3\u4E48\u5C31\u4F9D\u6B21\u6267\u884C\u5904\u7406\u94FE\u4E0A\u7684\u7EC4\u4EF6\uFF0C\u8FD4\u56DE\u4E00\u4E2Amodel\u6216\u8005\u89C6\u56FE\u3002\u5982\u679C\u662F\u6CE8\u89E3\u7684controller\u4E5F\u53EF\u4EE5\u76F4\u63A5\u6E32\u67D3\u800C\u4E0D\u9700\u8981\u8FD4\u56DE\u89C6\u56FE\u3002\n  - \u5982\u679C\u8FD4\u56DE\u4E00\u4E2Amodel\uFF0C\u4F1A\u6E32\u67D3\u4E00\u4E2A\u89C6\u56FE\uFF0C\u5982\u679C\u6CA1\u6709\u8FD4\u56DEmodel\uFF0C\u90A3\u4E48\u5C31\u65E0\u9700\u6E32\u67D3\u89C6\u56FE\u4E86\uFF0C\u56E0\u4E3A\u89C6\u56FE\u53EF\u80FD\u5DF2\u7ECF\u88AB\u6E32\u67D3\u4E86\u3002\n\n\u5728\u8BF7\u6C42\u5904\u7406\u8FC7\u7A0B\u4E2D\u5982\u679C\u51FA\u73B0\u4E86\u4E00\u573A\u90A3\u4E48\u5C31\u53EF\u4EE5\u4F7F\u7528`WebApplicatioContext`\u4E2D\u7684`HandlerExceptionResolver`\u6765\u5B9A\u5236\u5F02\u5E38\u5904\u7406\u3002\nSpringMVC \u540C\u6837\u652F\u6301\u8FD4\u56DE`last-modification-date`\uFF0C\u5BF9\u6307\u5B9A\u8BF7\u6C42\u5904\u7406\u5982\u4F55\u5224\u65AD\u662F\u5426\u6709`last-modification-date`\u975E\u5E38\u76F4\u63A5\uFF1A`DispatcherServlet`\u67E5\u627E\u9002\u5408\u7684\u5904\u7406\u5668\uFF0C\u5E76\u4E14\u68C0\u67E5\u5176\u662F\u5426\u5B9E\u73B0\u4E86`LastModified`\u63A5\u53E3\uFF0C\u5982\u679C\u5B9E\u73B0\u4E86\uFF0C\u8C03\u7528`long getLastModified(request)`\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002\n\u901A\u8FC7web.xml\u4E2DServlet\u7684\u521D\u59CB\u5316\u53C2\u6570\u53EF\u4EE5\u5B9A\u5236DispatcherServlet.\n\n\u53C2\u6570 | \u89E3\u91CA |\n:---------- | :---------\ncontextClass | \u5B9E\u73B0`WebApplicationContext`\u7684\u7C7B\uFF0C\u9ED8\u8BA4\u4F7F\u7528`XmlWebApplicationContext` \ncontextConfigLocation | \u4F20\u9012\u7ED9Context \u5B9E\u4F8B\u7684\u5B57\u7B26\u4E32\uFF0C\u5305\u62EC\u4E86bean\u7684\u5B9A\u4E49 \nnamespace | `WebApplicationContext` \u7684\u547D\u540D\u7A7A\u95F4\uFF0C\u9ED8\u8BA4`[servlet-name]-servlet` \n\n##### \u62E6\u622A\u5668\n`HandlerMapping`\u652F\u6301\u62E6\u622A\u5668\uFF0C\u5728\u5BF9\u67D0\u4E9B\u8BF7\u6C42\u6DFB\u52A0\u5904\u7406\u7684\u65F6\u5019\u975E\u5E38\u6709\u7528\uFF0C\u6BD4\u5982\uFF0C\u6743\u9650\u68C0\u67E5\u3002\u62E6\u622A\u5668\u5FC5\u987B\u5B9E\u73B0`org.springframework.web.servlet`\u5305\u4E2D\u7684`HandlerInterceptor`\uFF0C\u8FD9\u4E2A\u63A5\u53E3\u6709\u4E09\u4E2A\u5904\u7406\u51FD\u6570\u5206\u522B\u5BF9\u5E94\u8BF7\u6C42\u5904\u7406\u524D\uFF0C\u8BF7\u6C42\u5904\u7406\u540E\uFF0C\u5B8C\u6210\u8BF7\u6C42\u5904\u7406\u3002\n  - preHandle(..) \u5728\u8BF7\u6C42\u5904\u7406\u524D\u6267\u884C\n  - postHandle(..) \u8BF7\u6C42\u5904\u7406\u540E\u6267\u884C\n  - afterCompletion(..) \u6574\u4E2A\u8BF7\u6C42\u5904\u7406\u7ED3\u675F\u540E\u6267\u884C\n`preHandle(..)` \u8FD4\u56DE\u4E00\u4E2Aboolean\u503C\u3002\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E2A\u503C\u6765\u4E2D\u65AD\u5904\u7406\u8BF7\u6C42\u94FE\u3002\u5F53\u8FD4\u56DEtrue\u7684\u65F6\u5019\uFF0C\u5904\u7406\u5C06\u4F1A\u7EE7\u7EED\u6267\u884C\uFF0C\u5982\u679C\u8FD4\u56DEfalse\uFF0C`DispatcherServelt`\u5047\u5B9A\u62E6\u622A\u5668\u5DF2\u7ECF\u5BF9\u8BF7\u6C42\u6B63\u786E\u5904\u7406\u4E86\uFF0C\u4F8B\u5982\u6E32\u67D3\u4E86\u4E00\u4E2A\u9875\u9762\u7B49\u3002\u5C06\u4F1A\u4E2D\u65AD\u8BF7\u6C42\u5904\u7406\u94FE\u3002\n\u6CE8\u610F\uFF0C`postHandle`\u65B9\u6CD5\u5F88\u5C11\u4F7F\u7528`@ResponseBody`\u548C`ResponseEntity`\u3002\u56E0\u4E3A\u54CD\u5E94\u5DF2\u7ECF\u5728`postHandle`\u6267\u884C\u4E4B\u524D\u6709`HandlerAdapter`\u8FD4\u56DE\u4E86\u3002\u610F\u5473\u7740\u5728`postHandle`\u7684\u65F6\u5019\u518D\u4FEE\u6539\u54CD\u5E94\u5DF2\u7ECF\u665A\u4E86\u3002\u5BF9\u5E94\u8FD9\u79CD\u573A\u666F\u53EF\u4EE5\u7EE7\u627F`ResponseBodyAdvice`\u6216\u8005\u5B9E\u73B0ControllerAdvice\u6216\u8005\u76F4\u63A5\u914D\u7F6E`RequestMappingHandlerAdapter`\u6765\u5B9E\u73B0\u3002\n\n##### \u5F02\u5E38\u5904\u7406\n\u5982\u679C\u5728\u8BF7\u6C42\u6620\u5C04\u6216\u8005\u5904\u7406\u8BF7\u6C42\u7684\u65F6\u5019\u629B\u51FA\u5F02\u5E38\uFF0C`DispatcherServelt`\u4F1A\u59D4\u6258`HandlerExceptionResolver`\u6765\u89E3\u6790\u5F02\u5E38\u5E76\u63D0\u4F9B\u53EF\u9009\u62E9\u7684\u5904\u7406\uFF0C\u5373\u8FD4\u4E00\u4E2A\u9519\u8BEF\u54CD\u5E94\u3002\n\u4E0B\u8868\u662F`HandlerExceptionResolver`\u7684\u5B9E\u73B0\n\n HandlerExceptionResolver | \u63CF\u8FF0 \n:---------- | :---------\nSimpleMappingExceptionResolver | \u5F02\u5E38\u7C7B\u540D\u548C\u9519\u8BEF\u9875\u9762\u540D\u7684\u6620\u5C04\u3002\u6D4F\u89C8\u5668\u6E32\u67D3\u9519\u8BEF\u9875\u9762\u7684\u65F6\u5019\u975E\u5E38\u5B9E\u7528 \nDefaultHandlerExceptionResolver | \u89E3\u6790SpringMVC\u629B\u51FA\u7684\u5F02\u5E38\uFF0C\u540C\u65F6\u5C06\u5176\u6620\u5C04\u5230HTTP\u7684\u9519\u8BEF\u7801\u4E0A  \nResponseStatusExceptionResolver | \u89E3\u6790@ResponseStatus\u6CE8\u89E3\uFF0C\u540C\u65F6\u6839\u636E\u5176\u6CE8\u89E3\u503C\u5C06\u5176\u6620\u5C04\u5230HTTP\u7684\u9519\u8BEF\u7801\u4E0A  \nExceptionHandlerExceptionResolver | \u8C03\u7528@Controller \u6216\u8005@ControllerAdvice \u7C7B\u4E2D\u4F7F\u7528@ExceptionHandler\u6CE8\u89E3\u7684\u65B9\u6CD5 \n\n###### \u89E3\u6790\u94FE\n\u53EF\u4EE5\u901A\u8FC7\u5728Spring\u7684\u914D\u7F6E\u4E2D\u58F0\u660E\u591A\u4E2A`HandlerExceptionResolver`bean\uFF0C\u6765\u6784\u6210\u4E00\u4E2A\u5F02\u5E38\u5904\u7406\u89E3\u6790\u94FE\uFF0C\u5982\u679C\u9700\u8981\u7684\u8BDD\uFF0C\u540C\u65F6\u53EF\u4EE5\u8BBE\u7F6E\u4ED6\u4EEC\u89E3\u6790\u7684\u987A\u5E8F\u3002\u5E8F\u53F7\u8D8A\u5927\uFF0C\u5904\u7406\u8D8A\u9760\u540E\u3002\n`HandlerExceptionResolver`\u53EF\u4EE5\u8FD4\u56DE\uFF1A\n  - \u6307\u5411\u9519\u8BEF\u9875\u9762\u7684 `ModelAndView`\n  - \u5982\u679C\u5F02\u5E38\u5728\u89E3\u6790\u94FE\u4E2D\u88AB\u5904\u7406\u8FD4\u56DE\u7A7A`ModelAndView`\n  - \u5982\u679C\u5F02\u5E38\u4E3A\u88AB\u5904\u7406\u8FD4\u56DE`null`\uFF0C\u540E\u7EED\u7684\u89E3\u6790\u8D77\u7EE7\u7EED\u5904\u7406\u5F02\u5E38\uFF0C\u5982\u679C\u5F02\u5E38\u4E00\u76F4\u672A\u88AB\u5904\u7406\uFF0C\u90A3\u4E48\u5C06\u4F1A\u5192\u6CE1\u5230Servlet\u5BB9\u5668\u5904\u7406\nSpring MVC\u7684\u5F02\u5E38\u662F\u6709MVC\u914D\u7F6E\u81EA\u52A8\u58F0\u660E\u7684\uFF0C@ResponseStatus\u6CE8\u89E3\u5F02\u5E38\uFF0C\u652F\u6301@ExceptionHandler\u65B9\u6CD5\u7684\u5F02\u5E38\u3002\u8FD9\u4E9B\u5904\u7406\u5668\u90FD\u662F\u53EF\u4EE5\u5B9A\u5236\u548C\u66FF\u6362\u7684\n###### Servlet\u5BB9\u5668\u5F02\u5E38\n\u5982\u679C`HandlerExceptionResolver`\u65E0\u6CD5\u5904\u7406\u5F02\u5E38\uFF0C\u90A3\u4E48\u5F02\u5E38\u5C06\u4F1A\u7EE7\u7EED\u4F20\u64AD\uFF0C\u6216\u8005\u662F\u8FD4\u56DE\u4E86\u9519\u8BEF\u7684HTTP\u72B6\u6001\u7801\uFF0C\u4F8B\u59824xx\uFF0C5xx\u3002Servlet\u5BB9\u5668\u53EF\u80FD\u4F1A\u6E32\u67D3\u4E00\u4E2A\u9519\u8BEF\u7684\u9875\u9762\u3002\u8FD9\u4E2A\u9875\u9762\u4E5F\u662F\u53EF\u4EE5\u5B9A\u5236\u7684\uFF1A\n```xml\n<error-page>\n    <location>/error</location>\n</error-page>\n```\n\n\u6839\u636E\u4E0A\u8FF0\u4EE3\u7801\uFF0C\u5F53\u51FA\u73B0\u4E86\u65E0\u6CD5\u5904\u7406\u7684\u5F02\u5E38\uFF0C\u6216\u8005\u8FD4\u56DE\u9519\u8BEF\u7801\uFF0C\u5BB9\u5668\u4F1A\u6839\u636E\u914D\u7F6E\u8FD4\u56DE\u4E00\u4E2A\u9519\u8BEF\u7684URL\u3002\u8FD9\u4E2A\u8BF7\u6C42\u5C06\u4F1A\u7EE7\u7EED\u88ABDispatcherServlet\u5904\u7406\uFF0C\u6BD4\u5982\u6620\u5C04\u5230\u4E00\u4E2A@Controller\u7684\u9519\u8BEF\u5904\u7406\u63A7\u5236\u5668\u4E0A\uFF1A\n```Java\n@RestController\npublic class ErrorController {\n\n    @RequestMapping(path = "/error")\n    public Map<String, Object> handle(HttpServletRequest request) {\n        Map<String, Object> map = new HashMap<String, Object>();\n        map.put("status", request.getAttribute("javax.servlet.error.status_code"));\n        map.put("reason", request.getAttribute("javax.servlet.error.message"));\n        return map;\n    }\n}\n```\n\n##### \u89C6\u56FE\u89E3\u6790\nSpring MVC\u901A\u8FC7\u5B9A\u4E49\u4E86`ViewResolver`\u548C`View`\u4E24\u4E2A\u63A5\u53E3\u53EF\u4EE5\u8BA9\u6211\u4EEC\u76F4\u63A5\u901A\u8FC7\u8FD4\u56DEmodel\u6765\u6E32\u67D3\u89C6\u56FE\uFF0C\u800C\u4E0D\u9700\u8981\u6307\u5B9A\u67D0\u4E00\u4E2A\u7279\u5B9A\u7684\u89C6\u56FE\u6280\u672F\u3002`ViewResolver`\u63D0\u4F9B\u4E86\u89C6\u56FE\u540D\u548C\u89C6\u56FE\u4E4B\u95F4\u7684\u6620\u5C04\u5173\u7CFB\u3002\u5728\u63D0\u4EA4\u7ED9\u7279\u5B9A\u89C6\u56FE\u6280\u672F\u4E4B\u524D\u7531`View`\u6765\u51C6\u5907\u6570\u636E\u3002\n\u4E0B\u5217\u8868\u683C\u5C55\u793A\u4E86ViewResolver\u7684\u5C42\u7EA7\uFF1A\n\n ViewResolver | \u63CF\u8FF0 \n:---------- | :---------\nAbstractCachingViewResolver | \u7F13\u5B58\u89E3\u6790\u8FC7\u7684\u89C6\u56FE\u3002\u53EF\u8BBE\u7F6Ecache\u5C5E\u6027\u4E3Afalse\u6765\u5173\u95ED\u7F13\u5B58\u3002\u5728\u9700\u8981\u5237\u65B0\u7F13\u5B58\u7684\u573A\u666F\u53EF\u8C03\u7528`removeFromCache(String viewName, Locale loc)`\u5237\u65B0\u3002\nXmlViewResolver | \u5B9E\u73B0`ViewResolver`\uFF0C\u53EF\u4EE5\u63A5\u6536\u4E00\u4E2A\u540CSpring XML bean\u540CDTD\u7684xml\u914D\u7F6E\u6587\u4EF6\u3002\u9ED8\u8BA4\u5728/WEB-INF/views.xml\nResourceBundleViewResolver | \u89E3\u6790\u5B9A\u4E49\u5728`ResourceBundle`\u4E2D\u7684\u89C6\u56FE\uFF0C\u4F7F\u7528viewname.class\u4F5C\u4E3A\u89C6\u56FE\u7C7B\uFF0Cviewname.url\u4F5C\u4E3A\u89C6\u56FE\u540D\nUrlBasedViewResolver | \u65E0\u9700\u660E\u786E\u6307\u5B9A\u6620\u5C04\uFF0C\u76F4\u63A5\u901A\u8FC7\u89E3\u6790url\u6765\u67E5\u627E\u89C6\u56FE\u540D\u3002\nInternalResourceViewResolver | \u5B9E\u73B0`UrlBasedViewResolver`,`JstlView`,`TilesView`\uFF0C\u652F\u6301`InternalResourceView`\u4F8B\u5982\uFF1Ajsp\uFF0Cservlet class\u7B49\u3002\nFreeMarkerViewResolver | `UrlBasedViewResolver`\u7684\u5B50\u7C7B\uFF0C\u7528\u6765\u652F\u6301FreeMarker\nContentNegotiatingViewResolver | \u6839\u636E\u8BF7\u6C42\u7684\u6587\u4EF6\u540D\u6216\u8005Accept\u6765\u786E\u5B9A\u89C6\u56FE\n\n###### \u89C6\u56FE\u5904\u7406\n\u5982\u679C\u9700\u8981\u7684\u8BDD\uFF0C\u53EF\u4EE5\u58F0\u660E\u591A\u4E2A\u89C6\u56FE\u5904\u7406\u5668\uFF0C\u901A\u8FC7\u8BBE\u7F6E`order`\u5C5E\u6027\u6765\u786E\u5B9A\u4ED6\u4EEC\u7684\u987A\u5E8F\u3002order\u8D8A\u5927\uFF0C\u5904\u7406\u8D8A\u9760\u540E\u3002\n\u9ED8\u8BA4\u60C5\u51B5\u4E0B`ViewResolver`\u53EF\u4EE5\u8FD4\u56DEnull\u4EE3\u8868\u627E\u4E0D\u5230\u89C6\u56FE\u3002\u5F53\u7136\u5728JSP\u4E2D\uFF0C\u4F7F\u7528InternalResourceViewResolver\u6765\u68C0\u67E5JSP\u662F\u5426\u5B58\u5728\u7684\u552F\u4E00\u65B9\u5F0F\u5C31\u662F\u901A\u8FC7`RequestDispatcher`\u6267\u884C\u4E00\u6B21\u8C03\u5EA6\u3002\u56E0\u6B64`InternalResourceViewResolver`\u5FC5\u987B\u662F\u6700\u540E\u4E00\u4E2A\u89C6\u56FE\u89E3\u6790\u5668\u3002\n###### \u89C6\u56FEredirect\n\u89C6\u56FE\u524D\u7F00`redirect:` \u8868\u793A\u89C6\u56FE\u9700\u8981\u6267\u884C\u4E00\u6B21redirect\u3002`UrlBasedViewResolver`\u548C\u5176\u5B50\u7C7B\u4F1A\u8BC6\u522B\u51FA\u8FD9\u662F\u8981\u7ED9\u91CD\u5B9A\u5411\uFF0C\u5269\u4E0B\u7684\u90E8\u5206\u5C31\u662F\u89C6\u56FE\u540D\u3002\n\u8FD9\u4E2A\u6548\u679C\u548CController\u8FD4\u56DE\u4E00\u4E2A`RedirectView`\u4E00\u6837\uFF0C\u4F46\u662F\u4F7F\u7528\u8FD9\u4E2A\u6307\u4EE4\uFF0Ccontroller\u5C31\u53EF\u4EE5\u7B80\u5355\u7684\u8FD4\u56DE\u4E00\u4E2A\u89C6\u56FE\u540D\u5C31\u53EF\u4EE5\u4E86\u3002\u89C6\u56FE\u540D`redirect:/myapp/some/resource`\u5C06\u4F1A\u8FD4\u56DE\u76F8\u5BF9\u4E8E\u5F53\u524DServlet Context\u7684\u89C6\u56FE\uFF0C`redirect:http://myhost.com/some/arbitrary/path` \u8FD9\u79CD\u5219\u4F1A\u8FD4\u56DE\u7EDD\u5BF9URL\u3002\n\u6CE8\u610F\uFF0C\u5982\u679C\u4E00\u4E2Acontroller\u88AB`@ResponseStatus`\u4FEE\u9970\uFF0C\u90A3\u4E48\u6CE8\u89E3\u503C\u4F18\u5148\u7EA7\u9AD8\u4E8E`RedirectView`\n###### \u89C6\u56FEForwarding\n\u89C6\u56FE\u524D\u7F00`forward:\xA0`\u8868\u793A\u89C6\u56FE\u6267\u884Cforwarding\u3002\u540C\u6837\u7531`UrlBasedViewResolver`\u548C\u5176\u5B50\u7C7B\u89E3\u6790\u3002\u901A\u8FC7\u521B\u5EFA`InternalResourceView`\u6267\u884C`RequestDispatcher.forward()`\u5B9E\u73B0\u3002\u56E0\u6B64\u8FD9\u4E2A\u6307\u4EE4\u5BF9\u4E8E`InternalResourceViewResolver`\u548C`InternalResourceViewResolver`\u6CA1\u5565\u7528\uFF0C\u4F46\u662F\u5BF9\u4E8E\u4F7F\u7528\u4E86\u5176\u4ED6\u7684\u89C6\u56FE\u6280\u672F\u4F46\u662F\u4ECD\u7136\u60F3\u7528\u5F3A\u5236\u4F7F\u7528JSP\u6216\u8005Servlet\u7684\u65F6\u5019\u5C31\u5F88\u6709\u7528\u4E86\u3002\n###### \u89C6\u56FE\u5185\u5BB9\u534F\u5546\n`ContentNegotiatingViewResolver`\u5E76\u4E0D\u4F1A\u89E3\u6790\u89C6\u56FE\uFF0C\u800C\u662F\u5C06\u5176\u59D4\u6258\u7ED9\u5176\u4ED6\u89C6\u56FE\u89E3\u6790\u5668\uFF0C\u5E76\u4E14\u9009\u62E9\u5BA2\u6237\u7AEF\u8BF7\u6C42\u63CF\u8FF0\u9009\u62E9\u89C6\u56FE\u3002\u63CF\u8FF0\u53EF\u4EE5\u662FAccept\u5934\u6216\u8005\u53C2\u6570\uFF0C\u4F8B\u5982`/path?format=pdf`\n`ContentNegotiatingViewResolver`\u901A\u8FC7\u5BF9\u6BD4\u8BF7\u6C42\u7684\u5A92\u4F53\u7C7B\u578B\u548C`ViewResolvers`\u652F\u6301\u7684\u5A92\u4F53\u7C7B\u578B\u6765\u9009\u62E9\u5408\u9002\u7684View\u3002\u88AB\u9009\u4E2D\u7684\u5217\u8868\u4E2D\u7684\u7B2C\u4E00\u4E2AView\u5C06\u4F1A\u88AB\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002\n##### \u672C\u5730\u5316\n\u540CSpring MVC\uFF0C\u5927\u591A\u6570Spring\u67B6\u6784\u652F\u6301\u56FD\u9645\u5316\u3002`DispatcherServlet`\u901A\u8FC7`LocaleResolver`\u6839\u636E\u5BA2\u6237\u7AEF\u7684\u533A\u57DF\u81EA\u52A8\u89E3\u6790\u6D88\u606F\u3002\n\u5F53\u8BF7\u6C42\u5230\u6765\u65F6`DispatcherServlet`\u67E5\u627E\u672C\u5730\u5316\u89E3\u6790\u5668\uFF0C\u5982\u679C\u627E\u5230\u5219\u4F1A\u8BBE\u7F6E\u672C\u5730\u5316\u3002\u901A\u8FC7`RequestContext.getLocale()`\u65B9\u6CD5\u53EF\u4EE5\u83B7\u53D6\u7531\u672C\u5730\u5316\u89E3\u6790\u5668\u89E3\u6790\u7684\u672C\u5730\u5316\u8BED\u8A00\u3002\n\u4E3A\u4E86\u81EA\u52A8\u5316\u89E3\u6790\uFF0C\u53EF\u4EE5\u901A\u8FC7\u62E6\u622A\u5668\u5BF9\u5177\u4F53\u7684\u573A\u666F\u8FDB\u884C\u672C\u5730\u5316\u89E3\u6790\uFF0C\u4F8B\u5982\u6839\u636E\u8BF7\u6C42\u53C2\u6570\u6765\u89E3\u6790\u3002\n\u672C\u5730\u5316\u89E3\u6790\u5668\u548C\u62E6\u622A\u5668\u5B9A\u4E49\u5728`org.springframework.web.servlet.i18n`\u5305\u4E2D\uFF0C\u53EF\u4EE5\u5728\u5E94\u7528\u4E2D\u914D\u7F6E\u3002\u4E0B\u9762\u662F\u4E00\u4E9BSpring\u4F7F\u7528\u7684\u914D\u7F6E\n\n###### TimeZone\n\u901A\u8FC7\u83B7\u53D6\u5BA2\u6237\u7AEF\u7684\u65F6\u533A\u6765\u505A\u672C\u5730\u5316\u3002`LocaleContextResolver`\u63A5\u53E3\u6269\u5C55\u4E86`LocalResolver`\uFF0C\u63D0\u4F9B\u4E86\u4E00\u4E2A\u53EF\u80FD\u5305\u542B\u65F6\u533A\u4FE1\u606F\u7684`LocaleContext`\u3002\n\u5982\u679C\u53EF\u4EE5\uFF0C\u7528\u6237\u7684\u65F6\u533A\u53EF\u4EE5\u901A\u8FC7`RequestContext.getTimeZone()`\u65B9\u6CD5\u83B7\u53D6\u3002\u65F6\u533A\u4FE1\u606F\u53EF\u4EE5\u81EA\u52A8\u7684\u88AB\u6CE8\u518C\u5230Spring\u4E2D\u7684ConversionService \u65E5\u671F\u65F6\u95F4\u7684Converter\u548CFormatter\u4F7F\u7528\u3002\n###### Header resolver\n\u8FD9\u4E2A\u89E3\u6790\u5668\u68C0\u67E5`accept-language`\u5934\uFF0C\u4E00\u822C\u6765\u8BF4\u5305\u542B\u7684\u662F\u5BA2\u6237\u7AEF\u64CD\u4F5C\u7CFB\u7EDF\u7684\u533A\u57DF\u3002\u6CE8\u610F\u8FD9\u4E2A\u4E0D\u652F\u6301\u65F6\u533A\u3002\n###### Cookie resolver\n\u8FD9\u4E2A\u89E3\u6790\u5668\u68C0\u67E5cookie\u4E2D\u53EF\u80FD\u5305\u542B\u7684`TimeZone`\u548C`Locale`\u3002\u901A\u8FC7\u5982\u4E0B\u5B9A\u4E49\u6765\u4F7F\u7528\uFF1A\n```xml\n<bean id="localeResolver" class="org.springframework.web.servlet.i18n.CookieLocaleResolver">\n\n    <property name="cookieName" value="clientlanguage"/>\n\n    \x3C!-- in seconds. If set to -1, the cookie is not persisted (deleted when browser shuts down) -->\n    <property name="cookieMaxAge" value="100000"/>\n\n</bean>\n```\n\nCookieLocaleResolver\u7684\u5C5E\u6027\uFF1A\n\n \u540D\u5B57 | \u9ED8\u8BA4\u503C | \u63CF\u8FF0 \n:---------- | :--------- | :----------\ncookieName | classname + LOCALE | cookie\u540D\ncookieMaxAge | Servlet\u5BB9\u5668\u9ED8\u8BA4\u503C | cookie\u751F\u6548\u65F6\u95F4\ncookiePath | / | cookie \u4FDD\u5B58\u4F4D\u7F6E\n\n###### Session resolver\n`SessionLocaleResolver`\u901A\u8FC7\u4ECEsession\u4E2D\u68C0\u67E5\u53EF\u80FD\u5305\u542B\u7684`TimeZone`\u548C`Locale`\u3002\u76F8\u5BF9\u4E8E`CookieLocaleResolver`\uFF0C\u4ED6\u5C06\u4FE1\u606F\u4FDD\u5B58\u5728`HttpSession`\u4E2D\u3002\n###### Locale interceptor\n\u53EF\u4EE5\u901A\u8FC7\u62E6\u622A\u5668\u542F\u52A8\u9488\u5BF9\u67D0\u4E9B\u6620\u5C04\u7684\u672C\u5730\u5316\u7B56\u7565\uFF0C\u4F8B\u5982\u5982\u4E0B\uFF1A\n```xml\n<bean id="localeChangeInterceptor"\n        class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor">\n    <property name="paramName" value="siteLanguage"/>\n</bean>\n\n<bean id="localeResolver"\n        class="org.springframework.web.servlet.i18n.CookieLocaleResolver"/>\n\n<bean id="urlMapping"\n        class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">\n    <property name="interceptors">\n        <list>\n            <ref bean="localeChangeInterceptor"/>\n        </list>\n    </property>\n    <property name="mappings">\n        <value>/**/*.view=someController</value>\n    </property>\n</bean>\n```\n\n##### \u4E3B\u9898\n\u53EF\u4EE5\u901A\u8FC7\u8BBE\u7F6ESpring MVC\u7684\u4E3B\u9898\u6765\u6574\u4F53\u8BBE\u7F6E\u5E94\u7528\u7684\u5916\u89C2\uFF0C\u4ECE\u800C\u63D0\u9AD8\u7528\u6237\u4F53\u9A8C\u3002\u4E3B\u9898\u662F\u4E00\u4E9B\u9759\u6001\u8D44\u6E90\u7684\u96C6\u5408\uFF0C\u4E3B\u8981\u662F\u53EF\u4EE5\u5F71\u54CD\u5916\u89C2\u7684\u6837\u5F0F\u8868\u548C\u56FE\u7247\u3002\n\u4E3A\u4E86\u5E94\u7528\u4E3B\u9898\uFF0C\u9996\u5148\u8981\u8BBE\u7F6E\u4E00\u4E2A`org.springframework.ui.context.ThemeSource`\u7684\u63A5\u53E3\u3002`WebApplicationContext`\u7EE7\u627F\u4E86`ThemeSource`\uFF0C\u4F46\u662F\u5C06\u5176\u5B9E\u73B0\u59D4\u6258\u7ED9\u4E86\u5B50\u7C7B\u3002\u9ED8\u8BA4\u4F7F\u7528\u7684\u662F`org.springframework.ui.context.support.ResourceBundleThemeSource`\u6765\u4ECEclasspath\u7684\u6839\u76EE\u5F55\u4E0B\u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6\u3002\u914D\u7F6E\u6587\u4EF6\u683C\u5F0F\u5982\u4E0B\uFF1A\n```\nstyleSheet=/themes/cool/style.css\nbackground=/themes/cool/img/coolBg.jpg\n```\n\u914D\u7F6E\u6587\u4EF6\u7684\u540D\u5B57\u662F\u89C6\u56FE\u4EE3\u7801\u4E2D\u7684\u53D8\u91CF\u540D\u3002\u5BF9\u4E8EJSP\u800C\u8A00\u53EF\u4EE5\u5982\u4E0B\u663E\u793A\uFF1A\n```JSP\n<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>\n<html>\n    <head>\n        <link rel="stylesheet" href="<spring:theme code=\'styleSheet\'/>" type="text/css"/>\n    </head>\n    <body style="background=<spring:theme code=\'background\'/>">\n        ...\n    </body>\n</html>\n```\n\n\u9ED8\u8BA4\u60C5\u51B5\u4E0B`ResourceBundleThemeSource`\u4F7F\u7528\u7A7A\u7684\u524D\u7F00\u540D\uFF0C\u8FD9\u6837\u914D\u7F6E\u6587\u4EF6\u76F4\u63A5\u4ECEclasspath\u6839\u76EE\u5F55\u4E0B\u52A0\u8F7D\u3002\u8FD9\u6837\u5C31\u53EF\u4EE5\u5C06`cool.properties`\u5B9A\u4E49\u653E\u5230classpath\u6839\u76EE\u5F55\u4E0B\uFF0C`ResourceBundleThemeSource`\u9ED8\u8BA4\u4F7F\u7528\u6807\u51C6\u7684Java\u8D44\u6E90\u52A0\u8F7D\u5DE5\u5177\uFF0C\u540C\u65F6\u4E5F\u5B8C\u5168\u652F\u6301\u56FD\u9645\u5316\uFF0C\u6240\u4EE5\u901A\u8FC7\u547D\u540D\u6765\u652F\u6301`cool_nl.properties`\u3002\n###### \u89E3\u6790\u4E3B\u9898\n`DispatcherServlet`\u901A\u8FC7bean\u7684\u540D\u5B57`themeResolver`\u6765\u67E5\u627E`ThemeResolver`\u7684\u5B9E\u73B0\u3002\nThemeResolver \u7684\u5B9E\u73B0\u5982\u4E0B\uFF1A\n\nClass | \u63CF\u8FF0 \n:---------- | :---------\nFixedThemeResolver | \u9009\u4E2D\u4E00\u4E2A\u56FA\u5B9A\u7684\u4E3B\u9898\uFF0C\u8BBE\u7F6E`defaultThemeName`\u5C5E\u6027\nSessionThemeResolver | \u4E3B\u9898\u7531\u7528\u6237session\u7EF4\u62A4\u3002\u6BCF\u4E2Asession\u53EA\u9700\u8981\u8BBE\u7F6E\u4E00\u6B21\nCookieThemeResolver | \u901A\u8FC7cookie\u9009\u62E9\u4E3B\u9898\n##### Multipart resolver\n`org.springframework.web.multipart`\u4E2D\u7684`MultipartResolver`\u662F\u7528\u6765\u5904\u7406multipart\u8BF7\u6C42\u7684\u3002\u5171\u6709\u7ED9\u4E88Common Fileupload\u548CServlet 3.0 \u4E24\u79CD\u5B9E\u73B0\u3002\n\u4E3A\u4E86\u4F7F\u7528multipart\uFF0C\u9700\u8981\u5728`DispatcherServlet`\u7684Spring\u914D\u7F6E\u4E2D\u58F0\u660E\u4E00\u4E2A\u540D\u5B57\u4E3A`multipartResolver`\u7684bean\u3002\u5F53POST\u8BF7\u6C42\u7684`content-type`\u662F`multipart/form-data`\u7684\u65F6\u5019\uFF0C\u89E3\u6790\u5668\u89E3\u6790\u8FD9\u4E2A\u8BF7\u6C42\u5E76\u4E14\u5C06`HttpServletRequest`\u5C01\u88C5\u6210`MultipartHttpServletRequest`\u6765\u5904\u7406\u8BF7\u6C42\u3002\n###### Apache FileUpload\n\u4F7F\u7528Apache Commons FileUpload \u53EA\u9700\u8981\u7B80\u5355\u7684\u914D\u7F6E\u4E00\u4E2A\u7C7B\u578B\u4E3A`CommonsMultipartResolver`\uFF0C\u540D\u5B57\u4E3A`multipartResolver`\u7684bean\u5373\u53EF\u3002\u5F53\u7136\u4E5F\u9700\u8981\u5C06`commons-fileupload`\u52A0\u5165\u5230\u4F9D\u8D56\u4E2D\u3002\n###### Servlet 3.0\n\u4F7F\u7528Servlet 3.0\u5219\u9700\u8981Servlet \u5BB9\u5668\u7684\u914D\u7F6E\n  - \u4F7F\u7528Java\u914D\u7F6E\uFF0C\u5728Servlet\u6CE8\u518C\u4E2D\u8BBE\u7F6E`MultipartConfigElement`\u3002\n  - \u4F7F\u7528web.xml \u6DFB\u52A0\u8981\u7ED9`<multipart-config>`\u7684\u914D\u7F6E\n\u5982\u4E0B\u662F\u4F7F\u7528Java\u7684\u914D\u7F6E\uFF1A\n\n```Java\npublic class AppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n    // ...\n\n    @Override\n    protected void customizeRegistration(ServletRegistration.Dynamic registration) {\n\n        // Optionally also set maxFileSize, maxRequestSize, fileSizeThreshold\n        registration.setMultipartConfig(new MultipartConfigElement("/tmp"));\n    }\n\n}\n```\n\nServlet 3.0\u914D\u7F6E\u597D\u4E4B\u540E\uFF0C\u53EA\u9700\u8981\u6DFB\u52A0\u7C7B\u578B\u4E3A`StandardServletMultipartResolver`\uFF0C\u540D\u5B57\u4E3A`multipartResolver`\u7684\u914D\u7F6E\u5373\u53EF\u3002\n\n'},'tags':['Vagrant','Translate','Backend','Ansible','Go','Architecture','Web','Http','HTTP/2','HTTP','Middleware','Java','OKHttp','Mybatis','CPU','Linux','Dartlang','Dart','Flutter','Mobile','ProgrammingLanguage','Javascript','Frontend','NodeJS','Node','Npm','JSON','Jackson','Js','JavaScript','ECMAScript','ECMAScript2016','ECMAScript2017','ECMAScript2018','Es6','Es7','Async','Await','Async/await','Java8','APM','Performance','Spring','SpringMVC','Hyperapp','React']},'siteData':{'title':'\u4EE3\u7801\u62FE\u9057'}};</script><script defer="" type="text/javascript" src="https://shjie047.github.io/bootstrap.aa1508cb.js"></script><script defer="" type="text/javascript" src="https://shjie047.github.io/templates/src/containers/Post.dc601368.js"></script><script defer="" type="text/javascript" src="https://shjie047.github.io/main.6c3a4af7.js"></script></body></html>
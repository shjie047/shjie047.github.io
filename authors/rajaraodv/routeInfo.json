{"path":"authors/rajaraodv","templateID":3,"sharedPropsHashes":{},"localProps":{"posts":[{"title":"ES2016, 2017å’Œ2018åˆ°åº•æœ‰å“ªäº›æ–°ä¸œè¥¿ï¼Ÿ","author":"rajaraodv","tags":["js","JavaScript","å‰ç«¯","frontend","ECMAScript","ECMAScript 2016","ECMAScript 2017","ECMAScript 2018","es6","es7","async","await","async/await"],"iso8601Date":"2018-04-03T08:00:00+08:00","basename":"Here_are_examples_of_everything_new_in_ECMAScript_2016_2017_and_2018","body":"\n\n![](1_Z-9unq6Am3vekNOa5fD1xg.png)\n\nJavascriptæ€»æ˜¯åœ¨å‘å¸ƒæ–°åŠŸèƒ½ï¼Œæƒ³è¦ä¸€ç›´è·Ÿä¸Šè„šæ­¥ä¸å¤ªå®¹æ˜“ï¼Œé…å¥—çš„demoä¹Ÿå¾ˆå°‘ï¼Œæœ¬æ–‡æ—¨åœ¨ç»“åˆå®ä¾‹å±•ç¤ºæœ€æ–°çš„18ä¸ªæ–°ç‰¹æ€§ï¼Œåšä¸ªæŠ€æœ¯çš„å¸ƒé“è€…ã€‚\n\n**ä¸‹é¢ä¾ç…§ç‰ˆæœ¬çš„å…ˆåé¡ºåºå¼€å§‹ä»‹ç»:**\n\n![](1_K09EWrqTcTwN9_dlhlzy6Q.png)\n\n## 1. Array.prototype.includes\n\né¦–å…ˆæ˜¯æ•°ç»„çš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•`includes`ï¼Œè¿™ä¸ªæ–¹æ³•çš„åŠŸèƒ½å¾ˆç®€å•ï¼šç”¨äºåˆ¤æ–­æŸä¸€é¡¹æ˜¯å¦åœ¨æ•°ç»„é‡Œï¼Œå’Œè¿™ä¸ªæ–¹æ³•åŠŸèƒ½ç±»ä¼¼çš„æœ‰`indexOf`ï¼Œä¸¤è€…çš„åŒºåˆ«æ˜¯`indexOf`æ— æ³•åˆ¤æ–­`NaN`ï¼Œ\nå¦‚å›¾ï¼š\n\n```Javascript\nconst arr = [1, 2, 3, 4, NaN];\n\n// es5\nif (arr.indexOf(3) >= 0) {\n  console.log(true)\n}\n\n// es2016\nif (arr.includes(e)) {\n  console.log(true)\n}\n\n// æ³¨ï¼šindexOfä¸æ”¯æŒæ£€æŸ¥`NaN`\narr.indexOf(NaN) // -1\narr.includes(NaN) // true\n```\n\n\n## 2. æ±‚å¹‚è¿ç®—ç¬¦\n\nç¬¬äºŒä¸ªæ–°åŠŸèƒ½ä¹Ÿæ¯”è¾ƒç®€å•ï¼š**æ±‚å¹‚è¿ç®—ç¬¦** -- `**`ï¼Œç”¨äºå–ä»£ä¹‹å‰çš„æ±‚å¹‚æ–¹æ³•`Math.pow`ï¼Œ\nå¦‚å›¾ï¼š\n\n```Javascript\n// ä¹‹å‰\nMath.pow(3, 2) // 9\n\n// ç°åœ¨\n3**2 // 9\n```\n\n![](1_fV_95TaY3ocgE8hlDhhv8w.png)\n\n## 1. Object.values()\n\n`Object.values`è¿™ä¸ªæ–¹æ³•å’Œ`Object.keys`ç±»ä¼¼ï¼Œéƒ½æ˜¯è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œé€šè¿‡æ–¹æ³•åå¯ä»¥ç›´è§‚çš„çŒœåˆ°è¿”å›çš„æ˜¯å¯¹è±¡çš„å€¼(value)ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è¿”å›è‡ªèº«åŸå‹çš„å±æ€§ï¼Œä¸åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„å±æ€§ï¼Œå¦‚å›¾ï¼š\n\n```Javascript\nconst cars = {BMW: 3, Tesla: 2, Toyota: 1}\n\n// es5\nconst vals = Object.keys(cars).map(key => cars[key]) \nconsole.log(vals) // [3, 2, 1]\n\n// es2016\nconst values = Object.values(cars)\nconsole.log(values) // [3, 2, 1]\n```\n\n\n## 2. Object.entries()\n\n`Object.entries()`è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒæœ‰æ„æ€ï¼Œæœ‰ç‚¹åƒ`Object.keys`å’Œ`Object.values`çš„ç»“åˆä½“ï¼ŒåŒæ—¶è¿”å›å¯¹è±¡çš„`key`å’Œ`value`ï¼Œå¹¶å°è£…åœ¨ä¸€ä¸ªæ•°ç»„é‡Œï¼Œè¿™ä¸ªæ–¹æ³•çš„å¥½å¤„åœ¨äºä½ å¯ä»¥é€šè¿‡`for of`éå†ä¸€æ¬¡å–å‡ºkey/value æˆ–è€… æŠŠ`Object`è½¬ä¸º`Map`ï¼š\n\n**ä¾‹1**ï¼Œéå†:\n\n```Javascript\nconst cars = { BMW: 3, Tesla: 2, Toyota: 1 }\n\n// es5çš„éå†æ–¹å¼\n// éœ€è¦æŠŠ`key`å–å‡ºæ¥ï¼Œå†éå†\nObject.keys(cars).forEach(key => {\n  console.log(`key: ${key}, value: ${cars[key]}`)\n})\n\n// es2017\nfor (let [key, value] of Object.entries(cars)) {\n  console.log(`key: ${key}, value: ${cars[key]}`)\n}\n``` \n\n**ä¾‹2**ï¼ŒæŠŠobjectç›´æ¥è½¬æ¢ä¸º`Map`:\n\n```Javascript\nconst cars = { BMW: 3, Tesla: 2, Toyota: 1 }\n\n// es5\nconst map1 = new Map()\nObject.keys(cars).map(key => {\n  map1.set(key, cars[key])\n})\n\nconsole.log(map1) // Map { 'BMW': 3, 'Tesla': 2, 'Toyota': 1 }\n\n// es2016\nconst map2 = new Map(Object.entries(cars))\n\nconsole.log(map2) // Map { 'BMW': 3, 'Tesla': 2, 'Toyota': 1 }\n```\n\n## 3. String padding\n\nStringå¢åŠ äº†ä¸¤ä¸ªå®ä¾‹æ–¹æ³• -- `padStart`å’Œ`padEnd`ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥åœ¨å­—ç¬¦ä¸²çš„é¦–/å°¾æ·»åŠ å…¶ä»–å­—ç¬¦ä¸²:\n\n```Javascript\n// 'someStr'.padStart(å­—ç¬¦æ•°, [,æ·»åŠ çš„å­—ç¬¦])\n\n'hello'.padStart('10', 'a') // 'aaaaahello', æ·»åŠ äº†5ä¸ªå­—ç¬¦`a`åä¸€å…±`10`ä¸ªå­—ç¬¦\n'hello'.padEnd('10', 'b') // 'hellobbbbb'\n'hello'.padStart('7') // '  hello', åœ¨å¤´éƒ¨æ·»åŠ ä¸¤ä¸ªä¸ªç©ºæ ¼\n```\n\n### 3.1 padStartç¤ºä¾‹\n\n```Javascript\nconst formatted = [0, 1, 12, 123, 1234, 12345].map(num =>\n  num.toString().padStart(10, '0')\n)\n\nconsole.log(formatted)\n// è¾“å‡º:\n// [\n//   '0000000000',\n//   '0000000001',\n//   '0000000012,'\n//   '0000000234,'\n//   '0000001234,'\n//   '0009012345'\n// ]\n```\n\n### 3.2 padEndç¤ºä¾‹\n\n```Javascript\nconst cars = {\n  'ğŸš™BMW': '10',\n  'ğŸš˜Tesla': '5',\n  'ğŸš–Lamborghini': '0'\n}\n\nObject.entries(cars).map(([name, count]) => {\n  console.log(`${name.padEnd(20, ' -')} Count: ${count.padStart(3, '0')}`)\n});\n\n//è¾“å‡º:\n// ğŸš™BMW - - - - - - -  Count: 010\n// ğŸš˜Tesla - - - - - -  Count: 005\n// ğŸš–Lamborghini - - -  Count: 000\n```\n\n## 4.Object.getOwnPropertyDescriptors\n\nè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯è¡¥å……`Object.assign`çš„åŠŸèƒ½ï¼Œåœ¨æµ…æ‹·è´(shallow clone)å¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œä¹Ÿä¼šå¤åˆ¶`getter`å’Œ`setter`æ–¹æ³•ï¼š\n\nä¸‹é¢çš„ä¾‹å­ç”¨`Object.defineProperties`æ‹·è´åŸå¯¹è±¡`Car`åˆ°æ–°å¯¹è±¡`ElectricCar`æ¥åŒºåˆ†`Object.assign`å’Œ`Object.getOwnPropertyDescriptors`ã€‚\n\n```Javascript\nconst Car = {\n  name: 'BMW',\n  price: 100000,\n  set discount(x) {\n    this.d = x\n  }\n  get discount() {\n    return this.d\n  }\n}\n\nconsole.log(Object.getOwnPropertyDescriptor(Car, 'discount')\n// è¾“å‡º:\n// {\n//   get: [Function: get],\n//   set: [Function: set],\n//   enumerable: true,\n//   configurable: true\n// }\n\nconst ElectricCar = Object.assign({}, Car)\nconsole.log(Object.getOwnPropertyDescriptor(ElectricCar, 'discount'))\n// è¾“å‡º:\n// {\n//   value: undefined,\n//   writable: true,\n//   enumerable: true,\n//   configurable: true\n// }\n\n// ä½¿ç”¨`Object.assign`åˆ›å»º`ElectricCar`åï¼Œå±æ€§`getter`å’Œ`setter`ä¸¢å¤±äº†\n```\n\n### ä½¿ç”¨`Object.getOwnPropertyDescriptors`å:\n\n```Javascript\nconst Car = {\n  name: 'BMW',\n  price: 100000,\n  set discount(x) {\n    this.d = x\n  }\n  get discount() {\n    return this.d\n  }\n}\n\nconst ElectricCar2 = Object.defineProperties({}, Object.getOwnPropertyDescriptors(Car))\n// è¾“å‡º:\n// {\n//   get: [Function: get],  <-----ğŸ‘ˆ\n//   set: [Function: set],  <-----ğŸ‘ˆ\n//   enumerable: true,\n//   configurable: true \n// }\n```\n\n## 5. åœ¨å‡½æ•°æœ€åä¸€ä¸ªå‚æ•°çš„æœ«å°¾æ·»åŠ é€—å·\n\nè¿™æ˜¯ä¸ªå¾ˆå°çš„ä¸€ä¸ªåŠŸèƒ½ç‚¹ï¼Œåœ¨å‡½æ•°å½¢å‚æœ€åä¸€ä¸ªå‚æ•°æœ«å°¾æ·»åŠ é€—å·ï¼Œå¯ä»¥é¿å…`git blame`æç¤ºä¸å¿…è¦çš„æ”¹åŠ¨ï¼Œ\nä»£ç ç¤ºä¾‹ï¼š\n\n```Javascript\n// å‡è®¾è¿™ä¸ªå‡½æ•°ç”± `ç¨‹åºå‘˜_1` åˆ›å»º\n// è¿™ä¸ªå‡½æ•°æœ€åä¸€ä¸ªå‚æ•°`age`åæ²¡æœ‰é€—å·\nfunction Person(\n  name,\n  age\n) {\n  this.name = name\n  this.age = age\n}\n\n// å¦‚æœ `ç¨‹åºå‘˜_2` è¿™æ—¶æœ‰äº†ä»¥ä¸‹ä¿®æ”¹\nfunction Person(\n  name,\n  age, /* é‚£ä¹ˆè¿™ä¸ª`,`é€—å·ä¹Ÿä¼šå¼•èµ·`git blame`è®¤ä¸º `ç¨‹åºå‘˜_1` ä¿®æ”¹äº†è¿™ä¸€è¡Œ*/\n  gender /* æ·»åŠ äº†æ–°å‚æ•° */\n) { // æ–°æ·»åŠ \n  this.name = name\n  this.age = age\n  this.gender = gender // æ–°æ·»åŠ \n}\n\n// es2017å¯¹è¿™ä¸ªæ··æ·†çš„å¤„ç†åŠæ³•æ˜¯:\n// é€šè¿‡ `ç¨‹åºå‘˜_1`åœ¨`age`æœ«å°¾æ·»åŠ `,`é€—å·\n\n// æ›´æ–°å¦‚ä¸‹:\n\n// å‡è®¾è¿™ä¸ªå‡½æ•°ç”± `ç¨‹åºå‘˜_1` åˆ›å»º\n// åœ¨æœ€åä¸€ä¸ªå‚æ•°`age`åæ·»åŠ `,`é€—å·\nfunction Person(\n  name,\n  age, /* æ·»åŠ é€—å· */\n) {\n  this.name = name\n  this.age = age\n}\n```\n\n## 6. Async/Await\n\nè¿™ä¸ªç‰¹æ€§æ˜¯ç›®å‰ä¸ºæ­¢æœ€é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä½¿ç”¨`async`å‡½æ•°å¯ä»¥è®©æˆ‘ä»¬é¿å…é¢‘ç¹è°ƒç”¨*æ¶å¿ƒçš„*`callback`ï¼Œä½¿ä»£ç ä¿æŒå¹²å‡€æ•´æ´ã€‚\n\nå½“ç¼–è¯‘å™¨è¿›å…¥`async`å‡½æ•°åï¼Œé‡åˆ°`await`å…³é”®å­—ä¼šæš‚åœæ‰§è¡Œï¼Œå¯ä»¥æŠŠ`await`åçš„è¡¨è¾¾å¼çœ‹æˆä¸€ä¸ª`promise`ï¼Œç›´åˆ°promiseè¢«`resolve`æˆ–`reject`åï¼Œå‡½æ•°æ‰ä¼šæ¢å¤æ‰§è¡Œï¼Œ\nå…·ä½“çœ‹å¦‚ä¸‹ä»£ç ï¼š\n\n```Javascript\n  \n// es5çš„`Promise`\nfunction getAmount(userId) {\n  getUser(userId)\n    .then(getBankBalance)\n    .then(amount => {\n      console.log(amount)\n    })\n}\n\n// es2017çš„`async`\nasync function getAmount2(userId) {\n  var user = await getUser(userId)\n  var amount = await getBankBalance()\n  console.log(amount)\n}\n\ngetAmount('1') // $1,000\ngetAmount2('1') // $1,000\n\nfunction getUser(userId) {\n  return new Promise(resolve => {\n    setTimeout(() => {\n      resolve('å¼ ä¸‰')\n    }, 1000)\n  })\n}\n\nfunction getBankBalance() {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (user === 'å¼ ä¸‰') {\n        resolve('$1,000')\n      } else {\n        resolve('Unknown User')\n      }\n    }, 1000)\n  })\n}\n```\n\n### 6.1 Asyncå‡½æ•°æœ¬èº«è¿”å›ä¸€ä¸ªPromise\n\nè¦æƒ³å¾—åˆ°Asyncå‡½æ•°çš„è¿”å›å€¼ï¼Œéœ€è¦æŠŠè¿”å›å€¼å½“ä½œä¸€ä¸ªpromiseè¿›è¡Œ`then`æ±‚å€¼ã€‚\n\nå…·ä½“çœ‹å¦‚ä¸‹ä»£ç ï¼š\n\n```Javascript\nasync function doubleAndAdd(a, b) {\n  a = await doubleAfter1Sec(a)\n  b = await doubleAfter1Sec(b)\n  return a + b\n}\n\ndoubleAndAdd(1, 2).then(console.log) // 5 \n\nasync function doubleAfter1Sec(param) {\n  return new Promise(resolve => {\n    setTimeout(() => {\n      resolve(param * 2)\n    }, 1000)\n  })\n}\n```\n\n### 6.2 å¹¶è¡Œè°ƒç”¨async/await\n\nåœ¨ä¸Šä¸€ä¸ªå‡½æ•°`doubleAndAdd`é‡Œä¾æ¬¡è°ƒç”¨äº†ä¸¤ä¸ª`async`å‡½æ•°ï¼Œä½†æ˜¯æ¯æ¬¡è°ƒç”¨éƒ½ç­‰å¾…äº†1ç§’ï¼Œæ•ˆç‡å¾ˆå·®ï¼›å› ä¸º`a`å’Œ`b`ä¹‹é—´æ²¡æœ‰è€¦åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`Promise.all`æ¥å¹¶è¡Œæ‰§è¡Œè¿™ä¸¤æ¬¡è°ƒç”¨:\n\n```Javascript\nasync function doubleAndAdd(a, b) {\n  // ä½¿ç”¨`Promise.all`\n  // è¿™ä¸ªåœ°æ–¹ä½¿ç”¨æ•°ç»„`è§£æ„`\n  // æ¥å¾—åˆ°ä¸¤æ¬¡è°ƒç”¨çš„ç»“æœ\n  const [a, b] = Promise.all([doubleAfter1Sec(a), doubleAfter1Sec(b)])\n  return a + b\n}\n\ndoubleAndAdd(1, 2).then(console.log) // 5 \n\nasync function doubleAfter1Sec(param) {\n  return new Promise(resolve => {\n    setTimeout(() => {\n      resolve(param * 2)\n    }, 1000)\n  })\n}\n```\n\n### 6.3 async/awaitçš„é”™è¯¯å¤„ç†\n\nä½¿ç”¨`async/await`æ—¶çš„é”™è¯¯å¤„ç†æœ‰å¾ˆå¤šæ–¹æ³•ï¼š\n\n#### 1. åœ¨å‡½æ•°å†…ä½¿ç”¨try/catch\n\n```Javascript\nasync function doubleAndAdd(a, b) {\n  try {\n    a = await doubleAfter1Sec(a)\n    b = await doubleAfter1Sec(b)\n  } catch (e) {\n    return NaN\n  }\n  return a + b\n}\n\ndoubleAndAdd('one', 2).then(console.log) // NaN\ndoubleAndAdd(1, 2).then(console.log) // 5 \n\nasync function doubleAfter1Sec(param) {\n  return new Promise(resolve => {\n    setTimeout(() => {\n      const val = param * 2\n      isNaN(val) ? reject(NaN) : resolve(val)\n    }, 1000)\n  })\n}\n```\n\n#### 2. catch æ‰€æœ‰`await`è¡¨è¾¾å¼\n\nå› ä¸º`await`è¡¨è¾¾å¼è¿”å›ä¸€ä¸ª`promise`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨`await`è¡¨è¾¾å¼åç›´æ¥æ‰§è¡Œ`catch`æ¥å¤„ç†é”™è¯¯\n\n```Javascript\nasync function doubleAndAdd(a, b) {\n  a = await doubleAfter1Sec(a).catch(e => console.log(`'a' is NaN`)\n  b = await doubleAfter1Sec(b).catch(e => console.log(`'b' is NaN`))\n\n  if (!a || !b) return NaN\n  return a + b\n}\n\ndoubleAndAdd('one', 2).then(console.log) // NaN, \"a\" is NaN\ndoubleAndAdd(1, 2).then(console.log) // 5 \n\nasync function doubleAfter1Sec(param) {\n  return new Promise(resolve => {\n    setTimeout(() => {\n      const val = param * 2\n      isNaN(val) ? reject(NaN) : resolve(val)\n    }, 1000)\n  })\n}\n```\n\n#### 3. catch æ•´ä¸ªasync-awaitå‡½æ•°\n\n```Javascript\nasync function doubleAndAdd(a, b) {\n  a = await doubleAfter1Sec(a)\n  b = await doubleAfter1Sec(b)\n  return a + b\n}\n\ndoubleAndAdd('one', 2)\n  .then(console.log)\n  .catch(console.log) // ä½¿ç”¨catch\n```\n\n![](1_X755b572fEcI0vK0fRKWkw.png)\n\n> ECMAScriptç›®å‰åœ¨æœ€ç»ˆç¨¿é˜¶æ®µï¼Œå°†ä¼šåœ¨2018å¹´6æœˆæˆ–7æœˆæ­£å¼æ¨å‡ºã€‚ä¸‹é¢ä»‹ç»çš„æ‰€æœ‰ç‰¹æ€§å±äº**stage-4**ï¼Œéƒ½å°†æˆä¸ºECMAScript 2018çš„ä¸€éƒ¨åˆ†ã€‚\n\n## 1. å…±äº«å†…å­˜å’ŒåŸå­æ€§\n\nè¿™æ˜¯JSçš„ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œæ˜¯JSå¼•æ“çš„æ ¸å¿ƒæ”¹è¿›ã€‚\n\n**å…±äº«å†…å­˜çš„ä¸»è¦æ€æƒ³æ˜¯ï¼š æŠŠå¤šçº¿ç¨‹çš„ç‰¹æ€§å¸¦åˆ°JSï¼Œå¼€å‘è€…ä»ä¹‹å‰ç”±JSå¼•æ“ç®¡ç†å†…å­˜å˜ä¸ºè‡ªå·±ç®¡ç†å†…å­˜ï¼Œä»è€Œå†™å‡ºé«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„ä»£ç ã€‚**\n\nè¿™ä¸ªç‰¹æ€§ç”±ä¸€ä¸ªæ–°çš„å…¨å±€å¯¹è±¡[SharedArrayBuffer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer)æ¥å®ç°ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨ä¸€å—**å…±äº«å†…å­˜ç©ºé—´**å‚¨å­˜æ•°æ®ï¼Œè¿™éƒ¨åˆ†æ•°æ®å¯ä»¥ç”±JSçš„ä¸»çº¿ç¨‹å’Œ`web-worker`çº¿ç¨‹å…±äº«ã€‚\n\nå½“å‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨JSä¸»çº¿ç¨‹å’Œweb-workeré—´å…±äº«æ•°æ®æ—¶ï¼Œå¿…é¡»ä½¿ç”¨`postMessage`åœ¨ä¸åŒçº¿ç¨‹é—´ä¼ é€’æ•°æ®ï¼Œæœ‰äº†`SharedArrayBuffer`åï¼Œä¸åŒçš„çº¿ç¨‹å¯ä»¥ç›´æ¥è®¿é—®è¿™ä¸ªå¯¹è±¡æ¥å…±äº«æ•°æ®ã€‚\n\nä½†æ˜¯å¤šçº¿ç¨‹é—´çš„å…±äº«å†…å­˜ä¼šå¯¼è‡´ç«æ€æ¡ä»¶ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¼•å…¥äº†`åŸå­æ€§`çš„å…¨å±€å¯¹è±¡ã€‚åŸå­æ€§å¯¹è±¡æä¾›äº†å„ç§æ–¹æ³•æ¥é”ä½æ­£åœ¨è¢«æŸä¸ªçº¿ç¨‹è®¿é—®çš„å†…å­˜ï¼Œä»¥ä¿è¯å†…å­˜å®‰å…¨ã€‚\n","date":"2018-04-03"}]}}